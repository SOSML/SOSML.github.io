var Interpreter=function(t){function __webpack_require__(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,__webpack_require__),i.l=!0,i.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.i=function(t){return t},__webpack_require__.d=function(exports,t,e){__webpack_require__.o(exports,t)||Object.defineProperty(exports,t,{configurable:!1,enumerable:!0,get:e})},__webpack_require__.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=8)}([function(t,exports,e){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var i=function(t){function InterpreterError(e,n){var i=t.call(this,n)||this;return i.position=e,Object.setPrototypeOf(i,InterpreterError.prototype),i}return n(InterpreterError,t),InterpreterError}(Error);exports.InterpreterError=i;var r=function(t){function InternalInterpreterError(e,n){void 0===n&&(n="internal compiler error");var i=t.call(this,e,n)||this;return Object.setPrototypeOf(i,InternalInterpreterError.prototype),i}return n(InternalInterpreterError,t),InternalInterpreterError}(i);exports.InternalInterpreterError=r;var o=function(t){function FeatureNotImplementedError(e,n){var i=t.call(this,e,n)||this;return Object.setPrototypeOf(i,FeatureNotImplementedError.prototype),i}return n(FeatureNotImplementedError,t),FeatureNotImplementedError}(i);exports.FeatureNotImplementedError=o;var a=function(t){function FeatureDisabledError(e,n){var i=t.call(this,e,n)||this;return Object.setPrototypeOf(i,FeatureDisabledError.prototype),i}return n(FeatureDisabledError,t),FeatureDisabledError}(i);exports.FeatureDisabledError=a;var s=function(t){function IncompleteError(e,n){void 0===n&&(n="unexpected end of input");var i=t.call(this,e,n)||this;return Object.setPrototypeOf(i,IncompleteError.prototype),i}return n(IncompleteError,t),IncompleteError}(i);exports.IncompleteError=s;var u=function(t){function LexerError(e,n){var i=t.call(this,e,n)||this;return Object.setPrototypeOf(i,LexerError.prototype),i}return n(LexerError,t),LexerError}(i);exports.LexerError=u;var p=function(t){function ParserError(e,n){var i=t.call(this,n,e)||this;return Object.setPrototypeOf(i,ParserError.prototype),i}return n(ParserError,t),ParserError}(i);exports.ParserError=p;var c=function(t){function ElaborationError(e,n){var i=t.call(this,e,n)||this;return Object.setPrototypeOf(i,ElaborationError.prototype),i}return n(ElaborationError,t),ElaborationError.getUnguarded=function(t,e){var n="";e.length>1&&(n+="s"),n+=" ";for(var i=0;i<e.length;++i)i>0&&(n+=", "),n+='"'+e[i]+'"';return new ElaborationError(t,"Unguarded type variable"+n+".")},ElaborationError}(i);exports.ElaborationError=c;var h=function(t){function EvaluationError(e,n){var i=t.call(this,e,n)||this;return Object.setPrototypeOf(i,EvaluationError.prototype),i}return n(EvaluationError,t),EvaluationError}(i);exports.EvaluationError=h;var f=function(t){function Warning(e,n){var i=t.call(this,e,n)||this;return Object.setPrototypeOf(i,Warning.prototype),i}return n(Warning,t),Warning}(i);exports.Warning=f},function(t,exports,e){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function KeywordToken(t,e){this.text=t,this.position=e}return KeywordToken.prototype.getText=function(){return this.text},KeywordToken.prototype.isValidRecordLabel=function(){return!1},KeywordToken.prototype.isVid=function(){return!1},KeywordToken}();exports.KeywordToken=i;var r=function(){function ConstantToken(){}return ConstantToken.prototype.isVid=function(){return!1},ConstantToken}();exports.ConstantToken=r;var o=function(t){function IntegerConstantToken(e,n,i){var r=t.call(this)||this;return r.text=e,r.position=n,r.value=i,r}return n(IntegerConstantToken,t),IntegerConstantToken.prototype.getText=function(){return""+this.value},IntegerConstantToken.prototype.isValidRecordLabel=function(){return!1},IntegerConstantToken}(r);exports.IntegerConstantToken=o;var a=function(t){function RealConstantToken(e,n,i){var r=t.call(this)||this;return r.text=e,r.position=n,r.value=i,r}return n(RealConstantToken,t),RealConstantToken.prototype.getText=function(){return""+this.value},RealConstantToken.prototype.isValidRecordLabel=function(){return!1},RealConstantToken}(r);exports.RealConstantToken=a;var s=function(t){function WordConstantToken(e,n,i){var r=t.call(this)||this;return r.text=e,r.position=n,r.value=i,r}return n(WordConstantToken,t),WordConstantToken.prototype.getText=function(){return""+this.value},WordConstantToken.prototype.isValidRecordLabel=function(){return!1},WordConstantToken}(r);exports.WordConstantToken=s;var u=function(t){function CharacterConstantToken(e,n,i){var r=t.call(this)||this;return r.text=e,r.position=n,r.value=i,r}return n(CharacterConstantToken,t),CharacterConstantToken.prototype.getText=function(){return""+this.text},CharacterConstantToken.prototype.isValidRecordLabel=function(){return!1},CharacterConstantToken}(r);exports.CharacterConstantToken=u;var p=function(t){function StringConstantToken(e,n,i){var r=t.call(this)||this;return r.text=e,r.position=n,r.value=i,r}return n(StringConstantToken,t),StringConstantToken.prototype.getText=function(){return""+this.text},StringConstantToken.prototype.isValidRecordLabel=function(){return!1},StringConstantToken}(r);exports.StringConstantToken=p;var c=function(){function IdentifierToken(t,e){this.text=t,this.position=e,this.opPrefixed=!1}return IdentifierToken.prototype.getText=function(){return this.text},IdentifierToken.prototype.isValidRecordLabel=function(){return!0},IdentifierToken.prototype.isVid=function(){return!0},IdentifierToken}();exports.IdentifierToken=c;var h=function(t){function AlphanumericIdentifierToken(e,n){return t.call(this,e,n)||this}return n(AlphanumericIdentifierToken,t),AlphanumericIdentifierToken.prototype.getText=function(){return this.text},AlphanumericIdentifierToken.prototype.isValidRecordLabel=function(){return!0},AlphanumericIdentifierToken}(c);exports.AlphanumericIdentifierToken=h;var f=function(){function TypeVariableToken(t,e){this.text=t,this.position=e}return TypeVariableToken.prototype.getText=function(){return this.text},TypeVariableToken.prototype.isValidRecordLabel=function(){return!1},TypeVariableToken.prototype.isVid=function(){return!1},TypeVariableToken}();exports.TypeVariableToken=f;var l=function(t){function EqualityTypeVariableToken(e,n){return t.call(this,e,n)||this}return n(EqualityTypeVariableToken,t),EqualityTypeVariableToken.prototype.getText=function(){return this.text},EqualityTypeVariableToken.prototype.isValidRecordLabel=function(){return!1},EqualityTypeVariableToken.prototype.isVid=function(){return!1},EqualityTypeVariableToken}(f);exports.EqualityTypeVariableToken=l;var d=function(t){function StarToken(e){var n=t.call(this,"*",e)||this;return n.position=e,n.opPrefixed=!1,n}return n(StarToken,t),StarToken.prototype.getText=function(){return this.text},StarToken.prototype.isValidRecordLabel=function(){return!0},StarToken.prototype.isVid=function(){return!0},StarToken}(i);exports.StarToken=d;var y=function(t){function EqualsToken(e){var n=t.call(this,"=",e)||this;return n.position=e,n}return n(EqualsToken,t),EqualsToken.prototype.getText=function(){return this.text},EqualsToken.prototype.isValidRecordLabel=function(){return!1},EqualsToken.prototype.isVid=function(){return!0},EqualsToken}(i);exports.EqualsToken=y;var v=function(t){function NumericToken(e,n,i){return t.call(this,e,n,i)||this}return n(NumericToken,t),NumericToken.prototype.getText=function(){return this.text},NumericToken.prototype.isValidRecordLabel=function(){return!0},NumericToken.prototype.isVid=function(){return!1},NumericToken}(o);exports.NumericToken=v;var T=function(){function LongIdentifierToken(t,e,n,i){this.text=t,this.position=e,this.qualifiers=n,this.id=i,this.opPrefixed=!1}return LongIdentifierToken.prototype.getText=function(){for(var t="",e=0;e<this.qualifiers.length;++e)e>0&&(t+="."),t+=this.qualifiers[e].getText();return t+"."+this.id.getText()},LongIdentifierToken.prototype.isValidRecordLabel=function(){return!1},LongIdentifierToken.prototype.isVid=function(){return!1},LongIdentifierToken}();exports.LongIdentifierToken=T},function(t,exports,e){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=e(4),i=e(1),r=e(0);!function(t){t[t.VALUE_VARIABLE=0]="VALUE_VARIABLE",t[t.VALUE_CONSTRUCTOR=1]="VALUE_CONSTRUCTOR",t[t.EXCEPTION_CONSTRUCTOR=2]="EXCEPTION_CONSTRUCTOR"}(exports.IdentifierStatus||(exports.IdentifierStatus={}));var o=function(){function TypeInformation(t,e,n,i){void 0===i&&(i=!0),this.type=t,this.constructors=e,this.arity=n,this.allowsEquality=i}return TypeInformation}();exports.TypeInformation=o;var a=function(){function DynamicFunctorInformation(t,e,n,i){this.paramName=t,this.param=e,this.body=n,this.state=i}return DynamicFunctorInformation}();exports.DynamicFunctorInformation=a;var s=function(){function DynamicInterface(t,e,n){this.typeInterface=t,this.valueInterface=e,this.structureInterface=n}return DynamicInterface.prototype.extend=function(t){for(var e in t.typeInterface)t.typeInterface.hasOwnProperty(e)&&(this.typeInterface[e]=t.typeInterface[e]);for(var e in t.valueInterface)t.valueInterface.hasOwnProperty(e)&&(this.valueInterface[e]=t.valueInterface[e]);for(var e in t.structureInterface)t.structureInterface.hasOwnProperty(e)&&(this.structureInterface[e]=t.structureInterface[e]);return this},DynamicInterface}();exports.DynamicInterface=s;var u=function(){function InfixStatus(t,e,n){void 0===e&&(e=0),void 0===n&&(n=!1),this.infix=t,this.precedence=e,this.rightAssociative=n}return InfixStatus}();exports.InfixStatus=u;var p=function(){function DynamicBasis(t,e,n,i,r){this.typeEnvironment=t,this.valueEnvironment=e,this.structureEnvironment=n,this.signatureEnvironment=i,this.functorEnvironment=r}return DynamicBasis.prototype.getValue=function(t){return this.valueEnvironment[t]},DynamicBasis.prototype.getType=function(t){return this.typeEnvironment[t]},DynamicBasis.prototype.getStructure=function(t){return this.structureEnvironment[t]},DynamicBasis.prototype.getSignature=function(t){return this.signatureEnvironment[t]},DynamicBasis.prototype.getFunctor=function(t){return this.functorEnvironment[t]},DynamicBasis.prototype.setValue=function(t,e,n){this.valueEnvironment[t]=[e,n]},DynamicBasis.prototype.setType=function(t,e){this.typeEnvironment[t]=e},DynamicBasis.prototype.setStructure=function(t,e){this.structureEnvironment[t]=e},DynamicBasis.prototype.setSignature=function(t,e){this.signatureEnvironment[t]=e},DynamicBasis.prototype.setFunctor=function(t,e){this.functorEnvironment[t]=e},DynamicBasis.prototype.extend=function(t){for(var e in t.typeEnvironment)t.typeEnvironment.hasOwnProperty(e)&&(this.typeEnvironment[e]=t.typeEnvironment[e]);for(var e in t.valueEnvironment)t.valueEnvironment.hasOwnProperty(e)&&(this.valueEnvironment[e]=t.valueEnvironment[e]);for(var e in t.structureEnvironment)t.structureEnvironment.hasOwnProperty(e)&&(this.structureEnvironment[e]=t.structureEnvironment[e]);for(var e in t.signatureEnvironment)t.signatureEnvironment.hasOwnProperty(e)&&(this.signatureEnvironment[e]=t.signatureEnvironment[e]);for(var e in t.functorEnvironment)t.functorEnvironment.hasOwnProperty(e)&&(this.functorEnvironment[e]=t.functorEnvironment[e]);return this},DynamicBasis.prototype.restrict=function(t){var e=new DynamicBasis({},{},{},this.signatureEnvironment,this.functorEnvironment);for(var n in t.typeInterface)if(t.typeInterface.hasOwnProperty(n)&&this.typeEnvironment.hasOwnProperty(n)){for(var i=new Set,r=[],o=0;o<this.typeEnvironment[n].length;++o)i=i.add(this.typeEnvironment[n][o]);for(var o=0;o<t.typeInterface[n].length;++o)i.has(t.typeInterface[n][o])&&r.push(t.typeInterface[n][o]);e.typeEnvironment[n]=r}for(var n in t.valueInterface)t.valueInterface.hasOwnProperty(n)&&this.valueEnvironment.hasOwnProperty(n)&&(e.valueEnvironment[n]=[this.valueEnvironment[n][0],t.valueInterface[n]]);for(var n in t.structureInterface)t.structureInterface.hasOwnProperty(n)&&this.structureEnvironment.hasOwnProperty(n)&&(e.structureEnvironment[n]=this.structureEnvironment[n].restrict(t.structureInterface[n]));return e},DynamicBasis}();exports.DynamicBasis=p;var c=function(){function StaticBasis(t,e,n,i,r){this.typeEnvironment=t,this.valueEnvironment=e,this.structureEnvironment=n,this.signatureEnvironment=i,this.functorEnvironment=r}return StaticBasis.prototype.getValue=function(t){return this.valueEnvironment[t]},StaticBasis.prototype.getType=function(t){return this.typeEnvironment[t]},StaticBasis.prototype.getStructure=function(t){return this.structureEnvironment[t]},StaticBasis.prototype.getSignature=function(t){return this.signatureEnvironment[t]},StaticBasis.prototype.getFunctor=function(t){return this.functorEnvironment[t]},StaticBasis.prototype.setValue=function(t,e,n){this.valueEnvironment[t]=[e,n]},StaticBasis.prototype.deleteValue=function(t){this.valueEnvironment[t]=void 0},StaticBasis.prototype.setType=function(t,e,n,i,r){void 0===r&&(r=!1),this.typeEnvironment[t]=new o(e,n,i,r)},StaticBasis.prototype.setStructure=function(t,e){this.structureEnvironment[t]=e},StaticBasis.prototype.setSignature=function(t,e){this.signatureEnvironment[t]=e},StaticBasis.prototype.setFunctor=function(t,e){this.functorEnvironment[t]=e},StaticBasis.prototype.extend=function(t){for(var e in t.typeEnvironment)t.typeEnvironment.hasOwnProperty(e)&&(this.typeEnvironment[e]=t.typeEnvironment[e]);for(var e in t.valueEnvironment)t.valueEnvironment.hasOwnProperty(e)&&(this.valueEnvironment[e]=t.valueEnvironment[e]);for(var e in t.structureEnvironment)t.structureEnvironment.hasOwnProperty(e)&&(this.structureEnvironment[e]=t.structureEnvironment[e]);for(var e in t.signatureEnvironment)t.signatureEnvironment.hasOwnProperty(e)&&(this.signatureEnvironment[e]=t.signatureEnvironment[e]);for(var e in t.functorEnvironment)t.functorEnvironment.hasOwnProperty(e)&&(this.functorEnvironment[e]=t.functorEnvironment[e]);return this},StaticBasis}();exports.StaticBasis=c;var h=function(){function State(t,e,n,i,r,o,a,s){void 0===o&&(o=[0,new Map]),void 0===a&&(a={}),void 0===s&&(s={}),this.id=t,this.parent=e,this.staticBasis=n,this.dynamicBasis=i,this.memory=r,this.freeTypeVariables=o,this.infixEnvironment=a,this.valueIdentifierId=s}return State.allowsRebind=function(t){return void 0==={true:!1,false:!1,nil:!1,"::":!1,"=":!1,ref:!1,":=":!1,"!":!1}[t]},State.prototype.getMemoryChanges=function(t){if(this.id===t)return[];var e=[];void 0!==this.parent&&(e=this.parent.getMemoryChanges(t));for(var n in this.memory[1])this.memory[1].hasOwnProperty(n)&&e.push([+n,this.memory[1][n]]);return e},State.prototype.getDynamicChanges=function(t){if(this.id===t)return new p({},{},{},{},{});var e=new p({},{},{},{},{});return void 0!==this.parent&&(e=this.parent.getDynamicChanges(t)),e=e.extend(this.dynamicBasis)},State.prototype.getStaticChanges=function(t){if(this.id===t)return new c({},{},{},{},{});var e=new c({},{},{},{},{});return void 0!==this.parent&&(e=this.parent.getStaticChanges(t)),e=e.extend(this.staticBasis)},State.prototype.getNestedState=function(t){return void 0===t&&(t=void 0),void 0===t&&(t=this.id+1),new State(t,this,new c({},{},{},{},{}),new p({},{},{},{},{}),[this.memory[0],{}],[this.freeTypeVariables[0],new Map])},State.prototype.getCell=function(t){return void 0!==this.memory[1][t]?this.memory[1][t]:void 0===this.parent?void 0:this.parent.getCell(t)},State.prototype.getTypeVariableBinds=function(t){void 0===t&&(t=0);var e=this.freeTypeVariables;if(void 0===this.parent||this.parent.id<t){var n=new Map;return e[1].forEach(function(t,e){n.set(e,t)}),[e[0],n]}var i=this.parent.getTypeVariableBinds(t);return e[1].forEach(function(t,e){i[1].set(e,t)}),[Math.max(e[0],i[0]),i[1]]},State.prototype.getStaticValue=function(t,e){void 0===e&&(e=0);var n=this.staticBasis.getValue(t);return void 0!==n||void 0===this.parent||this.parent.id<e?void 0!==n?[n[0],n[1]]:n:this.parent.getStaticValue(t,e)},State.prototype.getStaticType=function(t,e){void 0===e&&(e=0);var n=this.staticBasis.getType(t);return void 0!==n||void 0===this.parent||this.parent.id<e?n:this.parent.getStaticType(t,e)},State.prototype.getStaticStructure=function(t,e){void 0===e&&(e=0);var n=this.staticBasis.getStructure(t);return void 0!==n||void 0===this.parent||this.parent.id<e?n:this.parent.getStaticStructure(t,e)},State.prototype.getAndResolveStaticStructure=function(t,e){void 0===e&&(e=0);var n=void 0;if(0===t.qualifiers.length)throw new r.EvaluationError(t.position,"Unqualified LongIdentifierToken are too unqualified to be useful here.");n=this.getStaticStructure(t.qualifiers[0].getText(),e);for(var i=1;i<t.qualifiers.length;++i){if(void 0===n)return n;n=n.getStructure(t.qualifiers[i].getText())}return n},State.prototype.getStaticSignature=function(t,e){void 0===e&&(e=0);var n=this.staticBasis.getSignature(t);return void 0!==n||void 0===this.parent||this.parent.id<e?n:this.parent.getStaticSignature(t,e)},State.prototype.getStaticFunctor=function(t,e){void 0===e&&(e=0);var n=this.staticBasis.getFunctor(t);return void 0!==n||void 0===this.parent||this.parent.id<e?n:this.parent.getStaticFunctor(t,e)},State.prototype.getDynamicValue=function(t,e){void 0===e&&(e=0);var n=this.dynamicBasis.getValue(t);return void 0!==n||void 0===this.parent||this.parent.id<e?void 0!==n?[n[0],n[1]]:n:this.parent.getDynamicValue(t,e)},State.prototype.getDynamicType=function(t,e){void 0===e&&(e=0);var n=this.dynamicBasis.getType(t);return void 0!==n||void 0===this.parent||this.parent.id<e?void 0!==n?[n[0],n[1]]:n:this.parent.getDynamicType(t,e)},State.prototype.getDynamicStructure=function(t,e){void 0===e&&(e=0);var n=this.dynamicBasis.getStructure(t);return void 0!==n||void 0===this.parent||this.parent.id<e?n:this.parent.getDynamicStructure(t,e)},State.prototype.getAndResolveDynamicStructure=function(t,e){void 0===e&&(e=0);var n=void 0;if(0===t.qualifiers.length)throw new r.EvaluationError(t.position,"Unqualified LongIdentifierToken are too unqualified to be useful here.");n=this.getDynamicStructure(t.qualifiers[0].getText(),e);for(var i=1;i<t.qualifiers.length;++i){if(void 0===n)return n;n=n.getStructure(t.qualifiers[i].getText())}return n},State.prototype.getDynamicSignature=function(t,e){void 0===e&&(e=0);var n=this.dynamicBasis.getSignature(t);return void 0!==n||void 0===this.parent||this.parent.id<e?n:this.parent.getDynamicSignature(t,e)},State.prototype.getDynamicFunctor=function(t,e){void 0===e&&(e=0);var n=this.dynamicBasis.getFunctor(t);return void 0!==n||void 0===this.parent||this.parent.id<e?n:this.parent.getDynamicFunctor(t,e)},State.prototype.getInfixStatus=function(t,e){if(void 0===e&&(e=0),t.isVid()||t instanceof i.LongIdentifierToken)return this.infixEnvironment.hasOwnProperty(t.getText())||!this.parent||this.parent.id<e?this.infixEnvironment[t.getText()]:this.parent.getInfixStatus(t,e);throw new r.InternalInterpreterError(t.position,'You gave me some "'+t.getText()+'" ('+t.constructor.name+") but I only want (Long)IdentifierToken.")},State.prototype.getValueIdentifierId=function(t,e){return void 0===e&&(e=0),this.valueIdentifierId.hasOwnProperty(t)?this.valueIdentifierId[t]:!this.parent||this.parent.id<e?0:this.parent.getValueIdentifierId(t,e)},State.prototype.incrementValueIdentifierId=function(t,e){if(void 0===e&&(e=void 0),void 0===e||this.id===e)this.valueIdentifierId[t]=this.getValueIdentifierId(t,e)+1;else{if(e>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+e+'" does not exist.');this.parent.incrementValueIdentifierId(t,e)}},State.prototype.setCell=function(t,e){t>=this.memory[0]&&(this.memory[0]=t+1),this.memory[1][t]=e},State.prototype.setNewCell=function(t){return this.memory[1][this.memory[0]]=t,new n.ReferenceValue(this.memory[0]++)},State.prototype.deleteStaticValue=function(t){this.staticBasis.deleteValue(t),void 0!==this.parent&&this.parent.deleteStaticValue(t)},State.prototype.setStaticValue=function(t,e,n,i){if(void 0===i&&(i=void 0),void 0===i||i===this.id)this.staticBasis.setValue(t,e,n);else{if(i>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+i+'" does not exist.');this.parent.setStaticValue(t,e,n,i)}},State.prototype.setStaticType=function(t,e,n,i,o){if(void 0===o&&(o=void 0),void 0===o||o===this.id)this.staticBasis.setType(t,e,n,i);else{if(o>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+o+'" does not exist.');this.parent.setStaticType(t,e,n,i,o)}},State.prototype.setStaticStructure=function(t,e,n){if(void 0===n&&(n=void 0),void 0===n||n===this.id)this.staticBasis.setStructure(t,e);else{if(n>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+n+'" does not exist.');this.parent.setStaticStructure(t,e,n)}},State.prototype.setStaticSignature=function(t,e,n){if(void 0===n&&(n=void 0),void 0===n||n===this.id)this.staticBasis.setSignature(t,e);else{if(n>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+n+'" does not exist.');this.parent.setStaticSignature(t,e,n)}},State.prototype.setStaticFunctor=function(t,e,n){if(void 0===n&&(n=void 0),void 0===n||n===this.id)this.staticBasis.setFunctor(t,e);else{if(n>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+n+'" does not exist.');this.parent.setStaticFunctor(t,e,n)}},State.prototype.setDynamicValue=function(t,e,n,i){if(void 0===i&&(i=void 0),void 0===i||i===this.id)this.dynamicBasis.setValue(t,e,n);else{if(i>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+i+'" does not exist.');this.parent.setDynamicValue(t,e,n,i)}},State.prototype.setDynamicType=function(t,e,n){if(void 0===n&&(n=void 0),void 0===n||n===this.id)this.dynamicBasis.setType(t,e);else{if(n>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+n+'" does not exist.');this.parent.setDynamicType(t,e,n)}},State.prototype.setDynamicStructure=function(t,e,n){if(void 0===n&&(n=void 0),void 0===n||n===this.id)this.dynamicBasis.setStructure(t,e);else{if(n>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+n+'" does not exist.');this.parent.setDynamicStructure(t,e,n)}},State.prototype.setDynamicSignature=function(t,e,n){if(void 0===n&&(n=void 0),void 0===n||n===this.id)this.dynamicBasis.setSignature(t,e);else{if(n>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+n+'" does not exist.');this.parent.setDynamicSignature(t,e,n)}},State.prototype.setDynamicFunctor=function(t,e,n){if(void 0===n&&(n=void 0),void 0===n||n===this.id)this.dynamicBasis.setFunctor(t,e);else{if(n>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+n+'" does not exist.');this.parent.setDynamicFunctor(t,e,n)}},State.prototype.setInfixStatus=function(t,e,n,o,a){if(void 0===a&&(a=void 0),void 0===a||a===this.id)(t.isVid()||t instanceof i.LongIdentifierToken)&&(this.infixEnvironment[t.getText()]=new u(o,e,n));else{if(a>this.id||void 0===this.parent)throw new r.InternalInterpreterError(-1,'State with id "'+a+'" does not exist.');this.parent.setInfixStatus(t,e,n,o,a)}},State}();exports.State=h},function(t,exports,e){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var i=e(0),r=function(){function Type(){}return Type.prototype.instantiate=function(t,e,n){throw void 0===n&&(n=new Set),new i.ElaborationError(-1,"I mustn't run away. I mustn't run away. I mustn't run away.")},Type.prototype.merge=function(t,e,n){throw new i.ElaborationError(-1,"I don't know anything.")},Type.prototype.makeEqType=function(t,e){throw new i.ElaborationError(-1,"Yeaaah.")},Type.prototype.getTypeVariables=function(t){throw void 0===t&&(t=!1),new i.ElaborationError(-1,"This is wrong.\nI said with a posed look.")},Type.prototype.getOrderedTypeVariables=function(){throw new i.ElaborationError(-1,"You seem well today.\nDid something nice happen?")},Type.prototype.replaceTypeVariables=function(t,e){throw void 0===e&&(e=new Set),new i.ElaborationError(-1,"あんたバカ?")},Type.prototype.qualify=function(t,e){return this},Type.prototype.makeFree=function(){return this},Type.prototype.simplify=function(){return this},Type.prototype.isOpaque=function(){return!1},Type.prototype.getOpaqueName=function(){return"undefined"},Type.prototype.admitsEquality=function(t){return!1},Type.prototype.normalize=function(t){void 0===t&&(t=0);for(var e=this.getOrderedTypeVariables(),n=this.getTypeVariables(!0),i=new Map,r=0,o=0,a=e;o<a.length;o++){var s=a[o];if(!i.has(s)){var u="",p=++r;if(n.has(s)&&(p=++t),p<=26)u=String.fromCharCode("a".charCodeAt(0)+p-1);else for(;p>0;){var c=--p%26;u=String.fromCharCode("a".charCodeAt(0)+c)+u,p=Math.floor(p/26)}var h="'";s.length>2&&"'"===s.charAt(1)&&(h+="'"),n.has(s)&&(h+="~"),h+=u,n.has(s)&&(h=h.toUpperCase()),i.set(s,h)}}return[this.replaceTypeVariables(i),t]},Type}();exports.Type=r;var o=function(t){function AnyType(){return t.call(this)||this}return n(AnyType,t),AnyType.prototype.toString=function(){return"any"},AnyType.prototype.equals=function(t){return!0},AnyType.prototype.instantiate=function(t,e,n){return void 0===n&&(n=new Set),this},AnyType.prototype.merge=function(t,e,n){return[n,e]},AnyType.prototype.makeEqType=function(t,e){return[this,e]},AnyType.prototype.getTypeVariables=function(t){return void 0===t&&(t=!1),new Set},AnyType.prototype.getOrderedTypeVariables=function(){return[]},AnyType.prototype.replaceTypeVariables=function(t,e){return void 0===e&&(e=new Set),this},AnyType}(r);exports.AnyType=o;var a=function(t){function TypeVariableBind(e,n,i){void 0===i&&(i=[]);var r=t.call(this)||this;return r.name=e,r.type=n,r.domain=i,r.isFree=!1,r}return n(TypeVariableBind,t),TypeVariableBind.prototype.simplify=function(){var t=new TypeVariableBind(this.name,this.type.simplify(),this.domain);return t.isFree=this.isFree,t},TypeVariableBind.prototype.makeFree=function(){var t=new TypeVariableBind(this.name,this.type.makeFree(),this.domain);return t.isFree=!0,t},TypeVariableBind.prototype.qualify=function(t,e){var n=new TypeVariableBind(this.name,this.type.qualify(t,e),this.domain);return n.isFree=this.isFree,n},TypeVariableBind.prototype.isOpaque=function(){return this.type.isOpaque()},TypeVariableBind.prototype.getOpaqueName=function(){return this.type.getOpaqueName()},TypeVariableBind.prototype.instantiate=function(t,e){var n=new TypeVariableBind(this.name,this.type.instantiate(t,e),this.domain);return n.isFree=this.isFree,n},TypeVariableBind.prototype.toString=function(){for(var t=new Set,e=new Set,n=this;n instanceof TypeVariableBind;)n.isFree?t=t.add([n.name,n.domain]):e=e.add([n.name,n.domain]),n=n.type;var i="";return e.size>0&&(i+="∀",e.forEach(function(t){if(i+=" "+t[0],t[1].length>0){i+=" ∈ {";for(var e=0;e<t[1].length;++e)e>0&&(i+=", "),i+=t[1][e];i+="}"}}),i+=" . "),i+=n,t.size>0&&(i+=",",t.forEach(function(t){if(i+=" "+t[0],t[1].length>0){i+=" ∈ {";for(var e=0;e<t[1].length;++e)e>0&&(i+=", "),i+=t[1][e];i+="}"}}),i+=" free"),i},TypeVariableBind.prototype.getTypeVariables=function(t){var e=this;void 0===t&&(t=!1);var n=this.type.getTypeVariables(t),i=new Set;return n.forEach(function(n){n===e.name&&t!==e.isFree||i.add(n)}),t&&this.isFree&&!i.has(this.name)&&i.add(this.name),i},TypeVariableBind.prototype.getOrderedTypeVariables=function(){return[this.name].concat(this.type.getOrderedTypeVariables())},TypeVariableBind.prototype.replaceTypeVariables=function(t,e){if(void 0===e&&(e=new Set),t.has(this.name)){var n=new TypeVariableBind(t.get(this.name),this.type.replaceTypeVariables(t,e));return e.has(this.name)?n.isFree=!0:n.isFree=this.isFree,n}var n=new TypeVariableBind(this.name,this.type.replaceTypeVariables(t,e));return n.isFree=this.isFree,n},TypeVariableBind.prototype.equals=function(t){return t instanceof TypeVariableBind&&t.name===this.name&&t.type.equals(this.type)},TypeVariableBind}(r);exports.TypeVariableBind=a;var s=function(t){function TypeVariable(e,n){void 0===n&&(n=0);var i=t.call(this)||this;return i.name=e,i.position=n,i.isFree=!1,i}return n(TypeVariable,t),TypeVariable.prototype.makeFree=function(){var t=new TypeVariable(this.name,this.position);return t.isFree=!0,t},TypeVariable.prototype.toString=function(){return this.name},TypeVariable.prototype.instantiate=function(t,e,n){if(void 0===n&&(n=new Set),!e.has(this.name))return this;if(n.has(this.name))throw new i.ElaborationError(-1,'Type clash. An expression of type "'+this.name+'" cannot have type "'+e.get(this.name)[0]+'" because of circularity.');var r=new Set;return n.forEach(function(t){r.add(t)}),r.add(this.name),e.get(this.name)[0].instantiate(t,e,r)},TypeVariable.prototype.merge=function(t,e,n){if(n instanceof o)return[this,e];var r=this.instantiate(t,e);if(r instanceof TypeVariable){var a=n.instantiate(t,e);if(a instanceof TypeVariable){if(r.name===a.name)return[r,e];var s=new Map,u=r;r.name<a.name?s.set(a.name,r.name):(s.set(r.name,a.name),u=a);var p=new Map;return e.forEach(function(t,e){p=p.set(e,[t[0].replaceTypeVariables(s),t[1]])}),r.name<a.name?p.set(a.name,[r,a.isFree]):p.set(r.name,[a,r.isFree]),[u,p]}if(a.getTypeVariables().has(r.name))throw new i.ElaborationError(-1,'Type clash. An expression of type "'+r.name+'" cannot have type "'+a+'" because of circularity.');if(r.isFree&&(a=a.makeFree()),r.admitsEquality(t)&&!a.admitsEquality(t)){var c=a.makeEqType(t,e);if(!c[0].admitsEquality(t))throw['Type "'+a+'" does not admit equality.',r,a];a=c[0],e=c[1]}return[a,e.set(r.name,[a,r.isFree])]}return r.merge(t,e,n)},TypeVariable.prototype.makeEqType=function(t,e){if(this.admitsEquality(t))return[this,e];if(e.has(this.name)){var n=e.get(this.name)[0].makeEqType(t,e);e=n[1];var i=new TypeVariable("'"+this.name,this.position);i.isFree=this.isFree,e=e.set(i.name,[n[0],i.isFree])}var r=new TypeVariable("'"+this.name,this.position);return[r,e.set(this.name,[r,this.isFree])]},TypeVariable.prototype.getTypeVariables=function(t){void 0===t&&(t=!1);var e=new Set;return t&&!this.isFree||e.add(this.name),e},TypeVariable.prototype.getOrderedTypeVariables=function(){return[this.name]},TypeVariable.prototype.replaceTypeVariables=function(t,e){if(void 0===e&&(e=new Set),t.has(this.name)){var n=new TypeVariable(t.get(this.name),this.position);return e.has(this.name)?n.isFree=!0:n.isFree=this.isFree,n}return this},TypeVariable.prototype.admitsEquality=function(t){return"'"===this.name[1]},TypeVariable.prototype.equals=function(t){return t instanceof o||t instanceof TypeVariable&&this.name===t.name},TypeVariable}(r);exports.TypeVariable=s;var u=function(t){function RecordType(e,n,i){void 0===n&&(n=!0),void 0===i&&(i=0);var r=t.call(this)||this;return r.elements=e,r.complete=n,r.position=i,r}return n(RecordType,t),RecordType.prototype.makeFree=function(){var t=new Map;return this.elements.forEach(function(e,n){t.set(n,e.makeFree())}),new RecordType(t,this.complete,this.position)},RecordType.prototype.instantiate=function(t,e,n){void 0===n&&(n=new Set);var i=new Map;return this.elements.forEach(function(r,o){i.set(o,r.instantiate(t,e,n))}),new RecordType(i,this.complete,this.position)},RecordType.prototype.qualify=function(t,e){var n=new Map;return this.elements.forEach(function(i,r){n.set(r,i.qualify(t,e))}),new RecordType(n,this.complete,this.position)},RecordType.prototype.merge=function(t,e,n){var i=this;if(n instanceof s||n instanceof o)return n.merge(t,e,this);if((n=n.instantiate(t,e))instanceof RecordType){if(!this.complete&&n.complete)return n.merge(t,e,this);var r=new Map,a=e;return n.elements.forEach(function(e,o){if(i.complete&&!i.elements.has(o))throw["Records don't agree on members (\""+o+'" occurs only once.)',i.instantiate(t,a),n.instantiate(t,a)];if(i.elements.has(o)){var s=e.merge(t,a,i.elements.get(o));r=r.set(o,s[0]),a=s[1]}else r=r.set(o,e.instantiate(t,a))}),n.complete&&this.elements.forEach(function(e,r){if(!n.elements.has(r))throw["Records don't agree on members (\""+r+'" occurs only once.)',i.instantiate(t,a),n.instantiate(t,a)]}),[new RecordType(r,this.complete||n.complete,this.position),a]}throw['Cannot merge "'+this.instantiate(t,e)+'" and "'+n.instantiate(t,e)+'".',this.constructor.name,n.constructor.name]},RecordType.prototype.makeEqType=function(t,e){var n=new Map;return this.elements.forEach(function(i,r){var o=i.makeEqType(t,e);n.set(r,o[0]),e=o[1]}),[new RecordType(n,this.complete,this.position),e]},RecordType.prototype.getTypeVariables=function(t){void 0===t&&(t=!1);var e=new Set;return this.elements.forEach(function(n){n.getTypeVariables(t).forEach(function(t){e.add(t)})}),e},RecordType.prototype.getOrderedTypeVariables=function(){var t=[];return this.elements.forEach(function(e){t=t.concat(e.getOrderedTypeVariables())}),t},RecordType.prototype.replaceTypeVariables=function(t,e){void 0===e&&(e=new Set);var n=new Map;return this.elements.forEach(function(i,r){n=n.set(r,i.replaceTypeVariables(t,e))}),new RecordType(n,this.complete,this.position)},RecordType.prototype.getType=function(t){if(!this.elements.has(t))throw new i.ElaborationError(0,"Tried accessing non-existing record part.");return this.elements.get(t)},RecordType.prototype.hasType=function(t){return this.elements.has(t)},RecordType.prototype.admitsEquality=function(t){var e=!0;return this.elements.forEach(function(n,i){n.admitsEquality(t)||(e=!1)}),e},RecordType.prototype.toString=function(){for(var t=!0,e=1;e<=this.elements.size;++e)this.elements.has(""+e)||(t=!1);if(t){if(0===this.elements.size)return"unit";for(var n="",e=1;e<=this.elements.size;++e){e>1&&(n+=" * ");var i=this.elements.get(""+e);n+=i instanceof p?"("+i+")":i}return n+""}var r="{",o=!0;return this.elements.forEach(function(t,e){o?o=!1:r+=", ",r+=e+": "+t}),this.complete||(o||(r+=", "),r+="..."),r+"}"},RecordType.prototype.simplify=function(){var t=new Map;return this.elements.forEach(function(e,n){t.set(n,e.simplify())}),new RecordType(t,this.complete,this.position)},RecordType.prototype.equals=function(t){if(t instanceof o)return!0;if(!(t instanceof RecordType&&this.complete===t.complete))return!1;if(t===this)return!0;for(var e in this.elements)if(!this.elements.hasOwnProperty(e)&&!this.elements.get(e).equals(t.elements.get(e)))return!1;for(var n in t.elements)if(!t.elements.hasOwnProperty(n)&&!t.elements.get(n).equals(this.elements.get(n)))return!1;return!0},RecordType}(r);exports.RecordType=u;var p=function(t){function FunctionType(e,n,i){void 0===i&&(i=0);var r=t.call(this)||this;return r.parameterType=e,r.returnType=n,r.position=i,r}return n(FunctionType,t),FunctionType.prototype.makeFree=function(){return new FunctionType(this.parameterType.makeFree(),this.returnType.makeFree())},FunctionType.prototype.instantiate=function(t,e,n){return void 0===n&&(n=new Set),new FunctionType(this.parameterType.instantiate(t,e,n),this.returnType.instantiate(t,e,n),this.position)},FunctionType.prototype.qualify=function(t,e){return new FunctionType(this.parameterType.qualify(t,e),this.returnType.qualify(t,e),this.position)},FunctionType.prototype.merge=function(t,e,n){if(n instanceof s||n instanceof o)return n.merge(t,e,this);if(n instanceof FunctionType){var i=this.parameterType.merge(t,e,n.parameterType),r=this.returnType.merge(t,i[1],n.returnType);return[new FunctionType(i[0],r[0],this.position),r[1]]}throw['Cannot merge "'+this.instantiate(t,e)+'" and "'+n.instantiate(t,e)+'".',this.constructor.name,n.constructor.name]},FunctionType.prototype.makeEqType=function(t,e){return[this,e]},FunctionType.prototype.getTypeVariables=function(t){void 0===t&&(t=!1);var e=new Set;return this.parameterType.getTypeVariables(t).forEach(function(t){e.add(t)}),this.returnType.getTypeVariables(t).forEach(function(t){e.add(t)}),e},FunctionType.prototype.getOrderedTypeVariables=function(){var t=[];return t=t.concat(this.parameterType.getOrderedTypeVariables()),t=t.concat(this.returnType.getOrderedTypeVariables())},FunctionType.prototype.replaceTypeVariables=function(t,e){return void 0===e&&(e=new Set),new FunctionType(this.parameterType.replaceTypeVariables(t,e),this.returnType.replaceTypeVariables(t,e),this.position)},FunctionType.prototype.admitsEquality=function(t){return!1},FunctionType.prototype.toString=function(){return this.parameterType instanceof FunctionType?"("+this.parameterType+") → "+this.returnType:this.parameterType+" → "+this.returnType},FunctionType.prototype.simplify=function(){return new FunctionType(this.parameterType.simplify(),this.returnType.simplify(),this.position)},FunctionType.prototype.equals=function(t){return t instanceof o||t instanceof FunctionType&&this.parameterType.equals(t.parameterType)&&this.returnType.equals(t.returnType)},FunctionType}(r);exports.FunctionType=p;var c=function(t){function CustomType(e,n,i,r,o){void 0===n&&(n=[]),void 0===i&&(i=0),void 0===r&&(r=void 0),void 0===o&&(o=!1);var a=t.call(this)||this;return a.name=e,a.typeArguments=n,a.position=i,a.qualifiedName=r,a.opaque=o,a}return n(CustomType,t),CustomType.prototype.isOpaque=function(){return this.opaque},CustomType.prototype.getOpaqueName=function(){return this.isOpaque?this.name:"undefined"},CustomType.prototype.makeFree=function(){for(var t=[],e=0;e<this.typeArguments.length;++e)t.push(this.typeArguments[e].makeFree());return new CustomType(this.name,t,this.position,this.qualifiedName,this.opaque)},CustomType.prototype.qualify=function(t,e){for(var n=[],i=0;i<this.typeArguments.length;++i)n.push(this.typeArguments[i].qualify(t,e));var r=new CustomType(this.name,n,this.position,this.qualifiedName,this.opaque);return void 0!==t.getStaticType(this.name)&&(r.qualifiedName=e),r},CustomType.prototype.instantiate=function(t,e,n){void 0===n&&(n=new Set);var r=t.getStaticType(this.name);if(void 0!==this.qualifiedName){var o=t.getAndResolveStaticStructure(this.qualifiedName);r=void 0!==o?o.getType(this.name):void 0}if(void 0!==r&&r.type instanceof p)try{var a=this.merge(t,e,r.type.parameterType,!0);return r.type.returnType.instantiate(t,a[1],n)}catch(t){if(!(t instanceof Array))throw t;throw new i.ElaborationError(-1,'Instantiating "'+this+'" failed: '+t[0])}else{if(void 0===r)throw new i.ElaborationError(-1,'Unbound type "'+this.name+'".');if(void 0!==r&&r.type.isOpaque())this.opaque=!0;else if(!(void 0===r||r.type instanceof CustomType&&this.typeArguments.length===r.type.typeArguments.length))throw new i.ElaborationError(this.position,"Arity mismatch: "+this+" vs "+r.type+".")}for(var s=[],u=0;u<this.typeArguments.length;++u)s.push(this.typeArguments[u].instantiate(t,e,n));return new CustomType(this.name,s,this.position,this.qualifiedName,this.opaque)},CustomType.prototype.merge=function(t,e,n,i){if(void 0===i&&(i=!1),n instanceof s||n instanceof o)return n.merge(t,e,this);var r=this,a=n;if(!i){if(!((r=this.instantiate(t,e))instanceof CustomType))return r.merge(t,e,n);a=n.instantiate(t,e)}var u=r;if(a instanceof CustomType&&u.name===a.name&&u.typeArguments.length===a.typeArguments.length){var p=!(void 0!==u.qualifiedName&&void 0===a.qualifiedName||void 0===u.qualifiedName&&void 0!==a.qualifiedName);if(void 0!==u.qualifiedName)if(u.qualifiedName.qualifiers.length===a.qualifiedName.qualifiers.length){for(var c=0;c<u.qualifiedName.qualifiers.length;++c)if(u.qualifiedName.qualifiers[c].getText()!==a.qualifiedName.qualifiers[c].getText()){p=!1;break}}else p=!1;if(p){for(var h=[],f=e,c=0;c<r.typeArguments.length;++c){var l=r.typeArguments[c].merge(t,f,a.typeArguments[c]);h.push(l[0]),f=l[1]}return[new CustomType(u.name,h,u.position,u.qualifiedName,u.opaque),f]}}throw['Cannot merge "'+this.instantiate(t,e)+'" and "'+n.instantiate(t,e)+'".',this.constructor.name,n.constructor.name]},CustomType.prototype.makeEqType=function(t,e){for(var n=[],i=0;i<this.typeArguments.length;++i){var r=this.typeArguments[i].makeEqType(t,e);n.push(r[0]),e=r[1]}return[new CustomType(this.name,n,this.position,this.qualifiedName,this.opaque),e]},CustomType.prototype.getTypeVariables=function(t){void 0===t&&(t=!1);var e=new Set;if(this.typeArguments.length>0)for(var n=0;n<this.typeArguments.length;++n)this.typeArguments[n].getTypeVariables(t).forEach(function(t){e.add(t)});return e},CustomType.prototype.getOrderedTypeVariables=function(){for(var t=[],e=0;e<this.typeArguments.length;++e)t=t.concat(this.typeArguments[e].getOrderedTypeVariables());return t},CustomType.prototype.replaceTypeVariables=function(t,e){void 0===t&&(t=new Map),void 0===e&&(e=new Set);for(var n=[],i=0;i<this.typeArguments.length;++i)n.push(this.typeArguments[i].replaceTypeVariables(t,e));return new CustomType(this.name,n,this.position,this.qualifiedName,this.opaque)},CustomType.prototype.admitsEquality=function(t){for(var e=0;e<this.typeArguments.length;++e)if(!this.typeArguments[e].admitsEquality(t))return!1;return!0},CustomType.prototype.toString=function(){var t="";(this.typeArguments.length>1||1===this.typeArguments.length&&(this.typeArguments[0]instanceof p||this.typeArguments[0]instanceof u))&&(t+="(");for(var e=0;e<this.typeArguments.length;++e)e>0&&(t+=", "),t+=this.typeArguments[e];if((this.typeArguments.length>1||1===this.typeArguments.length&&(this.typeArguments[0]instanceof p||this.typeArguments[0]instanceof u))&&(t+=")"),this.typeArguments.length>0&&(t+=" "),void 0!==this.qualifiedName)for(var e=0;e<this.qualifiedName.qualifiers.length;++e)t+=this.qualifiedName.qualifiers[e].getText()+".";return t+=this.name},CustomType.prototype.simplify=function(){for(var t=[],e=0;e<this.typeArguments.length;++e)t.push(this.typeArguments[e].simplify());return new CustomType(this.name,t,this.position,this.qualifiedName,this.opaque)},CustomType.prototype.equals=function(t){if(t instanceof o)return!0;if(!(t instanceof CustomType)||this.name!==t.name)return!1;for(var e=0;e<this.typeArguments.length;++e)if(!this.typeArguments[e].equals(t.typeArguments[e]))return!1;return!0},CustomType}(r);exports.CustomType=c;var h=function(t){function TupleType(e,n){void 0===n&&(n=0);var i=t.call(this)||this;return i.elements=e,i.position=n,i}return n(TupleType,t),TupleType.prototype.toString=function(){for(var t="(",e=0;e<this.elements.length;++e)e>0&&(t+=" * "),t+=this.elements[e];return t+")"},TupleType.prototype.simplify=function(){for(var t=new Map,e=0;e<this.elements.length;++e)t.set(""+(e+1),this.elements[e].simplify());return new u(t,!0,this.position)},TupleType.prototype.equals=function(t){return this.simplify().equals(t)},TupleType}(r);exports.TupleType=h},function(t,exports,e){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var i=e(2),r=e(0),o=e(1),a=function(){function Value(){}return Value.prototype.equals=function(t){throw new r.InternalInterpreterError(-1,"Tried comparing incomparable things.")},Value}();exports.Value=a;var s=function(t){function ReferenceValue(e){var n=t.call(this)||this;return n.address=e,n}return n(ReferenceValue,t),ReferenceValue.prototype.equals=function(t){return this.address===t.address},ReferenceValue.prototype.toString=function(t){if(void 0===t)return"$"+this.address;if(void 0!==t.getCell(this.address))return"ref "+t.getCell(this.address).toString(t);throw new r.EvaluationError(-1,'Ouch, you may not de-reference "$'+this.address+'".')},ReferenceValue}(a);exports.ReferenceValue=s;var u=function(t){function BoolValue(e){var n=t.call(this)||this;return n.value=e,n}return n(BoolValue,t),BoolValue.prototype.equals=function(t){return this.value===t.value},BoolValue.prototype.toString=function(t){return this.value?"true":"false"},BoolValue}(a);exports.BoolValue=u;var p=function(t){function CharValue(e){var n=t.call(this)||this;return n.value=e,n}return n(CharValue,t),CharValue.prototype.toString=function(t){return"#"+new c(this.value).toString(t)},CharValue.prototype.compareTo=function(t){return this.value<t.value?-1:this.value>t.value?1:0},CharValue.prototype.equals=function(t){return this.value===t.value},CharValue}(a);exports.CharValue=p;var c=function(t){function StringValue(e){var n=t.call(this)||this;return n.value=e,n}return n(StringValue,t),StringValue.implode=function(t){for(var e="";"nil"!==t.constructorName;){if("::"!==t.constructorName)throw new r.InternalInterpreterError(-1,"Is this a char list? I can't implode \""+t.constructorName+'".');var n=t.argument;if(!(n instanceof d))throw new r.InternalInterpreterError(-1,"Is this a char list? I can't implode \""+t.constructorName+'".');var i=n.getValue("1"),o=n.getValue("2");if(!(i instanceof p&&o instanceof v))throw new r.InternalInterpreterError(-1,"Is this a char list? I can't implode \""+t.constructorName+'".');e+=i.value,t=o}return new StringValue(e)},StringValue.prototype.toString=function(t){for(var e="",n=0,i=this.value;n<i.length;n++){var r=i[n];switch(r){case"\n":e+="\\n";break;case"\t":e+="\\t";break;case"\r":e+="\\r";break;case"":e+="\\a";break;case"\b":e+="\\b";break;case"\v":e+="\\v";break;case"\f":e+="\\f";break;case"":e+="\\127";break;case"ÿ":e+="\\255";break;default:r.charCodeAt(0)<32?e+="\\^"+String.fromCharCode(r.charCodeAt(0)+64):e+=r}}return'"'+e+'"'},StringValue.prototype.equals=function(t){return this.value===t.value},StringValue.prototype.compareTo=function(t){return this.value<t.value?-1:this.value>t.value?1:0},StringValue.prototype.concat=function(t){return new StringValue(this.value+t.value)},StringValue.prototype.explode=function(){for(var t=new v("nil"),e=this.value.length-1;e>=0;--e)t=new v("::",new d(new Map([["1",new p(this.value[e])],["2",t]])));return t},StringValue}(a);exports.StringValue=c;var h=function(t){function Word(e){var n=t.call(this)||this;return n.value=e,n}return n(Word,t),Word.prototype.toString=function(t){return""+this.value},Word.prototype.compareTo=function(t){if(t instanceof Word){var e=t.value;return this.value<e?-1:this.value>e?1:0}return 2},Word.prototype.negate=function(){return new Word(-this.value)},Word.prototype.equals=function(t){return 0===this.compareTo(t)},Word.prototype.add=function(t){return new Word(this.value+t.value)},Word.prototype.multiply=function(t){return new Word(this.value*t.value)},Word.prototype.divide=function(t){return new Word(Math.floor(this.value/t.value))},Word.prototype.modulo=function(t){return new Word(this.value%t.value)},Word.prototype.toReal=function(){return new l(this.value)},Word.prototype.hasOverflow=function(){return this.value>1073741823||this.value<-1073741824},Word}(a);exports.Word=h;var f=function(t){function Integer(e){var n=t.call(this)||this;return n.value=e,n}return n(Integer,t),Integer.prototype.toString=function(t){return""+this.value},Integer.prototype.compareTo=function(t){if(t instanceof Integer){var e=t.value;return this.value<e?-1:this.value>e?1:0}return!1},Integer.prototype.equals=function(t){return 0===this.compareTo(t)},Integer.prototype.negate=function(){return new Integer(-this.value)},Integer.prototype.add=function(t){return new Integer(this.value+t.value)},Integer.prototype.multiply=function(t){return new Integer(this.value*t.value)},Integer.prototype.divide=function(t){return new Integer(Math.floor(this.value/t.value))},Integer.prototype.modulo=function(t){return new Integer(this.value%t.value)},Integer.prototype.toReal=function(){return new l(this.value)},Integer.prototype.hasOverflow=function(){return this.value>1073741823||this.value<-1073741824},Integer}(a);exports.Integer=f;var l=function(t){function Real(e){var n=t.call(this)||this;return n.value=e,n}return n(Real,t),Real.prototype.toString=function(t){var e=""+this.value;return-1===e.search(/\./)&&(e+=".0"),e},Real.prototype.compareTo=function(t){if(t instanceof Real){var e=t.value;return this.value<e?-1:this.value>e?1:0}return!1},Real.prototype.equals=function(t){return 0===this.compareTo(t)},Real.prototype.negate=function(){return new Real(-this.value)},Real.prototype.add=function(t){return new Real(this.value+t.value)},Real.prototype.multiply=function(t){return new Real(this.value*t.value)},Real.prototype.divide=function(t){return new Real(this.value/t.value)},Real.prototype.toInteger=function(){return new f(Math.floor(this.value))},Real.prototype.hasOverflow=function(){return!1},Real}(a);exports.Real=l;var d=function(t){function RecordValue(e){void 0===e&&(e=new Map);var n=t.call(this)||this;return n.entries=e,n}return n(RecordValue,t),RecordValue.prototype.toString=function(t){for(var e=!0,n=1;n<=this.entries.size;++n)this.entries.has(""+n)||(e=!1);if(e){for(var i="(",n=1;n<=this.entries.size;++n){n>1&&(i+=", ");var o=this.entries.get(""+n);if(void 0===o)throw new r.InternalInterpreterError(-1,"How did we loose this value? It was there before. I promise…");i+=o.toString(t)}return i+")"}var a="{ ",s=!0;return this.entries.forEach(function(e,n){s?s=!1:a+=", ",a+=n+" = "+e.toString(t)}),a+" }"},RecordValue.prototype.getValue=function(t){if(!this.entries.has(t))throw new r.EvaluationError(0,"Tried accessing non-existing record part.");return this.entries.get(t)},RecordValue.prototype.hasValue=function(t){return this.entries.has(t)},RecordValue.prototype.equals=function(t){var e=this;if(!(t instanceof RecordValue))return!1;var n=!1;return this.entries.forEach(function(e,i){t.entries.has(i)||(n=!0),e.equals(t.entries.get(i))||(n=!0)}),!n&&(t.entries.forEach(function(i,r){e.entries.has(r)||(n=!0),i.equals(t.entries.get(r))||(n=!0)}),!n)},RecordValue}(a);exports.RecordValue=d;var y=function(t){function FunctionValue(e,n,i){var r=t.call(this)||this;return r.state=e,r.recursives=n,r.body=i,r}return n(FunctionValue,t),FunctionValue.prototype.toString=function(t){return"fn"},FunctionValue.prototype.compute=function(t,e){for(var n=this.state.getNestedState(this.state.id),r=0;r<this.recursives.length;++r)this.recursives[r][1]instanceof FunctionValue?n.setDynamicValue(this.recursives[r][0],new FunctionValue(this.state,this.recursives,this.recursives[r][1].body),i.IdentifierStatus.VALUE_VARIABLE):n.setDynamicValue(this.recursives[r][0],this.recursives[r][1],i.IdentifierStatus.VALUE_VARIABLE);for(var r=0;r<e.length;++r)n.setCell(e[r][0],e[r][1]);return this.body.compute(n,t)},FunctionValue.prototype.equals=function(t){throw new r.InternalInterpreterError(-1,'You simply cannot compare "'+this.toString(void 0)+'" and "'+t.toString(void 0)+'".')},FunctionValue}(a);exports.FunctionValue=y;var v=function(t){function ConstructedValue(e,n,i){void 0===n&&(n=void 0),void 0===i&&(i=0);var r=t.call(this)||this;return r.constructorName=e,r.argument=n,r.id=i,r}return n(ConstructedValue,t),ConstructedValue.prototype.toString=function(t){if("::"===this.constructorName){for(var e="[",n=this;"nil"!==n.constructorName;){if("::"!==n.constructorName)throw new r.InternalInterpreterError(-1,'Is this even a list? 1 "'+n.constructorName+'".');var i=n.argument;if(!(i instanceof d&&2===i.entries.size))throw new r.InternalInterpreterError(-1,'Is this even a list? 3 "'+n.constructorName+'".');var s=i.getValue("1"),u=i.getValue("2");if(!(s instanceof a&&u instanceof ConstructedValue))throw new r.InternalInterpreterError(-1,'Is this even a list? 2 "'+n.constructorName+'".');n!==this&&(e+=", "),e+=s.toString(t),n=u}return e+"]"}if("nil"===this.constructorName)return"[]";if(void 0!==t){var p=t.getInfixStatus(new o.IdentifierToken(this.constructorName,-1));if(void 0!==p&&p.infix&&this.argument instanceof d&&2===this.argument.entries.size){var c=this.argument.getValue("1"),h=this.argument.getValue("2");if(c instanceof a&&h instanceof a){var e="("+c.toString(t);return e+=" "+this.constructorName,this.id>0&&(e+="/"+this.id),(e+=" "+h.toString(t))+")"}}}var f=this.constructorName;return this.id>0&&(f+="/"+this.id),this.argument&&(f+=" "+this.argument.toString(t)),f},ConstructedValue.prototype.equals=function(t){return t instanceof m&&(t=t.construct()),t instanceof ConstructedValue&&(this.constructorName===t.constructorName&&this.id===t.id&&(void 0!==this.argument?void 0===t.argument||this.argument.equals(t.argument):void 0===t.argument))},ConstructedValue}(a);exports.ConstructedValue=v;var T=function(t){function ExceptionValue(e,n,i){void 0===n&&(n=void 0),void 0===i&&(i=0);var r=t.call(this)||this;return r.constructorName=e,r.argument=n,r.id=i,r}return n(ExceptionValue,t),ExceptionValue.prototype.toString=function(t){var e=this.constructorName;return this.id>0&&(e+="/"+this.id),this.argument&&(e+=" "+this.argument.toString(t)),e},ExceptionValue.prototype.equals=function(t){return t instanceof w&&(t=t.construct()),t instanceof ExceptionValue&&(this.constructorName===t.constructorName&&this.id===t.id&&(void 0!==this.argument?void 0===t.argument||this.argument.equals(t.argument):void 0===t.argument))},ExceptionValue}(a);exports.ExceptionValue=T;var g=function(t){function PredefinedFunction(e,n){var i=t.call(this)||this;return i.name=e,i.apply=n,i}return n(PredefinedFunction,t),PredefinedFunction.prototype.toString=function(t){return"fn"},PredefinedFunction.prototype.equals=function(t){return t instanceof PredefinedFunction&&this.name===t.name},PredefinedFunction}(a);exports.PredefinedFunction=g;var m=function(t){function ValueConstructor(e,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var r=t.call(this)||this;return r.constructorName=e,r.numArgs=n,r.id=i,r}return n(ValueConstructor,t),ValueConstructor.prototype.equals=function(t){return t instanceof ValueConstructor&&(this.constructorName===t.constructorName&&this.id===t.id)},ValueConstructor.prototype.construct=function(t){return void 0===t&&(t=void 0),new v(this.constructorName,t,this.id)},ValueConstructor.prototype.toString=function(t){var e=this.constructorName;return this.id>0&&(e+="/"+this.id),e},ValueConstructor}(a);exports.ValueConstructor=m;var w=function(t){function ExceptionConstructor(e,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var r=t.call(this)||this;return r.exceptionName=e,r.numArgs=n,r.id=i,r}return n(ExceptionConstructor,t),ExceptionConstructor.prototype.equals=function(t){return t instanceof ExceptionConstructor&&(this.exceptionName===t.exceptionName&&this.id===t.id)},ExceptionConstructor.prototype.construct=function(t){return void 0===t&&(t=void 0),new T(this.exceptionName,t,this.id)},ExceptionConstructor.prototype.toString=function(t){var e=this.exceptionName;return this.id>0&&(e+="/"+this.id),e},ExceptionConstructor}(a);exports.ExceptionConstructor=w},function(t,exports,e){"use strict";function functionType(t){return new i.FunctionType(new i.TupleType([t,t]),t).simplify()}function bfunctionType(t){return new i.FunctionType(new i.TupleType([t,t]),s).simplify()}function intWordBind(t){return new i.TypeVariableBind("'iw",t,[new i.CustomType("int"),new i.CustomType("word")])}function intRealBind(t){return new i.TypeVariableBind("'ir",t,[new i.CustomType("int"),new i.CustomType("real")])}function intWordRealBind(t){return new i.TypeVariableBind("'iwr",t,[new i.CustomType("int"),new i.CustomType("word"),new i.CustomType("real")])}function anyBind(t){return new i.TypeVariableBind("'any",t,[new i.CustomType("int"),new i.CustomType("word"),new i.CustomType("real"),new i.CustomType("string"),new i.CustomType("char")])}function getInitialState(){return v.getNestedState()}Object.defineProperty(exports,"__esModule",{value:!0});var n=e(2),i=e(3),r=e(4),o=e(0),a=new i.CustomType("real"),s=new i.CustomType("bool"),u=new i.CustomType("string"),p=new i.CustomType("char"),c=new i.TypeVariable("'a"),h=new i.TypeVariable("''b"),f=new i.TypeVariable("'iw"),l=new i.TypeVariable("'ir"),d=new i.TypeVariable("'iwr"),y=new i.TypeVariable("'any"),v=new n.State(0,void 0,new n.StaticBasis({unit:new n.TypeInformation(new i.FunctionType(new i.CustomType("unit"),new i.TupleType([])).simplify(),[],0,!0),bool:new n.TypeInformation(new i.CustomType("bool"),["true","false"],0,!0),int:new n.TypeInformation(new i.CustomType("int"),[],0,!0),word:new n.TypeInformation(new i.CustomType("word"),[],0,!0),real:new n.TypeInformation(new i.CustomType("real"),[],0,!1),string:new n.TypeInformation(new i.CustomType("string"),[],0,!1),char:new n.TypeInformation(new i.CustomType("char"),[],0,!1),list:new n.TypeInformation(new i.CustomType("list",[c]),["nil","::"],1,!0),array:new n.TypeInformation(new i.CustomType("array",[c]),[],1,!0),ref:new n.TypeInformation(new i.CustomType("ref",[c]),["ref"],1,!0),exn:new n.TypeInformation(new i.CustomType("exn"),[],0,!1)},{div:[intWordBind(functionType(f)),n.IdentifierStatus.VALUE_VARIABLE],mod:[intWordBind(functionType(f)),n.IdentifierStatus.VALUE_VARIABLE],"*":[intWordRealBind(functionType(d)),n.IdentifierStatus.VALUE_VARIABLE],"/":[functionType(a),n.IdentifierStatus.VALUE_VARIABLE],"+":[intWordRealBind(functionType(d)),n.IdentifierStatus.VALUE_VARIABLE],"-":[intWordRealBind(functionType(d)),n.IdentifierStatus.VALUE_VARIABLE],"<":[anyBind(bfunctionType(y)),n.IdentifierStatus.VALUE_VARIABLE],"<=":[anyBind(bfunctionType(y)),n.IdentifierStatus.VALUE_VARIABLE],">":[anyBind(bfunctionType(y)),n.IdentifierStatus.VALUE_VARIABLE],">=":[anyBind(bfunctionType(y)),n.IdentifierStatus.VALUE_VARIABLE],"=":[new i.TypeVariableBind("''b",new i.FunctionType(new i.TupleType([h,h]),s)).simplify(),n.IdentifierStatus.VALUE_VARIABLE],"<>":[new i.TypeVariableBind("''b",new i.FunctionType(new i.TupleType([h,h]),s)).simplify(),n.IdentifierStatus.VALUE_VARIABLE],true:[new i.CustomType("bool"),n.IdentifierStatus.VALUE_CONSTRUCTOR],false:[new i.CustomType("bool"),n.IdentifierStatus.VALUE_CONSTRUCTOR],nil:[new i.TypeVariableBind("'a",new i.CustomType("list",[c])),n.IdentifierStatus.VALUE_CONSTRUCTOR],"::":[new i.TypeVariableBind("'a",new i.FunctionType(new i.TupleType([c,new i.CustomType("list",[c])]),new i.CustomType("list",[c]))).simplify(),n.IdentifierStatus.VALUE_CONSTRUCTOR],Match:[new i.CustomType("exn"),n.IdentifierStatus.EXCEPTION_CONSTRUCTOR],Bind:[new i.CustomType("exn"),n.IdentifierStatus.EXCEPTION_CONSTRUCTOR],Div:[new i.CustomType("exn"),n.IdentifierStatus.EXCEPTION_CONSTRUCTOR],Overflow:[new i.CustomType("exn"),n.IdentifierStatus.EXCEPTION_CONSTRUCTOR],"^":[functionType(u),n.IdentifierStatus.VALUE_VARIABLE],explode:[new i.FunctionType(u,new i.CustomType("list",[p])).simplify(),n.IdentifierStatus.VALUE_VARIABLE],implode:[new i.FunctionType(new i.CustomType("list",[p]),u).simplify(),n.IdentifierStatus.VALUE_VARIABLE],"~":[intRealBind(new i.FunctionType(l,l)),n.IdentifierStatus.VALUE_VARIABLE],abs:[intRealBind(new i.FunctionType(l,l)),n.IdentifierStatus.VALUE_VARIABLE],print:[new i.TypeVariableBind("'a",new i.FunctionType(c,new i.TupleType([]))).simplify(),n.IdentifierStatus.VALUE_VARIABLE],printLn:[new i.TypeVariableBind("'a",new i.FunctionType(c,new i.TupleType([]))).simplify(),n.IdentifierStatus.VALUE_VARIABLE],":=":[new i.TypeVariableBind("'a",new i.FunctionType(new i.TupleType([new i.CustomType("ref",[c]),c]),new i.TupleType([]))).simplify(),n.IdentifierStatus.VALUE_VARIABLE],ref:[new i.TypeVariableBind("'a",new i.FunctionType(c,new i.CustomType("ref",[c]))),n.IdentifierStatus.VALUE_CONSTRUCTOR],"!":[new i.TypeVariableBind("'a",new i.FunctionType(new i.CustomType("ref",[c]),c)),n.IdentifierStatus.VALUE_VARIABLE]},{},{},{}),new n.DynamicBasis({unit:[],bool:["true","false"],int:[],word:[],real:[],string:[],char:[],list:["nil","::"],array:[],ref:["ref"],exn:[]},{div:[new r.PredefinedFunction("div",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Integer&&n instanceof r.Integer)return 0===n.value?[new r.ExceptionConstructor("Div").construct(),!0,[]]:[e.divide(n),!1,[]];if(e instanceof r.Word&&n instanceof r.Word)return 0===n.value?[new r.ExceptionConstructor("Div").construct(),!0,[]]:[e.divide(n),!1,[]]}throw new o.InternalInterpreterError(-1,'Called "div" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],mod:[new r.PredefinedFunction("mod",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Integer&&n instanceof r.Integer)return 0===n.value?[new r.ExceptionConstructor("Div").construct(),!0,[]]:[e.modulo(n),!1,[]];if(e instanceof r.Word&&n instanceof r.Word)return 0===n.value?[new r.ExceptionConstructor("Div").construct(),!0,[]]:[e.modulo(n),!1,[]]}throw new o.InternalInterpreterError(-1,'Called "mod" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],"*":[new r.PredefinedFunction("*",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Integer&&n instanceof r.Integer){var i=e.multiply(n);return i.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[i,!1,[]]}if(e instanceof r.Word&&n instanceof r.Word){var i=e.multiply(n);return i.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[i,!1,[]]}if(e instanceof r.Real&&n instanceof r.Real){var i=e.multiply(n);return i.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[i,!1,[]]}}throw new o.InternalInterpreterError(-1,'Called "*" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],"/":[new r.PredefinedFunction("/",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Real&&n instanceof r.Real)return 0===n.value?[new r.ExceptionConstructor("Div").construct(),!0,[]]:[e.divide(n),!1,[]]}throw new o.InternalInterpreterError(-1,'Called "/" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],"+":[new r.PredefinedFunction("+",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Integer&&n instanceof r.Integer){var i=e.add(n);return i.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[i,!1,[]]}if(e instanceof r.Word&&n instanceof r.Word){var i=e.add(n);return i.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[i,!1,[]]}if(e instanceof r.Real&&n instanceof r.Real){var i=e.add(n);return i.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[i,!1,[]]}}throw new o.InternalInterpreterError(-1,'Called "+" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],"-":[new r.PredefinedFunction("-",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Integer&&n instanceof r.Integer){var i=e.add(n.negate());return i.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[i,!1,[]]}if(e instanceof r.Word&&n instanceof r.Word){var i=e.add(n.negate());return i.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[i,!1,[]]}if(e instanceof r.Real&&n instanceof r.Real){var i=e.add(n.negate());return i.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[i,!1,[]]}}throw new o.InternalInterpreterError(-1,'Called "-" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],"<":[new r.PredefinedFunction("<",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Integer&&n instanceof r.Integer)return[new r.BoolValue(e.compareTo(n)<0),!1,[]];if(e instanceof r.Word&&n instanceof r.Word)return[new r.BoolValue(e.compareTo(n)<0),!1,[]];if(e instanceof r.Real&&n instanceof r.Real)return[new r.BoolValue(e.compareTo(n)<0),!1,[]];if(e instanceof r.StringValue&&n instanceof r.StringValue)return[new r.BoolValue(e.compareTo(n)<0),!1,[]];if(e instanceof r.CharValue&&n instanceof r.CharValue)return[new r.BoolValue(e.compareTo(n)<0),!1,[]]}throw new o.InternalInterpreterError(-1,'Called "<" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],">":[new r.PredefinedFunction("<",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Integer&&n instanceof r.Integer)return[new r.BoolValue(e.compareTo(n)>0),!1,[]];if(e instanceof r.Word&&n instanceof r.Word)return[new r.BoolValue(e.compareTo(n)>0),!1,[]];if(e instanceof r.Real&&n instanceof r.Real)return[new r.BoolValue(e.compareTo(n)>0),!1,[]];if(e instanceof r.StringValue&&n instanceof r.StringValue)return[new r.BoolValue(e.compareTo(n)>0),!1,[]];if(e instanceof r.CharValue&&n instanceof r.CharValue)return[new r.BoolValue(e.compareTo(n)>0),!1,[]]}throw new o.InternalInterpreterError(-1,'Called ">" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],"<=":[new r.PredefinedFunction("<",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Integer&&n instanceof r.Integer)return[new r.BoolValue(e.compareTo(n)<=0),!1,[]];if(e instanceof r.Word&&n instanceof r.Word)return[new r.BoolValue(e.compareTo(n)<=0),!1,[]];if(e instanceof r.Real&&n instanceof r.Real)return[new r.BoolValue(e.compareTo(n)<=0),!1,[]];if(e instanceof r.StringValue&&n instanceof r.StringValue)return[new r.BoolValue(e.compareTo(n)<=0),!1,[]];if(e instanceof r.CharValue&&n instanceof r.CharValue)return[new r.BoolValue(e.compareTo(n)<=0),!1,[]]}throw new o.InternalInterpreterError(-1,'Called "<=" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],">=":[new r.PredefinedFunction("<",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Integer&&n instanceof r.Integer)return[new r.BoolValue(e.compareTo(n)>=0),!1,[]];if(e instanceof r.Word&&n instanceof r.Word)return[new r.BoolValue(e.compareTo(n)>=0),!1,[]];if(e instanceof r.Real&&n instanceof r.Real)return[new r.BoolValue(e.compareTo(n)>=0),!1,[]];if(e instanceof r.StringValue&&n instanceof r.StringValue)return[new r.BoolValue(e.compareTo(n)>=0),!1,[]];if(e instanceof r.CharValue&&n instanceof r.CharValue)return[new r.BoolValue(e.compareTo(n)>=0),!1,[]]}throw new o.InternalInterpreterError(-1,'Called ">=" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],"=":[new r.PredefinedFunction("=",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");return[new r.BoolValue(e.equals(n)),!1,[]]}throw new o.InternalInterpreterError(-1,'Called "=" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],"<>":[new r.PredefinedFunction("=",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");return[new r.BoolValue(!e.equals(n)),!1,[]]}throw new o.InternalInterpreterError(-1,'Called "<>" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],true:[new r.BoolValue(!0),n.IdentifierStatus.VALUE_CONSTRUCTOR],false:[new r.BoolValue(!1),n.IdentifierStatus.VALUE_CONSTRUCTOR],nil:[new r.ValueConstructor("nil").construct(),n.IdentifierStatus.VALUE_CONSTRUCTOR],"::":[new r.ValueConstructor("::",1),n.IdentifierStatus.VALUE_CONSTRUCTOR],Match:[new r.ExceptionConstructor("Match").construct(),n.IdentifierStatus.EXCEPTION_CONSTRUCTOR],Bind:[new r.ExceptionConstructor("Bind").construct(),n.IdentifierStatus.EXCEPTION_CONSTRUCTOR],Div:[new r.ExceptionConstructor("Div").construct(),n.IdentifierStatus.EXCEPTION_CONSTRUCTOR],Overflow:[new r.ExceptionConstructor("Overflow").construct(),n.IdentifierStatus.EXCEPTION_CONSTRUCTOR],"^":[new r.PredefinedFunction("^",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.StringValue&&n instanceof r.StringValue)return[e.concat(n),!1,[]]}throw new o.InternalInterpreterError(-1,'Called "^" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],explode:[new r.PredefinedFunction("explode",function(t){if(t instanceof r.StringValue)return[t.explode(),!1,[]];throw new o.InternalInterpreterError(-1,'Called "explode" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],implode:[new r.PredefinedFunction("implode",function(t){if(t instanceof r.ConstructedValue)return[r.StringValue.implode(t),!1,[]];throw new o.InternalInterpreterError(-1,'Called "explode" on value of the wrong type ('+t.constructor.name+").")}),n.IdentifierStatus.VALUE_VARIABLE],"~":[new r.PredefinedFunction("~",function(t){if(t instanceof r.Integer){var e=t.negate();return e.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[e,!1,[]]}if(t instanceof r.Real){var e=t.negate();return e.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[e,!1,[]]}throw new o.InternalInterpreterError(-1,'Called "~" on something weird.')}),n.IdentifierStatus.VALUE_VARIABLE],abs:[new r.PredefinedFunction("~",function(t){if(t instanceof r.Integer){if(t.value>=0)return[t,!1,[]];var e=t.negate();return e.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[e,!1,[]]}if(t instanceof r.Real){if(t.value>=0)return[t,!1,[]];var e=t.negate();return e.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[e,!1,[]]}throw new o.InternalInterpreterError(-1,'Called "~" on something weird.')}),n.IdentifierStatus.VALUE_VARIABLE],print:[new r.PredefinedFunction("print",function(t){var e=[];return t instanceof r.StringValue?e.push(new o.Warning(-1,t.value)):e.push(new o.Warning(-1,t.toString(void 0))),[new r.RecordValue,!1,e]}),n.IdentifierStatus.VALUE_VARIABLE],printLn:[new r.PredefinedFunction("printLn",function(t){var e=[];return t instanceof r.StringValue?e.push(new o.Warning(-1,t.value+"\n")):e.push(new o.Warning(-1,t.toString(void 0)+"\n")),[new r.RecordValue,!1,e]}),n.IdentifierStatus.VALUE_VARIABLE]},{},{},{}),[0,{}],[0,new Map],{div:new n.InfixStatus(!0,7,!1),mod:new n.InfixStatus(!0,7,!1),"*":new n.InfixStatus(!0,7,!1),"/":new n.InfixStatus(!0,7,!1),"+":new n.InfixStatus(!0,6,!1),"-":new n.InfixStatus(!0,6,!1),"<":new n.InfixStatus(!0,4,!1),">":new n.InfixStatus(!0,4,!1),"<=":new n.InfixStatus(!0,4,!1),">=":new n.InfixStatus(!0,4,!1),"::":new n.InfixStatus(!0,5,!0),"=":new n.InfixStatus(!0,4,!1),"<>":new n.InfixStatus(!0,4,!1),":=":new n.InfixStatus(!0,3,!1),"^":new n.InfixStatus(!0,6,!1)},{nil:1,"::":1,Match:1,Bind:1,Div:1,Overflow:1});exports.getInitialState=getInitialState},function(t,exports,e){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var i=e(7),r=e(1),o=e(3),a=e(2),s=e(0),u=e(4),p=function(){function Declaration(){}return Declaration.prototype.elaborate=function(t,e,n,i){throw void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===i&&(i=!1),new s.InternalInterpreterError(-1,"Not yet implemented.")},Declaration.prototype.evaluate=function(t){throw new s.InternalInterpreterError(-1,"Not yet implemented.")},Declaration.prototype.toString=function(){throw new s.InternalInterpreterError(-1,"Not yet implemented.")},Declaration.prototype.simplify=function(){throw new s.InternalInterpreterError(-1,"Not yet implemented.")},Declaration}();exports.Declaration=p;var c=function(t){function ValueDeclaration(e,n,i,r){void 0===r&&(r=0);var o=t.call(this)||this;return o.position=e,o.typeVariableSequence=n,o.valueBinding=i,o.id=r,o}return n(ValueDeclaration,t),ValueDeclaration.prototype.simplify=function(){for(var t=[],e=0;e<this.valueBinding.length;++e)t.push(new I(this.valueBinding[e].position,this.valueBinding[e].isRecursive,this.valueBinding[e].pattern.simplify(),this.valueBinding[e].expression.simplify()));return new ValueDeclaration(this.position,this.typeVariableSequence,t,this.id)},ValueDeclaration.prototype.elaborate=function(t,e,n,i){for(var r=[],s=[],u=e,p=0;p<this.valueBinding.length;++p){if(this.valueBinding[p].isRecursive){!0;for(var c=p;c<this.valueBinding.length;++c){var h=this.valueBinding[c].pattern.name.getText();r.push([h,new o.TypeVariableBind("'a",new o.TypeVariableBind("'b",new o.FunctionType(new o.TypeVariable("'a"),new o.TypeVariable("'b"))))])}break}var f=this.valueBinding[p].getType(this.typeVariableSequence,t,u,n,i);s=s.concat(f[1]),u=f[2],n=f[3];for(var c=0;c<f[0].length;++c)r.push(f[0][c])}for(var c=0;c<r.length;++c)t.setStaticValue(r[c][0],r[c][1],a.IdentifierStatus.VALUE_VARIABLE);var l=s,d=new Map;u.forEach(function(t,e){d=d.set(e,t)});for(var y=n,v=0;v<3;++v){s=l,u=new Map,d.forEach(function(t,e){u=u.set(e,t)}),n=y;for(var c=p;c<this.valueBinding.length;++c){var f=this.valueBinding[p].getType(this.typeVariableSequence,t,u,n,i);s=s.concat(f[1]),u=f[2],n=f[3];for(var T=0;T<f[0].length;++T)t.setStaticValue(f[0][T][0],f[0][T][1],a.IdentifierStatus.VALUE_VARIABLE)}}return[t,s,u,n]},ValueDeclaration.prototype.evaluate=function(t){for(var e=[],n=[],i=!1,r=[],o=0;o<this.valueBinding.length;++o){this.valueBinding[o].isRecursive&&(i=!0);var s=this.valueBinding[o].compute(t);r=r.concat(s[2]);for(var p=0;p<s[3].length;++p)t.setCell(s[3][p][0],s[3][p][1]);if(void 0!==s[1])return[t,!0,s[1],r];if(void 0===s[0])return[t,!0,new u.ExceptionValue("Bind"),r];for(var p=0;p<s[0].length;++p)i?n.push(s[0][p]):e.push(s[0][p])}for(var p=0;p<e.length;++p)t.setDynamicValue(e[p][0],e[p][1],a.IdentifierStatus.VALUE_VARIABLE);for(var p=0;p<n.length;++p)n[p][1]instanceof u.FunctionValue?t.setDynamicValue(n[p][0],new u.FunctionValue(n[p][1].state,n,n[p][1].body),a.IdentifierStatus.VALUE_VARIABLE):t.setDynamicValue(n[p][0],n[p][1],a.IdentifierStatus.VALUE_VARIABLE);return[t,!1,void 0,r]},ValueDeclaration.prototype.toString=function(){for(var t="val <stuff>",e=0;e<this.valueBinding.length;++e)e>0&&(t+=" and"),t+=" "+this.valueBinding[e];return t+=";"},ValueDeclaration}(p);exports.ValueDeclaration=c;var h=function(t){function TypeDeclaration(e,n,i){void 0===i&&(i=0);var r=t.call(this)||this;return r.position=e,r.typeBinding=n,r.id=i,r}return n(TypeDeclaration,t),TypeDeclaration.prototype.simplify=function(){for(var t=[],e=0;e<this.typeBinding.length;++e)t.push(new b(this.typeBinding[e].position,this.typeBinding[e].typeVariableSequence,this.typeBinding[e].name,this.typeBinding[e].type.simplify()));return new TypeDeclaration(this.position,t,this.id)},TypeDeclaration.prototype.elaborate=function(t,e,n,i){for(var r=0;r<this.typeBinding.length;++r)t.setStaticType(this.typeBinding[r].name.getText(),new o.FunctionType(new o.CustomType(this.typeBinding[r].name.getText(),this.typeBinding[r].typeVariableSequence),this.typeBinding[r].type),[],this.typeBinding[r].typeVariableSequence.length);return[t,[],e,n]},TypeDeclaration.prototype.evaluate=function(t){for(var e=0;e<this.typeBinding.length;++e)t.setDynamicType(this.typeBinding[e].name.getText(),[]);return[t,!1,void 0,[]]},TypeDeclaration.prototype.toString=function(){for(var t="type",e=0;e<this.typeBinding.length;++e)e>0&&(t+=" and"),t+=" <stuff> "+this.typeBinding[e].name.getText(),t+=" = "+this.typeBinding[e].type;return t+";"},TypeDeclaration}(p);exports.TypeDeclaration=h;var f=function(t){function DatatypeDeclaration(e,n,i,r){void 0===r&&(r=0);var o=t.call(this)||this;if(o.position=e,o.datatypeBinding=n,o.typeBinding=i,o.id=r,void 0!==o.typeBinding)throw new s.FeatureDisabledError(o.position,'Who is "withtype"?');return o}return n(DatatypeDeclaration,t),DatatypeDeclaration.prototype.simplify=function(){for(var t=[],e=0;e<this.datatypeBinding.length;++e){for(var n=[],i=0;i<this.datatypeBinding[e].type.length;++i)void 0!==this.datatypeBinding[e].type[i][1]?n.push([this.datatypeBinding[e].type[i][0],this.datatypeBinding[e].type[i][1].simplify()]):n.push(this.datatypeBinding[e].type[i]);t.push(new A(this.datatypeBinding[e].position,this.datatypeBinding[e].typeVariableSequence,this.datatypeBinding[e].name,n))}return new DatatypeDeclaration(this.position,t,void 0,this.id)},DatatypeDeclaration.prototype.elaborate=function(t,e,n,i){for(var r=0;r<this.datatypeBinding.length;++r){for(var o=this.datatypeBinding[r].getType(t,i),u=0;u<o[0].length;++u){if(!a.State.allowsRebind(o[0][u][0]))throw new s.ElaborationError(this.position,'You simply cannot rebind "'+o[0][u][0]+'".');t.setStaticValue(o[0][u][0],o[0][u][1],a.IdentifierStatus.VALUE_CONSTRUCTOR)}t.setStaticType(o[2][0],o[1],o[2][1],this.datatypeBinding[r].typeVariableSequence.length)}return[t,[],e,n]},DatatypeDeclaration.prototype.evaluate=function(t){for(var e=0;e<this.datatypeBinding.length;++e){for(var n=this.datatypeBinding[e].compute(t),i=0;i<n[0].length;++i){if(!a.State.allowsRebind(n[0][i][0]))throw new s.EvaluationError(this.position,'You simply cannot rebind "'+n[0][i][0]+'".');t.setDynamicValue(n[0][i][0],n[0][i][1],a.IdentifierStatus.VALUE_CONSTRUCTOR)}t.setDynamicType(n[1][0],n[1][1])}return[t,!1,void 0,[]]},DatatypeDeclaration.prototype.toString=function(){for(var t="datatype",e=0;e<this.datatypeBinding.length;++e){e>0&&(t+=" and"),t+=" "+this.datatypeBinding[e].name.getText()+" =";for(var n=0;n<this.datatypeBinding[e].type.length;++n)n>0&&(t+=" |"),t+=" "+this.datatypeBinding[e].type[n][0].getText(),void 0!==this.datatypeBinding[e].type[n][1]&&(t+=" of "+this.datatypeBinding[e].type[n][1])}return t+";"},DatatypeDeclaration}(p);exports.DatatypeDeclaration=f;var l=function(t){function DatatypeReplication(e,n,i,r){void 0===r&&(r=0);var o=t.call(this)||this;return o.position=e,o.name=n,o.oldname=i,o.id=r,o}return n(DatatypeReplication,t),DatatypeReplication.prototype.simplify=function(){return this},DatatypeReplication.prototype.elaborate=function(t,e,n,i){var a=void 0;if(this.oldname instanceof r.LongIdentifierToken){var u=t.getAndResolveStaticStructure(this.oldname);void 0!==u&&(a=u.getType(this.oldname.id.getText()))}else a=t.getStaticType(this.oldname.getText());if(void 0===a)throw new s.ElaborationError(this.position,'The datatype "'+this.oldname.getText()+"\" doesn't exist.");var p=a.type.instantiate(t,e);return t.setStaticType(this.name.getText(),new o.FunctionType(new o.CustomType(this.name.getText(),p.typeArguments,0,this.oldname instanceof r.LongIdentifierToken?this.oldname:void 0),p),[],a.arity),[t,[],e,n]},DatatypeReplication.prototype.evaluate=function(t){var e=[];if(this.oldname instanceof r.LongIdentifierToken){var n=t.getAndResolveDynamicStructure(this.oldname);void 0!==n&&(e=n.getType(this.oldname.id.getText()))}else e=t.getDynamicType(this.oldname.getText());if(void 0===e)throw new s.EvaluationError(this.position,'The datatype "'+this.oldname.getText()+'" does not exist.');return t.setDynamicType(this.name.getText(),e),[t,!1,void 0,[]]},DatatypeReplication.prototype.toString=function(){return"datatype "+this.name.getText()+" = datatype "+this.oldname.getText()+";"},DatatypeReplication}(p);exports.DatatypeReplication=l;var d=function(t){function ExceptionDeclaration(e,n,i){void 0===i&&(i=0);var r=t.call(this)||this;return r.position=e,r.bindings=n,r.id=i,r}return n(ExceptionDeclaration,t),ExceptionDeclaration.prototype.simplify=function(){return this},ExceptionDeclaration.prototype.toString=function(){return"exception <stuff>;"},ExceptionDeclaration.prototype.elaborate=function(t,e,n,i){for(var r=0;r<this.bindings.length;++r)t=this.bindings[r].elaborate(t,i);return[t,[],e,n]},ExceptionDeclaration.prototype.evaluate=function(t){for(var e=0;e<this.bindings.length;++e){var n=this.bindings[e].evaluate(t);if(n[1])return[n[0],n[1],n[2],[]];t=n[0]}return[t,!1,void 0,[]]},ExceptionDeclaration}(p);exports.ExceptionDeclaration=d;var y=function(t){function LocalDeclaration(e,n,i,r){void 0===r&&(r=0);var o=t.call(this)||this;return o.position=e,o.declaration=n,o.body=i,o.id=r,o}return n(LocalDeclaration,t),LocalDeclaration.prototype.simplify=function(){return new LocalDeclaration(this.position,this.declaration.simplify(),this.body.simplify(),this.id)},LocalDeclaration.prototype.elaborate=function(t,e,n,i){var r=[t.getNestedState(t.id),[],e,n],o=this.declaration.elaborate(r[0],e,n),a=o[0].getNestedState(t.id);return r=this.body.elaborate(a,o[2],o[3],i),a.parent=t,[r[0],o[1].concat(r[1]),r[2],r[3]]},LocalDeclaration.prototype.evaluate=function(t){for(var e=t.getNestedState(0).getNestedState(t.id),n=this.declaration.evaluate(e),i=n[0].getMemoryChanges(0),r=0;r<i.length;++r)t.setCell(i[r][0],i[r][1]);if(n[1])return[t,!0,n[2],n[3]];e=n[0].getNestedState(t.id);var o=this.body.evaluate(e);return e.parent=t,o[3]=n[3].concat(o[3]),o},LocalDeclaration.prototype.toString=function(){var t="local "+this.declaration;return t+=" in "+this.body,t+=" end;"},LocalDeclaration}(p);exports.LocalDeclaration=y;var v=function(t){function OpenDeclaration(e,n,i){void 0===i&&(i=0);var r=t.call(this)||this;return r.position=e,r.names=n,r.id=i,r}return n(OpenDeclaration,t),OpenDeclaration.prototype.simplify=function(){return this},OpenDeclaration.prototype.elaborate=function(t,e,n,i){for(var o=0;o<this.names.length;++o){var a=void 0;if(this.names[o]instanceof r.LongIdentifierToken?void 0!==(a=t.getAndResolveStaticStructure(this.names[o]))&&(a=a.getStructure(this.names[o].id.getText())):a=t.getStaticStructure(this.names[o].getText()),void 0===a)throw new s.EvaluationError(this.position,'Undefined module "'+this.names[o].getText()+'".');t.staticBasis.extend(a)}return[t,[],e,n]},OpenDeclaration.prototype.evaluate=function(t){for(var e=0;e<this.names.length;++e){var n=void 0;if(this.names[e]instanceof r.LongIdentifierToken?void 0!==(n=t.getAndResolveDynamicStructure(this.names[e]))&&(n=n.getStructure(this.names[e].id.getText())):n=t.getDynamicStructure(this.names[e].getText()),void 0===n)throw new s.EvaluationError(this.position,'Undefined module "'+this.names[e].getText()+'".');t.dynamicBasis.extend(n)}return[t,!1,void 0,[]]},OpenDeclaration.prototype.toString=function(){for(var t="open",e=0;e<this.names.length;++e)t+=" "+this.names[e].getText();return t+";"},OpenDeclaration}(p);exports.OpenDeclaration=v;var T=function(t){function EmptyDeclaration(e){void 0===e&&(e=0);var n=t.call(this)||this;return n.id=e,n}return n(EmptyDeclaration,t),EmptyDeclaration.prototype.simplify=function(){return this},EmptyDeclaration.prototype.elaborate=function(t,e,n,i){return[t,[],e,n]},EmptyDeclaration.prototype.evaluate=function(t){return[t,!1,void 0,[]]},EmptyDeclaration.prototype.toString=function(){return" ;"},EmptyDeclaration}(p);exports.EmptyDeclaration=T;var g=function(t){function SequentialDeclaration(e,n,i){void 0===i&&(i=0);var r=t.call(this)||this;return r.position=e,r.declarations=n,r.id=i,r}return n(SequentialDeclaration,t),SequentialDeclaration.prototype.simplify=function(){for(var t=[],e=0;e<this.declarations.length;++e)t.push(this.declarations[e].simplify());return new SequentialDeclaration(this.position,t,this.id)},SequentialDeclaration.prototype.elaborate=function(t,e,n,i){for(var r=this,o=[],a=e,u=n,p=this,c=0;c<this.declarations.length;++c)!function(n){i&&(a=new Map,t.getTypeVariableBinds()[1].forEach(function(t,e){a=a.set(e,t)}));var c=p.declarations[n].elaborate(t.getNestedState(p.declarations[n].id),a,u,i);t=c[0],o=o.concat(c[1]),a=c[2];var h=new Map;if(i&&(h=e),c[2].forEach(function(n,i){if(n[1]&&"~"===i[1]){var a=n[0].instantiate(t,c[2]).normalize(t.freeTypeVariables[0]);t.parent.getTypeVariableBinds()[1].has(i)||o.push(new s.Warning(r.position,'The free type variable "'+i+'" has been instantiated to "'+a[0]+'".\n')),h=h.set(i,[a[0],!0])}else e.has(i)&&(h=h.set(i,[n[0].instantiate(t,c[2]),!1]))}),a=h,i){t.freeTypeVariables[1]=h;for(var f in t.staticBasis.valueEnvironment)if(t.staticBasis.valueEnvironment.hasOwnProperty(f)){var l=t.staticBasis.valueEnvironment[f],d=l[0].normalize(t.freeTypeVariables[0]);t.freeTypeVariables[0]=d[1],t.setStaticValue(f,d[0],l[1])}}u=c[3]}(c);return[t,o,a,u]},SequentialDeclaration.prototype.evaluate=function(t){for(var e=[],n=0;n<this.declarations.length;++n){var i=t.getNestedState(this.declarations[n].id),r=this.declarations[n].evaluate(i);if(e=e.concat(r[3]),r[1])return[r[0],r[1],r[2],e];t=r[0]}return[t,!1,void 0,e]},SequentialDeclaration.prototype.toString=function(){for(var t="",e=0;e<this.declarations.length;++e)e>0&&(t+=" "),t+=this.declarations[e];return t},SequentialDeclaration}(p);exports.SequentialDeclaration=g;var m=function(t){function FunctionDeclaration(e,n,i,r){void 0===r&&(r=0);var o=t.call(this)||this;return o.position=e,o.typeVariableSequence=n,o.functionValueBinding=i,o.id=r,o}return n(FunctionDeclaration,t),FunctionDeclaration.prototype.simplify=function(){for(var t=[],e=0;e<this.functionValueBinding.length;++e)t.push(this.functionValueBinding[e].simplify());return new c(this.position,this.typeVariableSequence,t,this.id)},FunctionDeclaration}(p);exports.FunctionDeclaration=m;var w=function(t){function Evaluation(e,n){var i=t.call(this)||this;return i.position=e,i.expression=n,i}return n(Evaluation,t),Evaluation.prototype.simplify=function(){return new c(this.position,[],[new I(this.position,!1,new i.Tuple(-1,[]),this.expression)]).simplify()},Evaluation}(p);exports.Evaluation=w;var E=function(t){function AbstypeDeclaration(e,n,i,r,o){void 0===o&&(o=0);var a=t.call(this)||this;if(a.position=e,a.datatypeBinding=n,a.typeBinding=i,a.declaration=r,a.id=o,void 0!==a.typeBinding)throw new s.FeatureDisabledError(a.position,'Who is "withtype"?');return a}return n(AbstypeDeclaration,t),AbstypeDeclaration.prototype.simplify=function(){for(var t=new f(this.position,this.datatypeBinding,void 0,this.id),e=[],n=0;n<this.datatypeBinding.length;++n)e.push(new b(this.datatypeBinding[n].position,this.datatypeBinding[n].typeVariableSequence,this.datatypeBinding[n].name,new o.CustomType(this.datatypeBinding[n].name.getText(),this.datatypeBinding[n].typeVariableSequence)));var i=new h(this.position,e,this.id);return new y(this.position,t,new g(this.position,[i,this.declaration],this.id),this.id).simplify()},AbstypeDeclaration}(p);exports.AbstypeDeclaration=E;var S=function(t){function InfixDeclaration(e,n,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var o=t.call(this)||this;return o.position=e,o.operators=n,o.precedence=i,o.id=r,o}return n(InfixDeclaration,t),InfixDeclaration.prototype.simplify=function(){return this},InfixDeclaration.prototype.elaborate=function(t,e,n){return[t,[],e,n]},InfixDeclaration.prototype.evaluate=function(t){for(var e=0;e<this.operators.length;++e)t.setInfixStatus(this.operators[e],this.precedence,!1,!0);return[t,!1,void 0,[]]},InfixDeclaration.prototype.toString=function(){var t="infix";t+=" "+this.precedence;for(var e=0;e<this.operators.length;++e)t+=" "+this.operators[e].getText();return t+";"},InfixDeclaration}(p);exports.InfixDeclaration=S;var x=function(t){function InfixRDeclaration(e,n,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var o=t.call(this)||this;return o.position=e,o.operators=n,o.precedence=i,o.id=r,o}return n(InfixRDeclaration,t),InfixRDeclaration.prototype.simplify=function(){return this},InfixRDeclaration.prototype.elaborate=function(t,e,n){return[t,[],e,n]},InfixRDeclaration.prototype.evaluate=function(t){for(var e=0;e<this.operators.length;++e)t.setInfixStatus(this.operators[e],this.precedence,!0,!0);return[t,!1,void 0,[]]},InfixRDeclaration.prototype.toString=function(){var t="infixr";t+=" "+this.precedence;for(var e=0;e<this.operators.length;++e)t+=" "+this.operators[e].getText();return t+";"},InfixRDeclaration}(p);exports.InfixRDeclaration=x;var k=function(t){function NonfixDeclaration(e,n,i){void 0===i&&(i=0);var r=t.call(this)||this;return r.position=e,r.operators=n,r.id=i,r}return n(NonfixDeclaration,t),NonfixDeclaration.prototype.simplify=function(){return this},NonfixDeclaration.prototype.elaborate=function(t,e,n){return[t,[],e,n]},NonfixDeclaration.prototype.evaluate=function(t){for(var e=0;e<this.operators.length;++e)t.setInfixStatus(this.operators[e],0,!1,!1);return[t,!1,void 0,[]]},NonfixDeclaration.prototype.toString=function(){for(var t="nonfix",e=0;e<this.operators.length;++e)t+=" "+this.operators[e].getText();return t+";"},NonfixDeclaration}(p);exports.NonfixDeclaration=k;var I=function(){function ValueBinding(t,e,n,i){this.position=t,this.isRecursive=e,this.pattern=n,this.expression=i}return ValueBinding.prototype.toString=function(){var t="";return this.isRecursive&&(t+="rec "),t+=this.pattern,(t+=" = ")+this.expression},ValueBinding.prototype.getType=function(t,e,n,i,r){var a=e.getNestedState(e.id),u=this.expression.getType(a,n,i),p=this.pattern.matchType(a,u[4],u[0]),c=new Set;if(p[2].forEach(function(t,e){c.add(e),t[0].getTypeVariables().forEach(function(t){c.add(t)})}),void 0===p)throw new s.ElaborationError(this.position,'Type clash. An expression of type "'+u[0]+'" cannot be assigned to "'+p[1]+'".');for(var h=[],f=0;f<t.length;++f){var l=t[f].instantiate(e,p[2]);if(!(l instanceof o.TypeVariable))throw new s.ElaborationError(this.position,'Type clash. An expression of explicit type "'+t[f]+'" cannot have type "'+l+'".');h.push(l)}for(var d=!this.isRecursive&&!this.expression.isSafe(e),f=0;f<p[0].length;++f)!function(t){p[0][t][1]=p[0][t][1].instantiate(e,p[2]);for(var n=p[0][t][1].getTypeVariables(),i=p[0][t][1].getTypeVariables(!0),a=new Set,s=h.length-1;s>=0;--s)n.has(h[s].name)&&(p[0][t][1]=new o.TypeVariableBind(h[s].name,p[0][t][1]),p[0][t][1].isFree=i.has(h[s].name),a.add(h[s].name));h=[],p[0][t][1].getTypeVariables().forEach(function(t){!r&&c.has(t)||a.has(t)||h.push(new o.TypeVariable(t))});for(var s=h.length-1;s>=0;--s)p[0][t][1]=new o.TypeVariableBind(h[s].name,p[0][t][1]),p[0][t][1].isFree=d||i.has(h[s].name)}(f);return[p[0],u[1],p[2],u[2]]},ValueBinding.prototype.compute=function(t){var e=this.expression.compute(t);return e[1]?[void 0,e[0],e[2],e[3]]:[this.pattern.matches(t,e[0]),void 0,e[2],e[3]]},ValueBinding}();exports.ValueBinding=I;var V=function(){function FunctionValueBinding(t,e,n){this.position=t,this.parameters=e,this.name=n}return FunctionValueBinding.prototype.simplify=function(){if(void 0===this.name)throw new s.InternalInterpreterError(this.position,"This function isn't ready to be simplified yet.");for(var t=[],e=[],n=0;n<this.parameters[0][0].length;++n)t.push(new i.ValueIdentifier(-1,new r.IdentifierToken("__arg"+n,-1)));for(var n=0;n<this.parameters.length;++n){var o=void 0;o=1===this.parameters[n][0].length?this.parameters[n][0][0]:new i.Tuple(-1,this.parameters[n][0]),void 0===this.parameters[n][1]?e.push([o,this.parameters[n][2]]):e.push([o,new i.TypedExpression(-1,this.parameters[n][2],this.parameters[n][1])])}var a;a=1!==t.length?new i.Tuple(-1,t).simplify():t[0];var u,p=new i.Match(-1,e);u=new i.CaseAnalysis(-1,a,p);for(var n=this.parameters[0][0].length-1;n>=0;--n)u=new i.Lambda(-1,new i.Match(-1,[[new i.ValueIdentifier(-1,new r.IdentifierToken("__arg"+n,-1)),u]]));return new I(this.position,!0,this.name,u.simplify())},FunctionValueBinding.prototype.toString=function(){for(var t="",e=0;e<this.parameters.length;++e){e>0&&(t+=" | "),t+=this.name.name.getText();for(var n=0;n<this.parameters[e][0].length;++n)t+=" "+this.parameters[e][0][n];void 0!==this.parameters[e][1]&&(t+=": "+this.parameters[e][1]),t+=" = "+this.parameters[e][2]}return t},FunctionValueBinding}();exports.FunctionValueBinding=V;var b=function(){function TypeBinding(t,e,n,i){this.position=t,this.typeVariableSequence=e,this.name=n,this.type=i}return TypeBinding}();exports.TypeBinding=b;var A=function(){function DatatypeBinding(t,e,n,i){this.position=t,this.typeVariableSequence=e,this.name=n,this.type=i}return DatatypeBinding.prototype.getType=function(t,e){var n=[],i=[],r=t.getNestedState(t.id),a=new o.CustomType(this.name.getText(),this.typeVariableSequence);r.setStaticType(this.name.getText(),a,[],this.typeVariableSequence.length);for(var u=this,p=0;p<this.type.length;++p)!function(t){var e=a;void 0!==u.type[t][1]&&(1,e=new o.FunctionType(u.type[t][1].instantiate(r,new Map),e));for(var p=new Set,c=0;c<u.typeVariableSequence.length;++c)p=p.add(u.typeVariableSequence[c].name);var h=[];if(e.getTypeVariables().forEach(function(t){p.has(t)?e=new o.TypeVariableBind(t,e):h.push(t)}),h.length>0)throw s.ElaborationError.getUnguarded(u.position,h);i.push([u.type[t][0].getText(),e]),n.push(u.type[t][0].getText())}(p);return[i,a,[this.name.getText(),n]]},DatatypeBinding.prototype.compute=function(t){for(var e=[],n=[],i=0;i<this.type.length;++i){var r=0;void 0!==this.type[i][1]&&(r=1);var o=t.getValueIdentifierId(this.type[i][0].getText());t.incrementValueIdentifierId(this.type[i][0].getText()),n.push([this.type[i][0].getText(),new u.ValueConstructor(this.type[i][0].getText(),r,o)]),e.push(this.type[i][0].getText())}return[n,[this.name.getText(),e]]},DatatypeBinding}();exports.DatatypeBinding=A;var C=function(){function DirectExceptionBinding(t,e,n){this.position=t,this.name=e,this.type=n}return DirectExceptionBinding.prototype.elaborate=function(t,e){if(void 0!==this.type){var n=this.type.simplify().instantiate(t,new Map),i=[];if(n.getTypeVariables().forEach(function(t){i.push(t)}),e&&i.length>0)throw s.ElaborationError.getUnguarded(this.position,i);t.setStaticValue(this.name.getText(),new o.FunctionType(n,new o.CustomType("exn")).normalize()[0],a.IdentifierStatus.EXCEPTION_CONSTRUCTOR)}else t.setStaticValue(this.name.getText(),new o.CustomType("exn").normalize()[0],a.IdentifierStatus.EXCEPTION_CONSTRUCTOR);return t},DirectExceptionBinding.prototype.evaluate=function(t){var e=0;void 0!==this.type&&(e=1);var n=t.getValueIdentifierId(this.name.getText());if(t.incrementValueIdentifierId(this.name.getText()),!a.State.allowsRebind(this.name.getText()))throw new s.EvaluationError(this.position,'You simply cannot rebind "'+this.name.getText()+'".');return t.setDynamicValue(this.name.getText(),new u.ExceptionConstructor(this.name.getText(),e,n),a.IdentifierStatus.EXCEPTION_CONSTRUCTOR),[t,!1,void 0]},DirectExceptionBinding}();exports.DirectExceptionBinding=C;var B=function(){function ExceptionAlias(t,e,n){this.position=t,this.name=e,this.oldname=n}return ExceptionAlias.prototype.elaborate=function(t,e){var n=void 0;if(this.oldname instanceof r.LongIdentifierToken){var i=t.getAndResolveStaticStructure(this.oldname);void 0!==i&&(n=i.getValue(this.oldname.id.getText()))}else n=t.getStaticValue(this.oldname.getText());if(void 0===n)throw new s.ElaborationError(this.position,'Unbound value identifier "'+this.oldname.getText()+'".');if(n[1]!==a.IdentifierStatus.EXCEPTION_CONSTRUCTOR)throw new s.ElaborationError(this.position,'You cannot transform "'+n[0]+'" into an exception.');return t.setStaticValue(this.name.getText(),n[0].normalize()[0],a.IdentifierStatus.EXCEPTION_CONSTRUCTOR),t},ExceptionAlias.prototype.evaluate=function(t){var e=void 0;if(this.oldname instanceof r.LongIdentifierToken){var n=t.getAndResolveDynamicStructure(this.oldname);void 0!==n&&(e=n.getValue(this.oldname.id.getText()))}else e=t.getDynamicValue(this.oldname.getText());if(void 0===e)throw new s.EvaluationError(this.position,'Unbound value identifier "'+this.oldname.getText()+'".');if(e[1]!==a.IdentifierStatus.EXCEPTION_CONSTRUCTOR)throw new s.EvaluationError(this.position,'You cannot transform "'+e[0].toString(t)+'" into an exception.');return t.setDynamicValue(this.name.getText(),e[0],a.IdentifierStatus.EXCEPTION_CONSTRUCTOR),[t,!1,void 0]},ExceptionAlias}();exports.ExceptionAlias=B},function(t,exports,e){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var i=e(3),r=e(6),o=e(1),a=e(2),s=e(0),u=e(4),p=e(5),c=function(){function Expression(){}return Expression.prototype.getType=function(t,e,n,i,r){throw void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===i&&(i=new Set),void 0===r&&(r=!1),new s.InternalInterpreterError(this.position,'Called "getType" on a derived form.')},Expression.prototype.compute=function(t){throw new s.InternalInterpreterError(this.position,'Called "getValue" on a derived form.')},Expression.prototype.isSafe=function(t){return!0},Expression.prototype.toString=function(){throw new s.InternalInterpreterError(this.position,"I don't want to be printed.")},Expression}();exports.Expression=c;var h=function(t){function Constant(e,n){var i=t.call(this)||this;return i.position=e,i.token=n,i}return n(Constant,t),Constant.prototype.matchType=function(t,e,n){return[[],this.getType(t,e)[0],e]},Constant.prototype.matches=function(t,e){return this.compute(t)[0].equals(e)?[]:void 0},Constant.prototype.getType=function(t,e,n,r,a){if(void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===r&&(r=new Set),void 0===a&&(a=!1),this.token instanceof o.IntegerConstantToken||this.token instanceof o.NumericToken)return[new i.CustomType("int"),[],n,r,e];if(this.token instanceof o.RealConstantToken)return[new i.CustomType("real"),[],n,r,e];if(this.token instanceof o.WordConstantToken)return[new i.CustomType("word"),[],n,r,e];if(this.token instanceof o.CharacterConstantToken)return[new i.CustomType("char"),[],n,r,e];if(this.token instanceof o.StringConstantToken)return[new i.CustomType("string"),[],n,r,e];throw new s.InternalInterpreterError(this.token.position,'"'+this+'" does not seem to be a valid constant.')},Constant.prototype.simplify=function(){return this},Constant.prototype.toString=function(){return this.token.getText()},Constant.prototype.compute=function(t){if(this.token instanceof o.IntegerConstantToken||this.token instanceof o.NumericToken)return[new u.Integer(this.token.value),!1,[],[]];if(this.token instanceof o.RealConstantToken)return[new u.Real(this.token.value),!1,[],[]];if(this.token instanceof o.WordConstantToken)return[new u.Word(this.token.value),!1,[],[]];if(this.token instanceof o.CharacterConstantToken)return[new u.CharValue(this.token.value),!1,[],[]];if(this.token instanceof o.StringConstantToken)return[new u.StringValue(this.token.value),!1,[],[]];throw new s.EvaluationError(this.token.position,"You sure that this is a constant?")},Constant}(c);exports.Constant=h;var f=function(t){function ValueIdentifier(e,n){var i=t.call(this)||this;return i.position=e,i.name=n,i}return n(ValueIdentifier,t),ValueIdentifier.prototype.getType=function(t,e,n,r,u){void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===r&&(r=new Set),void 0===u&&(u=!1);var p=void 0;if(this.name instanceof o.LongIdentifierToken){var c=t.getAndResolveStaticStructure(this.name);if(void 0!==c&&void 0!==(p=c.getValue(this.name.id.getText()))){var h=new a.State(0,void 0,c,t.dynamicBasis,[0,{}]);p[0]=p[0].qualify(h,this.name)}}else p=t.getStaticValue(this.name.getText());var f=e,l=!1;if(void 0===p||p[1]===a.IdentifierStatus.VALUE_VARIABLE){var d=new i.TypeVariable("'**"+this.name.getText());if(u)p=[new i.TypeVariableBind("'**"+this.name.getText(),d),0],l=!0;else{if(e.has(d.name)){return[e.get(d.name)[0].instantiate(t,f),[],n,r,f]}if(void 0===p)throw new s.ElaborationError(this.position,'Unbound value identifier "'+this.name.getText()+'".')}}for(var y=new Set,v=new Set,T=new Map;p[0]instanceof i.TypeVariableBind;)p[0].isFree?(v=v.add(p[0].name),T.set(p[0].name,p[0].name)):y=y.add(p[0].name),p[0]=p[0].type;var g=[];y.forEach(function(i){for(var o=+n.substring(3)+1,a="";;++o)if(n="'"+n[1]+n[2]+o,!y.has(n)&&!r.has(n)&&!e.has(n)&&void 0===t.getStaticValue(n)){a="'"===i[1]?"'"+n:n,g.push(a),T=T.set(i,a);break}});for(var m=0;m<g.length;++m)r=r.add(g[m]);var w=p[0].replaceTypeVariables(T,v).instantiate(t,f);return l&&(f=f.set("'**"+this.name.getText(),[w,!1])),[w,[],n,r,f]},ValueIdentifier.prototype.matchType=function(t,e,n){if(this.name instanceof o.LongIdentifierToken)throw new s.ElaborationError(this.position,"Variable names in patterns cannot be qualified.");var r=t.getStaticValue(this.name.getText());if(void 0===r||r[1]===a.IdentifierStatus.VALUE_VARIABLE)return[[[this.name.getText(),n.instantiate(t,e)]],n.instantiate(t,e),e];var u=this.getType(t,e,"'*g0");u[3].forEach(function(t){var e="'*p"+t.substring(3);"'"===t[1]&&(e="''*p"+t.substring(4)),u[4]=u[4].set(t,[new i.TypeVariable(e),!1])}),r[0]=u[0],e=u[4];try{var p=n.merge(t,e,r[0]);return[[],p[0],p[1]]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.position,'Type clash: "'+n+'" vs. "'+r[0]+'": '+t[0])}},ValueIdentifier.prototype.matches=function(t,e){if(this.name instanceof o.LongIdentifierToken)throw new s.EvaluationError(this.position,"Variable names in patterns cannot be qualified.");var n=t.getDynamicValue(this.name.getText());return void 0===n||n[1]===a.IdentifierStatus.VALUE_VARIABLE?[[this.name.getText(),e]]:e.equals(n[0])?[]:void 0},ValueIdentifier.prototype.simplify=function(){return this},ValueIdentifier.prototype.toString=function(){return this.name.getText()},ValueIdentifier.prototype.compute=function(t){var e=void 0;if(this.name instanceof o.LongIdentifierToken){var n=t.getAndResolveDynamicStructure(this.name);void 0!==n&&(e=n.getValue(this.name.id.getText()))}else e=t.getDynamicValue(this.name.getText());if(void 0===e)throw new s.EvaluationError(this.position,'Unbound value identifier "'+this.name.getText()+'".');return e[1]===a.IdentifierStatus.VALUE_CONSTRUCTOR&&0===e[0].numArgs?[e[0].construct(),!1,[],[]]:e[1]===a.IdentifierStatus.EXCEPTION_CONSTRUCTOR&&0===e[0].numArgs?[e[0].construct(),!1,[],[]]:[e[0],!1,[],[]]},ValueIdentifier}(c);exports.ValueIdentifier=f;var l=function(t){function Record(e,n,i){var r=t.call(this)||this;r.position=e,r.complete=n,r.entries=i,r.entries.sort();for(var o=1;o<r.entries.length;++o)if(r.entries[o][0]===r.entries[o-1][0])throw new s.ElaborationError(r.position,'Label "'+r.entries[o][0]+'" occurs more than once in the same record.');return r}return n(Record,t),Record.prototype.isSafe=function(t){for(var e=0;e<this.entries.length;++e)if(!this.entries[e][1].isSafe(t))return!1;return!0},Record.prototype.matchType=function(t,e,n){if(n instanceof i.RecordType||(n=n.instantiate(t,e)),n instanceof i.TypeVariable){for(var r=new Map,o=0;o<this.entries.length;++o){var a=new i.TypeVariable(n.name+"*"+o);a.isFree=n.isFree,r=r.set(this.entries[o][0],a)}var u=new i.RecordType(r,this.complete);e=e.set(n.name,[u,n.isFree]),n=u}if(!(n instanceof i.RecordType))throw new s.ElaborationError(this.position,'Expected pattern of a record type, got "'+n.constructor.name+'".');if(this.complete&&this.entries.length!==n.elements.size)throw new s.ElaborationError(this.position,"Expected a record type with "+this.entries.length+" entries, but the given one has "+n.elements.size+".");for(var p=[],c=new Map,h=e,o=0;o<this.entries.length;++o){if(!n.hasType(this.entries[o][0]))throw new s.ElaborationError(this.position,"Elaboration failed.");var f=this.entries[o][1].matchType(t,h,n.getType(this.entries[o][0]));p=p.concat(f[0]),c=c.set(this.entries[o][0],f[1]),h=f[2]}return[p,new i.RecordType(c),h]},Record.prototype.matches=function(t,e){if(e instanceof u.RecordValue&&(!this.complete||this.entries.length===e.entries.size)){for(var n=[],i=0;i<this.entries.length;++i){if(!e.hasValue(this.entries[i][0]))return;var r=this.entries[i][1].matches(t,e.getValue(this.entries[i][0]));if(void 0===r)return r;for(var o=0;o<r.length;++o)n.push(r[o])}return n}},Record.prototype.getType=function(t,e,n,r,o){void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===r&&(r=new Set),void 0===o&&(o=!1);for(var a=new Map,u=[],p=e,c=0;c<this.entries.length;++c){var h=this.entries[c][0],f=this.entries[c][1];if(a.has(h))throw new s.ElaborationError(this.position,'Label "'+h+'" occurs more than once in the same record.');var l=f.getType(t,p,n,r,o);u=u.concat(l[1]),n=l[2],r=l[3],l[4].forEach(function(t,e){p=p.set(e,t)}),a=a.set(h,l[0])}return[new i.RecordType(a,this.complete),u,n,r,p]},Record.prototype.simplify=function(){for(var t=[],e=0;e<this.entries.length;++e){var n=this.entries[e];t.push([n[0],n[1].simplify()])}return new Record(this.position,this.complete,t)},Record.prototype.toString=function(){for(var t="{",e=!0,n=0;n<this.entries.length;++n)e||(t+=", "),e=!1,t+=this.entries[n][0]+" = "+this.entries[n][1];return this.complete||(e||(t+=", "),t+="..."),t+"}"},Record.prototype.compute=function(t){for(var e=new Map,n=[],i=[],r=0;r<this.entries.length;++r){var o=this.entries[r][1].compute(t);n=n.concat(o[2]),i=i.concat(o[3]);for(var a=0;a<o[3].length;++a)t.setCell(o[3][a][0],o[3][a][1]);if(o[1])return[o[0],!0,n,i];e=e.set(this.entries[r][0],o[0])}return[new u.RecordValue(e),!1,n,i]},Record}(c);exports.Record=l;var d=function(t){function LocalDeclarationExpression(e,n,i){var r=t.call(this)||this;return r.position=e,r.declaration=n,r.expression=i,r}return n(LocalDeclarationExpression,t),LocalDeclarationExpression.prototype.simplify=function(){return new LocalDeclarationExpression(this.position,this.declaration.simplify(),this.expression.simplify())},LocalDeclarationExpression.prototype.toString=function(){var t="let "+this.declaration;return t+=" in "+this.expression+" end"},LocalDeclarationExpression.prototype.isSafe=function(t){return this.expression.isSafe(t)},LocalDeclarationExpression.prototype.getType=function(t,e,n,i,r){void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===i&&(i=new Set),void 0===r&&(r=!1);var o=t.getNestedState(t.id);e.forEach(function(n,i){"*"===i[1]&&"*"===i[2]&&o.setStaticValue(i.substring(3),n[0].instantiate(t,e),a.IdentifierStatus.VALUE_VARIABLE)});var s=this.declaration.elaborate(o,e,n);n=s[3];var u=new Map;e.forEach(function(t,e){u=u.set(e,[t[0].instantiate(s[0],s[2]),t[1]])});var p=this.expression.getType(s[0],s[2],n,i,r);return[p[0],s[1].concat(p[1]),p[2],p[3],p[4]]},LocalDeclarationExpression.prototype.compute=function(t){var e=t.getNestedState(0).getNestedState(t.id),n=this.declaration.evaluate(e),i=n[0].getMemoryChanges(0);if(n[1])return[n[2],!0,n[3],i];var r=this.expression.compute(n[0]);return[r[0],r[1],n[3].concat(r[2]),i.concat(r[3])]},LocalDeclarationExpression}(c);exports.LocalDeclarationExpression=d;var y=function(t){function TypedExpression(e,n,i){var r=t.call(this)||this;return r.position=e,r.expression=n,r.typeAnnotation=i,r}return n(TypedExpression,t),TypedExpression.prototype.isSafe=function(t){return this.expression.isSafe(t)},TypedExpression.prototype.matchType=function(t,e,n){var i=this.expression.matchType(t,e,n);try{for(var r=i[1].merge(t,i[2],this.typeAnnotation),o=0;o<i[0].length;++o)i[0][o][1]=i[0][o][1].instantiate(t,r[1]);return[i[0],r[0],r[1]]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.position,'The annotated type "'+this.typeAnnotation+'" does not match the expression\'s type "'+i[1]+'": '+t[0])}},TypedExpression.prototype.matches=function(t,e){return this.expression.matches(t,e)},TypedExpression.prototype.getType=function(t,e,n,i,r){void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===i&&(i=new Set),void 0===r&&(r=!1);var o=this.expression.getType(t,e,n,i,r);try{var a=this.typeAnnotation.instantiate(t,e),u=o[0].merge(t,e,a);return[u[0],o[1],o[2],o[3],u[1]]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.position,'The specified type "'+this.typeAnnotation+'" does not match the annotated expression\'s type "'+o[0]+'": '+t[0])}},TypedExpression.prototype.simplify=function(){return new TypedExpression(this.position,this.expression.simplify(),this.typeAnnotation.simplify())},TypedExpression.prototype.toString=function(){var t="( "+this.expression;return(t+=": "+this.typeAnnotation)+" )"},TypedExpression.prototype.compute=function(t){return this.expression.compute(t)},TypedExpression}(c);exports.TypedExpression=y;var v=function(t){function FunctionApplication(e,n,i){var r=t.call(this)||this;return r.position=e,r.func=n,r.argument=i,r}return n(FunctionApplication,t),FunctionApplication.prototype.isSafe=function(t){if(!(this.func instanceof f))return!1;var e=t.getStaticValue(this.func.name.getText());return void 0!==e&&e[1]!==a.IdentifierStatus.VALUE_VARIABLE},FunctionApplication.prototype.matchType=function(t,e,n){if(!(this.func instanceof f))throw new s.ElaborationError(this.position,"Elaboration failed. 1");var r=t.getStaticValue(this.func.name.getText());if(void 0===r||r[1]===a.IdentifierStatus.VALUE_VARIABLE)throw new s.ElaborationError(this.position,'Unbound value Identifier "'+this.func.name.getText()+'".');var o=this.func.getType(t,e,"'g0");if(o[3].forEach(function(t){var e="'p"+t.substring(2);"'"===t[1]&&(e="''p"+t.substring(3)),o[4]=o[4].set(t,[new i.TypeVariable(e),!1])}),r[0]=o[0],e=o[4],!(r[0]instanceof i.FunctionType))throw new s.ElaborationError(this.position,"Elaboration failed. 2");try{var u=r[0],p=u.returnType.merge(t,e,n),c=this.argument.matchType(t,p[1],u.parameterType.instantiate(t,p[1]));return[c[0],p[0],c[2]]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.position,"Merge failed: "+t[0])}},FunctionApplication.prototype.matches=function(t,e){if(e instanceof u.FunctionValue)throw new s.EvaluationError(this.position,"You simply cannot match function values.");if(e instanceof u.ConstructedValue){if(this.func instanceof f&&this.func.name.getText()===e.constructorName&&"ref"!==this.func.name.getText())return void 0!==e.argument?this.argument.matches(t,e.argument):[]}else if(e instanceof u.ExceptionValue){if(this.func instanceof f&&this.func.name.getText()===e.constructorName)return void 0!==e.argument?this.argument.matches(t,e.argument):[]}else{if(e instanceof u.PredefinedFunction)throw new s.EvaluationError(this.position,"You simply cannot match predefined functions.");if(!(e instanceof u.ReferenceValue))throw new s.EvaluationError(this.position,"Help me, I'm broken. ("+e.constructor.name+").");if(this.func instanceof f&&"ref"===this.func.name.getText())return this.argument.matches(t,t.getCell(e.address))}},FunctionApplication.prototype.getType=function(t,e,n,r,o){void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===r&&(r=new Set),void 0===o&&(o=!1);var a=this.func.getType(t,e,n,r,o),u=this.argument.getType(t,a[4],a[2],a[3],o);if(u[4].forEach(function(t,e){a[4]=a[4].set(e,t)}),a[0]=a[0].instantiate(t,e),a[0]instanceof i.TypeVariable){var p=new i.TypeVariable(a[0].name+"*a"),c=new i.TypeVariable(a[0].name+"*b");p.isFree=a[0].isFree,c.isFree=a[0].isFree;var h=new i.FunctionType(p,c);a[4]=a[4].set(a[0].name,[h,a[0].isFree]),a[0]=h}if(a[0]instanceof i.AnyType&&(a[0]=new i.FunctionType(new i.AnyType,new i.AnyType)),!(a[0]instanceof i.FunctionType))throw new s.ElaborationError(this.func.position,'"'+this.func+'" of type "'+a[0]+'" is not a function.');try{var f=a[0].parameterType.merge(t,a[4],u[0]);return[a[0].returnType.instantiate(t,f[1]),a[1].concat(u[1]),u[2],u[3],f[1]]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.position,'Do not feed functions of type "'+a[0]+'" an argument of type "'+u[0]+'": '+t[0])}},FunctionApplication.prototype.simplify=function(){return new FunctionApplication(this.position,this.func.simplify(),this.argument.simplify())},FunctionApplication.prototype.toString=function(){var t="( "+this.func;return(t+=" "+this.argument)+" )"},FunctionApplication.prototype.compute=function(t){if(this.func instanceof f){if("ref"===this.func.name.getText()){var e=this.argument.compute(t);if(e[1])return[e[0],!0,e[2],e[3]];for(var n=0;n<e[3].length;++n)t.setCell(e[3][n][0],e[3][n][1]);var i=t.setNewCell(e[0]);return e[3].push([i.address,e[0]]),[i,!1,e[2],e[3]]}if(":="===this.func.name.getText()){var e=this.argument.compute(t);if(e[1])return[e[0],!0,e[2],e[3]];for(var n=0;n<e[3].length;++n)t.setCell(e[3][n][0],e[3][n][1]);if(!(e[0]instanceof u.RecordValue&&e[0].getValue("1")instanceof u.ReferenceValue))throw new s.EvaluationError(this.position,'That\'s not how ":=" works.');return e[3].push([e[0].getValue("1").address,e[0].getValue("2")]),[new u.RecordValue,!1,e[2],e[3]]}if("!"===this.func.name.getText()){var e=this.argument.compute(t);if(e[1])return[e[0],!0,e[2],e[3]];for(var n=0;n<e[3].length;++n)t.setCell(e[3][n][0],e[3][n][1]);if(!(e[0]instanceof u.ReferenceValue))throw new s.EvaluationError(this.position,'You cannot dereference "'+this.argument+'".');return[t.getCell(e[0].address),!1,e[2],e[3]]}}var r=this.func.compute(t);if(r[1])return r;for(var n=0;n<r[3].length;++n)t.setCell(r[3][n][0],r[3][n][1]);var o=this.argument.compute(t),a=r[2].concat(o[2]),p=r[3].concat(o[3]);if(o[1])return[o[0],!0,a,p];if(r[0]instanceof u.FunctionValue){for(var n=0;n<o[3].length;++n)t.setCell(o[3][n][0],o[3][n][1]);for(var c=[],n=0;n<t.memory[0];++n)void 0!==t.getCell(n)&&c.push([n,t.getCell(n)]);var i=r[0].compute(o[0],c);return[i[0],i[1],a.concat(i[2]),p.concat(i[3])]}if(r[0]instanceof u.ValueConstructor)return[r[0].construct(o[0]),!1,a,p];if(r[0]instanceof u.ExceptionConstructor)return[r[0].construct(o[0]),!1,a,p];if(r[0]instanceof u.PredefinedFunction){var i=r[0].apply(o[0]);return[i[0],i[1],a.concat(i[2]),p]}throw new s.EvaluationError(this.position,'Cannot evaluate the function "'+this.func+'" ('+r[0].constructor.name+").")},FunctionApplication}(c);exports.FunctionApplication=v;var T=function(t){function HandleException(e,n,i){var r=t.call(this)||this;return r.position=e,r.expression=n,r.match=i,r}return n(HandleException,t),HandleException.prototype.isSafe=function(t){return this.expression.isSafe(t)},HandleException.prototype.simplify=function(){return new HandleException(this.position,this.expression.simplify(),this.match.simplify())},HandleException.prototype.toString=function(){var t="( ( "+this.expression+" )";return t+=" handle "+this.match+" )"},HandleException.prototype.getType=function(t,e,n,r,o){void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===r&&(r=new Set),void 0===o&&(o=!1);var a=this.match.getType(t,e,n,r,o);if(!(a[0]instanceof i.FunctionType&&a[0].parameterType.equals(new i.CustomType("exn"))))throw new s.ElaborationError(this.match.position,'You can only handle things of type "exn" and not "'+a[0].parameterType+'".');var u=a[0].returnType,p=this.expression.getType(t,a[4],a[2],a[3],o);try{var c=u.merge(t,p[4],p[0]);return[c[0],a[1].concat(p[1]),p[2],p[3],c[1]]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.expression.position,'The "handle" cannot change the type of the expression from "'+p[0]+'" to "'+u+'": '+t[0])}},HandleException.prototype.compute=function(t){var e=this.expression.compute(t);if(e[1]){for(var n=0;n<e[3].length;++n)t.setCell(e[3][n][0],e[3][n][1]);var i=this.match.compute(t,e[0]);if(!i[1]||!i[0].equals(new u.ExceptionValue("Match",void 0,0)))return[i[0],i[1],e[2].concat(i[2]),e[3].concat(i[3])];e[2]=e[2].concat(i[2]),e[3]=e[3].concat(i[3])}return e},HandleException}(c);exports.HandleException=T;var g=function(t){function RaiseException(e,n){var i=t.call(this)||this;return i.position=e,i.expression=n,i}return n(RaiseException,t),RaiseException.prototype.simplify=function(){return new RaiseException(this.position,this.expression.simplify())},RaiseException.prototype.isSafe=function(t){return this.expression.isSafe(t)},RaiseException.prototype.toString=function(){return"raise "+this.expression},RaiseException.prototype.getType=function(t,e,n,r,o){void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===r&&(r=new Set),void 0===o&&(o=!1);var a=this.expression.getType(t,e,n,r,o);try{var u=a[0].merge(t,e,new i.CustomType("exn"));return[new i.AnyType,a[1],a[2],a[3],u[1]]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.expression.position,"Raising anything but exceptions will only raise exceptions: "+t[0])}},RaiseException.prototype.compute=function(t){var e=this.expression.compute(t);if(!(e[0]instanceof u.ExceptionValue))throw new s.EvaluationError(this.position,'Cannot "raise" value of type "'+e.constructor.name+'" (type must be "exn").');return[e[0],!0,e[2],e[3]]},RaiseException}(c);exports.RaiseException=g;var m=function(t){function Lambda(e,n){var i=t.call(this)||this;return i.position=e,i.match=n,i}return n(Lambda,t),Lambda.prototype.simplify=function(){return new Lambda(this.position,this.match.simplify())},Lambda.prototype.toString=function(){return"( fn "+this.match+" )"},Lambda.prototype.getType=function(t,e,n,i,r){return void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===i&&(i=new Set),void 0===r&&(r=!1),this.match.getType(t,e,n,i,r)},Lambda.prototype.compute=function(t){var e=p.getInitialState().getNestedState(t.id);return e.dynamicBasis=t.getDynamicChanges(-1),[new u.FunctionValue(e,[],this.match),!1,[],[]]},Lambda}(c);exports.Lambda=m;var w=function(){function Match(t,e){this.position=t,this.matches=e}return Match.prototype.toString=function(){for(var t="",e=0;e<this.matches.length;++e)e>0&&(t+=" | "),t+=this.matches[e][0],t+=" => "+this.matches[e][1];return t},Match.prototype.compute=function(t,e){for(var n=0;n<this.matches.length;++n){var i=t.getNestedState(t.id),r=this.matches[n][0].matches(i,e);if(void 0!==r){for(var o=0;o<r.length;++o)i.setDynamicValue(r[o][0],r[o][1],a.IdentifierStatus.VALUE_VARIABLE);return this.matches[n][1].compute(i)}}return[new u.ExceptionValue("Match",void 0,0),!0,[],[]]},Match.prototype.getType=function(t,e,n,r,o){void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===r&&(r=new Set),void 0===o&&(o=!1);for(var a=new i.FunctionType(new i.AnyType,new i.AnyType),u=[],p=e,c=this,h=0;h<this.matches.length;++h)!function(e){var h=new Map;p.forEach(function(t,e){h=h.set(e,t)});var f=c.matches[e][0].getType(t,p,n,r,!0);u=u.concat(f[1]);var l=c.matches[e][1].getType(t,f[4],f[2],f[3],o);u=u.concat(l[1]),n=l[2],r=l[3];var d=new i.FunctionType(f[0],l[0]);try{y=a.merge(t,l[4],d),a=y[0],p=y[1],a=a.instantiate(t,p)}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(c.position,"Match rules disagree on type: "+t[0])}a=a.instantiate(t,l[4]),p.forEach(function(t,e){"*"===e[1]&&"*"===e[2]||(h=h.set(e,t))}),p=h;var y}(h);return[a,u,n,r,p]},Match.prototype.simplify=function(){for(var t=[],e=0;e<this.matches.length;++e){var n=this.matches[e];t.push([n[0].simplify(),n[1].simplify()])}return new Match(this.position,t)},Match}();exports.Match=w;var E=function(t){function Wildcard(e){var n=t.call(this)||this;return n.position=e,n}return n(Wildcard,t),Wildcard.prototype.getType=function(t,e,n,r,o){void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===r&&(r=new Set),void 0===o&&(o=!1);for(var a=+n.substring(3)+1,s="";;++a)if(n="'"+n[1]+n[2]+a,!r.has(n)&&!e.has(n)&&void 0===t.getStaticValue(n))return s=n,[new i.TypeVariable(s),[],s,r.add(s),e]},Wildcard.prototype.compute=function(t){throw new s.InternalInterpreterError(this.position,"Wildcards are far too wild to have a value.")},Wildcard.prototype.matchType=function(t,e,n){return[[],n,e]},Wildcard.prototype.matches=function(t,e){return[]},Wildcard.prototype.simplify=function(){return this},Wildcard.prototype.toString=function(){return"_"},Wildcard}(c);exports.Wildcard=E;var S=function(t){function LayeredPattern(e,n,i,r){var o=t.call(this)||this;return o.position=e,o.identifier=n,o.typeAnnotation=i,o.pattern=r,o}return n(LayeredPattern,t),LayeredPattern.prototype.getType=function(t,e,n,i,r){if(void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),void 0===i&&(i=new Set),void 0===r&&(r=!1),!r)throw new s.InternalInterpreterError(this.position,"Layered patterns are far too layered to have a type.");var o=new f(-1,this.identifier),a=o.getType(t,e,n,i,!0),u=a[0];if(void 0!==this.typeAnnotation)try{var p=u.merge(t,a[4],this.typeAnnotation);e=p[1],u=p[0]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.position,"Wrong type annotation: "+t[0])}var c=this.pattern.getType(t,e,a[2],a[3],!0);try{var p=u.merge(t,c[4],c[0]);e=p[1],u=p[0]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.position,"Wrong type annotation: "+t[0])}return[u,a[1].concat(c[1]),c[2],c[3],e]},LayeredPattern.prototype.compute=function(t){throw new s.InternalInterpreterError(this.position,"Layered patterns are far too layered to have a value.")},LayeredPattern.prototype.matchType=function(t,e,n){var i=n;if(void 0!==this.typeAnnotation)try{var r=n.merge(t,e,this.typeAnnotation);e=r[1],i=r[0]}catch(t){if(!(t instanceof Array))throw t;throw new s.ElaborationError(this.position,"Wrong type annotation: "+t[0])}var o=this.pattern.matchType(t,e,i);return[[[this.identifier.getText(),i]].concat(o[0]),n,o[2]]},LayeredPattern.prototype.matches=function(t,e){var n=this.pattern.matches(t,e);return void 0===n?n:[[this.identifier.getText(),e]].concat(n)},LayeredPattern.prototype.simplify=function(){return this.typeAnnotation?new LayeredPattern(this.position,this.identifier,this.typeAnnotation.simplify(),this.pattern.simplify()):new LayeredPattern(this.position,this.identifier,void 0,this.pattern.simplify())},LayeredPattern.prototype.toString=function(){return this.identifier.getText()+" as "+this.pattern},LayeredPattern}(c);exports.LayeredPattern=S;var x=function(t){function InfixExpression(e,n){var i=t.call(this)||this;return i.expressions=e,i.operators=n,i}return n(InfixExpression,t),InfixExpression.prototype.matchType=function(t,e,n){return this.reParse(t).matchType(t,e,n)},InfixExpression.prototype.matches=function(t,e){return this.reParse(t).matches(t,e)},InfixExpression.prototype.simplify=function(){throw new s.InternalInterpreterError(this.position,"Ouch, I'm not fully parsed.")},InfixExpression.prototype.reParse=function(t){for(var e=this.operators,n=this.expressions,i=[],r=0;r<n.length;++r)i.push([r]);e.sort(function(e,n){var i=e[0],r=e[1],o=n[0],a=n[1],s=t.getInfixStatus(i),u=t.getInfixStatus(o);if(s.precedence>u.precedence)return-1;if(s.precedence<u.precedence)return 1;if(s.rightAssociative){if(r>a)return-1;if(r<a)return 1}else{if(r>a)return 1;if(r<a)return-1}return 0});for(var r=0;r<e.length;++r){if(r>0){var o=t.getInfixStatus(e[r][0]),a=t.getInfixStatus(e[r-1][0]);if(o.precedence===a.precedence&&o.rightAssociative!==a.rightAssociative&&(i[e[r-1][1]+1]===i[e[r][1]]||i[e[r-1][1]]===i[e[r][1]+1]))throw new s.ParserError("Could you ever imagine left associatives and right associatives living together in peace?",e[r][0].position)}for(var u=n[e[r][1]],p=n[e[r][1]+1],c=new v(e[r][0].position,new f(e[r][0].position,e[r][0]),new B(e[r][0].position,[u,p])),h=i[e[r][1]],l=0,d=i[e[r][1]+1];l<d.length;l++){var y=d[l];h.push(y)}for(var T=0,g=h;T<g.length;T++){var y=g[T];i[y]=h,n[y]=c}}return n[0]},InfixExpression}(c);exports.InfixExpression=x;var k=new f(0,new o.IdentifierToken("false",0)),I=new f(0,new o.IdentifierToken("true",0)),V=new f(0,new o.IdentifierToken("nil",0)),b=new f(0,new o.IdentifierToken("::",0)),A=function(t){function Conjunction(e,n,i){var r=t.call(this)||this;return r.position=e,r.leftOperand=n,r.rightOperand=i,r}return n(Conjunction,t),Conjunction.prototype.simplify=function(){return new O(this.position,this.leftOperand,this.rightOperand,k).simplify()},Conjunction.prototype.toString=function(){return"( "+this.leftOperand+" andalso "+this.rightOperand+" )"},Conjunction}(c);exports.Conjunction=A;var C=function(t){function Disjunction(e,n,i){var r=t.call(this)||this;return r.position=e,r.leftOperand=n,r.rightOperand=i,r}return n(Disjunction,t),Disjunction.prototype.simplify=function(){return new O(this.position,this.leftOperand,I,this.rightOperand).simplify()},Disjunction.prototype.toString=function(){return"( "+this.leftOperand+" orelse "+this.rightOperand+" )"},Disjunction}(c);exports.Disjunction=C;var B=function(t){function Tuple(e,n){var i=t.call(this)||this;return i.position=e,i.expressions=n,i}return n(Tuple,t),Tuple.prototype.matchType=function(t,e,n){return this.simplify().matchType(t,e,n)},Tuple.prototype.matches=function(t,e){return this.simplify().matches(t,e)},Tuple.prototype.simplify=function(){for(var t=[],e=0;e<this.expressions.length;++e)t.push([""+(e+1),this.expressions[e].simplify()]);return new l(this.position,!0,t)},Tuple.prototype.toString=function(){for(var t="( ",e=0;e<this.expressions.length;++e)e>0&&(t+=", "),t+=this.expressions[e];return t+" )"},Tuple}(c);exports.Tuple=B;var R=function(t){function List(e,n){var i=t.call(this)||this;return i.position=e,i.expressions=n,i}return n(List,t),List.prototype.matchType=function(t,e,n){return this.simplify().matchType(t,e,n)},List.prototype.matches=function(t,e){return this.simplify().matches(t,e)},List.prototype.simplify=function(){for(var t=V,e=this.expressions.length-1;e>=0;--e){var n=new B(-1,[this.expressions[e],t]).simplify();t=new v(-1,b,n)}return t},List.prototype.toString=function(){for(var t="[ ",e=0;e<this.expressions.length;++e)e>0&&(t+=", "),t+=this.expressions[e];return t+" ]"},List}(c);exports.List=R;var L=function(t){function Sequence(e,n){var i=t.call(this)||this;return i.position=e,i.expressions=n,i}return n(Sequence,t),Sequence.prototype.simplify=function(){for(var t=this.expressions.length-1,e=new w(-1,[[new E(0),this.expressions[t]]]),n=new _(-1,this.expressions[t-1],e),i=t-2;i>=0;--i)e=new w(-1,[[new E(0),n]]),n=new _(-1,this.expressions[i],e);return n.simplify()},Sequence.prototype.toString=function(){for(var t="( ",e=0;e<this.expressions.length;++e)e>0&&(t+="; "),t+=this.expressions[e];return t+" )"},Sequence}(c);exports.Sequence=L;var D=function(t){function RecordSelector(e,n){var i=t.call(this)||this;return i.position=e,i.label=n,i}return n(RecordSelector,t),RecordSelector.prototype.simplify=function(){return new m(this.position,new w(-1,[[new l(-1,!1,[[this.label.text,new f(-1,new o.IdentifierToken("__rs",-1))]]),new f(-1,new o.IdentifierToken("__rs",-1))]]))},RecordSelector.prototype.toString=function(){return"#"+this.label.getText()},RecordSelector}(c);exports.RecordSelector=D;var _=function(t){function CaseAnalysis(e,n,i){var r=t.call(this)||this;return r.position=e,r.expression=n,r.match=i,r}return n(CaseAnalysis,t),CaseAnalysis.prototype.simplify=function(){return new v(this.position,new m(this.position,this.match.simplify()),this.expression.simplify())},CaseAnalysis.prototype.toString=function(){return"case "+this.expression+" of "+this.match},CaseAnalysis}(c);exports.CaseAnalysis=_;var O=function(t){function Conditional(e,n,i,r){var o=t.call(this)||this;return o.position=e,o.condition=n,o.consequence=i,o.alternative=r,o}return n(Conditional,t),Conditional.prototype.simplify=function(){var t=new w(this.position,[[I,this.consequence],[k,this.alternative]]);return new _(this.position,this.condition,t).simplify()},Conditional.prototype.toString=function(){return"if "+this.condition+" then "+this.consequence+" else "+this.alternative},Conditional}(c);exports.Conditional=O;var P=function(t){function While(e,n,i){var r=t.call(this)||this;return r.position=e,r.condition=n,r.body=i,r}return n(While,t),While.prototype.simplify=function(){var t=new f(this.position,new o.IdentifierToken("__whl",this.position)),e=new v(this.position,t,new B(this.position,[])),n=new O(this.position,this.condition,new L(this.position,[this.body,e]),new B(this.position,[])),i=new r.ValueBinding(this.position,!0,t,new m(this.position,new w(this.position,[[new B(this.position,[]),n]]))),a=new r.ValueDeclaration(this.position,[],[i]);return new d(this.position,a,e).simplify()},While.prototype.toString=function(){return"( while "+this.condition+" do "+this.body+" )"},While}(c);exports.While=P},function(t,exports,e){"use strict";function interpret(t,e,i){void 0===e&&(e=n.getInitialState()),void 0===i&&(i={allowUnicodeInStrings:!1,allowSuccessorML:!1,disableElaboration:!1});var a=e.getNestedState(),s=r.lex(t,i),u=o.parse(s,a,i);if(a=e.getNestedState(),u=u.simplify(),!0===i.disableElaboration){var p=u.evaluate(e.getNestedState());return{state:p[0],evaluationErrored:p[1],error:p[2],warnings:p[3]}}var c=u.elaborate(a,new Map,"'*t0",!0);a=c[0];for(var h=u.evaluate(e.getNestedState()),f=0;f<c[1].length;++f)h[3].push(c[1][f]);if(h[1])return{state:h[0],evaluationErrored:!0,error:h[2],warnings:h[3]};for(var l=h[0];l.id>e.id;){if(void 0!==l.dynamicBasis){l.freeTypeVariables=a.getTypeVariableBinds(l.id);for(var f in l.dynamicBasis.valueEnvironment)if(Object.prototype.hasOwnProperty.call(l.dynamicBasis.valueEnvironment,f)){var d=a.getStaticValue(f,l.id);void 0!==d&&l.setStaticValue(f,d[0],d[1])}for(var f in l.dynamicBasis.typeEnvironment)if(Object.prototype.hasOwnProperty.call(l.dynamicBasis.typeEnvironment,f)){var d=a.getStaticType(f,l.id);void 0!==d&&l.setStaticType(f,d.type,d.constructors,d.arity)}for(var f in l.dynamicBasis.structureEnvironment)if(Object.prototype.hasOwnProperty.call(l.dynamicBasis.structureEnvironment,f)){var d=a.getStaticStructure(f,l.id);void 0!==d&&l.setStaticStructure(f,d)}for(var f in l.dynamicBasis.signatureEnvironment)if(Object.prototype.hasOwnProperty.call(l.dynamicBasis.signatureEnvironment,f)){var d=a.getStaticSignature(f,l.id);void 0!==d&&l.setStaticSignature(f,d)}}if(void 0===a.parent)break;for(l=l.parent;a.id>l.id&&void 0!==a.parent;)a=a.parent}return{state:h[0],evaluationErrored:!1,error:h[2],warnings:h[3]}}function getFirstState(t){return t?i.addStdLib(n.getInitialState(),{}):n.getInitialState()}Object.defineProperty(exports,"__esModule",{value:!0});var n=e(5),i=e(11),r=e(9),o=e(10);exports.interpret=interpret,exports.getFirstState=getFirstState},function(t,exports,e){"use strict";function lex(t,e){for(var n=new a(t,e),i=[];!n.finished();)i.push(n.nextToken());return i}Object.defineProperty(exports,"__esModule",{value:!0});var n=e(0),i=e(1),r=new Set(["abstype","and","andalso","as","case","datatype","do","else","end","exception","fn","fun","handle","if","in","infix","infixr","let","local","nonfix","of","op","open","orelse","raise","rec","then","type","val","with","withtype","while","(",")","[","]","{","}",",",":",";","...","_","|","=","=>","->","#","eqtype","functor","signature","struct","include","sharing","structure","where","sig",":>"]),o=new Set(["!","%","&","$","#","+","-","/",":","<","=",">","?","@","\\","~","`","^","|","*"]),a=function(){function Lexer(t,e){this.input=t,this.options=e,this.position=0,this.skipWhitespaceAndComments()}return Lexer.isAlphanumeric=function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||"'"===t||"_"===t},Lexer.isSymbolic=function(t){return o.has(t)},Lexer.isWhitespace=function(t){return" "===t||"\t"===t||"\n"===t||"\f"===t},Lexer.isNumber=function(t,e){return t>="0"&&t<="9"||e&&(t>="a"&&t<="f"||t>="A"&&t<="F")},Lexer.prototype.consumeChar=function(t,e){if(void 0===t&&(t=""),void 0===e&&(e=this.input.length-1),this.position>=this.input.length)throw""===t?new n.IncompleteError(e):new n.IncompleteError(e,t);return++this.position,this.input.charAt(this.position-1)},Lexer.prototype.getChar=function(t){return void 0===t&&(t=0),this.position+t>=this.input.length?"":this.input.charAt(this.position+t)},Lexer.prototype.skipWhitespace=function(){for(;Lexer.isWhitespace(this.getChar());)++this.position},Lexer.prototype.skipWhitespaceAndComments=function(){var t;do{for(t=this.position,this.skipWhitespace();this.position+1<this.input.length&&"(*"===this.input.substr(this.position,2);){var e=this.position;this.position+=2;for(var i=1;i>0;){if(this.position>this.input.length-2)throw new n.IncompleteError(e,"unclosed comment");var r=this.input.substr(this.position,2);"(*"===r?(++i,++this.position):"*)"===r&&(--i,++this.position),++this.position}}}while(this.position!==t);this.tokenStart=this.position},Lexer.prototype.readNumeric=function(t,e){void 0===e&&(e=-1);for(var n="";Lexer.isNumber(this.getChar(),t)&&n.length!==e;)n+=this.consumeChar();return n},Lexer.prototype.makeNumberToken=function(t,e,r,o){if(void 0===e&&(e=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),e&&r)throw new n.InternalInterpreterError(this.position);var a=this.input.substring(this.tokenStart,this.position);if(e)return new i.RealConstantToken(a,this.tokenStart,parseFloat(t));var s=parseInt(t,o?16:10);if(r)return new i.WordConstantToken(a,this.tokenStart,s);var u=a.charAt(0);return Lexer.isNumber(u,!1)&&"0"!==u?new i.NumericToken(a,this.tokenStart,s):new i.IntegerConstantToken(a,this.tokenStart,s)},Lexer.prototype.lexNumber=function(){var t="",e=!1,n=!1,i=!1,r=!1;if("~"===this.getChar()&&(++this.position,r=!0,t+="-"),"0"===this.getChar()&&("w"===this.getChar(1)||"x"===this.getChar(1))){++this.position,"w"===this.getChar()&&(n=!0),"x"===this.getChar(n?1:0)&&(e=!0);var o=n&&e?2:1;if(r&&n||!Lexer.isNumber(this.getChar(o),e))return t+="0",this.makeNumberToken(t,!1,!1,!1);this.position+=o}if(t+=this.readNumeric(e),e||n)return this.makeNumberToken(t,!1,n,e);if("."===this.getChar()){if(!Lexer.isNumber(this.getChar(1),!1))return this.makeNumberToken(t);t+=this.consumeChar(),t+=this.readNumeric(!1),i=!0}if("e"===this.getChar()||"E"===this.getChar()){if(Lexer.isNumber(this.getChar(1),!1))t+="e",++this.position,t+=this.readNumeric(!1);else{if("~"!==this.getChar(1)||!Lexer.isNumber(this.getChar(2),!1))return this.makeNumberToken(t,i);t+="e-",this.position+=2,t+=this.readNumeric(!1)}i=!0}return this.makeNumberToken(t,i)},Lexer.prototype.lexString=function(){var t=this.position;if('"'!==this.consumeChar())throw new n.InternalInterpreterError(this.position);for(var e="";'"'!==this.getChar();)if("\\"===this.getChar())if(++this.position,Lexer.isWhitespace(this.getChar())){if(this.skipWhitespace(),"\\"!==this.consumeChar("unterminated whitespace escape sequence"))throw new n.LexerError(this.position-1,"only whitespace is allowed in whitespace escape sequence")}else{var r=this.consumeChar();switch(r){case"a":e+="";break;case"b":e+="\b";break;case"t":e+="\t";break;case"n":e+="\n";break;case"v":e+="\v";break;case"f":e+="\f";break;case"r":e+="\r";break;case'"':e+='"';break;case"\\":e+="\\";break;case"^":var o=this.consumeChar().charCodeAt(0);if(o<64||o>95)throw new n.LexerError(this.position-1,'"'+String.fromCharCode(o)+'" does not represent a valid control character');e+=String.fromCharCode(o-64);break;case"u":var a=this.readNumeric(!0,4);if(4!==a.length)throw new n.LexerError(this.position-a.length-1,"unicode escape sequence must have four digits");var s=parseInt(a,16);if(s>=256&&!this.options.allowUnicodeInStrings)throw new n.LexerError(this.position-a.length-1,"character code "+a+" is too large, only 00 to ff is allowed");e+=String.fromCharCode(s);break;default:if(!Lexer.isNumber(r,!1))throw new n.LexerError(this.position-1,"invalid escape sequence");--this.position;var a=this.readNumeric(!1,3);if(3!==a.length)throw new n.LexerError(this.position-a.length-1,"numeric escape sequence must have three digits");var s=parseInt(a,10);if(s>=256&&!this.options.allowUnicodeInStrings)throw new n.LexerError(this.position-a.length-1,"character code "+a+" is too large, only 000 to 255 is allowed");e+=String.fromCharCode(s)}}else{var r=this.consumeChar("unterminated string",this.tokenStart).charCodeAt(0);if((r<33||r>126)&&32!==r&&r<128)throw new n.LexerError(this.position-1,"invalid character with code "+r+" in string");e+=String.fromCharCode(r)}if('"'!==this.consumeChar())throw new n.InternalInterpreterError(this.position);return new i.StringConstantToken(this.input.substring(t,this.position),this.tokenStart,e)},Lexer.prototype.lexCharacter=function(){if("#"!==this.consumeChar())throw new n.InternalInterpreterError(this.position);var t=this.lexString();if(1!==t.value.length)throw new n.LexerError(this.tokenStart,"character constant must have length 1, not "+t.value.length);return new i.CharacterConstantToken("#"+t.text,this.tokenStart,t.value)},Lexer.prototype.lexIdentifierOrKeyword=function(){var t,e="",o=this.getChar();if(Lexer.isSymbolic(o))t=Lexer.isSymbolic;else{if(!Lexer.isAlphanumeric(o)||Lexer.isNumber(o,!1)||"_"===o){if(r.has(o))return new i.KeywordToken(this.consumeChar(),this.tokenStart);if("."===o&&"."===this.getChar(1)&&"."===this.getChar(2))return this.position+=3,new i.KeywordToken("...",this.tokenStart);throw o.charCodeAt(0)<32?new n.LexerError(this.position,"invalid character with ascii code "+o.charCodeAt(0)):new n.LexerError(this.position,"invalid token: "+o)}t=Lexer.isAlphanumeric}do{e+=this.consumeChar()}while(t(this.getChar()));return"*"===e?new i.StarToken(this.tokenStart):"="===e?new i.EqualsToken(this.tokenStart):r.has(e)?new i.KeywordToken(e,this.tokenStart):"'"===o?"'"===e.charAt(1)?new i.EqualityTypeVariableToken(e,this.tokenStart):new i.TypeVariableToken(e,this.tokenStart):Lexer.isAlphanumeric(o)?new i.AlphanumericIdentifierToken(e,this.tokenStart):new i.IdentifierToken(e,this.tokenStart)},Lexer.prototype.lexLongIdentifierOrKeyword=function(){var t=this.tokenStart,e=this.lexIdentifierOrKeyword();if("."!==this.getChar())return e;var r=[];do{if(this.consumeChar(),!(e instanceof i.AlphanumericIdentifierToken))throw new n.LexerError(e.position,'expected structure name before "."');r.push(e),this.tokenStart=this.position,e=this.lexIdentifierOrKeyword()}while("."===this.getChar());if(!(e instanceof i.IdentifierToken||e instanceof i.StarToken)||e instanceof i.TypeVariableToken)throw new n.LexerError(e.position,e.text+" is not allowed in a long identifier");return new i.LongIdentifierToken(this.input.substring(t,this.position),t,r,e)},Lexer.prototype.nextToken=function(){var t;return this.tokenStart=this.position,t=Lexer.isNumber(this.getChar(),!1)||"~"===this.getChar()&&Lexer.isNumber(this.getChar(1),!1)?this.lexNumber():'"'===this.getChar()?this.lexString():"#"===this.getChar()&&'"'===this.getChar(1)?this.lexCharacter():this.lexLongIdentifierOrKeyword(),this.skipWhitespaceAndComments(),t},Lexer.prototype.finished=function(){return this.position>=this.input.length},Lexer}();exports.lex=lex},function(t,exports,e){"use strict";function parse(t,e,n){return void 0===n&&(n={}),new u(t,e,e.id,n).parseDeclaration(!0,!0)}Object.defineProperty(exports,"__esModule",{value:!0});var n=e(7),i=e(3),r=e(0),o=e(1),a=e(6),s=e(12),u=function(){function Parser(t,e,n,i){if(this.tokens=t,this.state=e,this.currentId=n,this.options=i,this.position=0,void 0===this.state)throw new r.InternalInterpreterError(-1,"What are you, stupid? Hurry up and give me a state already!")}return Parser.prototype.assertKeywordToken=function(t,e){if(void 0===e&&(e=void 0),!(t instanceof o.KeywordToken))throw new r.ParserError('Expected a reserved word, got "'+t.getText()+'" ('+t.constructor.name+").",t.position);if(void 0!==e&&t.text!==e)throw new r.ParserError('Expected "'+e+'" but got "'+t.text+'".',t.position)},Parser.prototype.assertVidToken=function(t){if(!t.isVid())throw new r.ParserError('Expected an identifier, got "'+t.getText()+'" ('+t.constructor.name+").",t.position)},Parser.prototype.assertIdentifierToken=function(t){if(!(t instanceof o.IdentifierToken))throw new r.ParserError('Expected an identifier, got "'+t.getText()+'" ('+t.constructor.name+").",t.position)},Parser.prototype.assertVidOrLongToken=function(t){if(!(t.isVid()||t instanceof o.LongIdentifierToken))throw new r.ParserError('Expected an identifier, got "'+t.getText()+'" ('+t.constructor.name+").",t.position)},Parser.prototype.assertIdentifierOrLongToken=function(t){if(!(t instanceof o.IdentifierToken||t instanceof o.LongIdentifierToken))throw new r.ParserError('Expected an identifier, got "'+t.getText()+'" ('+t.constructor.name+").",t.position)},Parser.prototype.assertRecordLabelToken=function(t){if(!t.isValidRecordLabel())throw new r.ParserError('Expected a record label "'+t.getText()+'" ('+t.constructor.name+").",t.position)},Parser.prototype.checkVidOrLongToken=function(t){return t.isVid()||t instanceof o.LongIdentifierToken},Parser.prototype.checkIdentifierOrLongToken=function(t){return t instanceof o.IdentifierToken||t instanceof o.LongIdentifierToken},Parser.prototype.checkKeywordToken=function(t,e){return void 0===e&&(e=void 0),t instanceof o.KeywordToken&&(void 0===e||t.text===e)},Parser.prototype.parseOpIdentifierToken=function(t){void 0===t&&(t=!1);var e=this.currentToken(),n=this.checkKeywordToken(e,"op");n&&++this.position,t?this.assertIdentifierOrLongToken(this.currentToken()):this.assertIdentifierToken(this.currentToken());var i=this.currentToken();return i.opPrefixed=n,++this.position,i},Parser.prototype.parseAtomicExpression=function(){var t=this.currentToken();if(this.checkKeywordToken(t,"op")){++this.position;var e=this.currentToken();return this.assertVidOrLongToken(e),e.opPrefixed=!0,++this.position,new n.ValueIdentifier(t.position,e)}if(this.checkKeywordToken(t,"{"))return++this.position,this.parseExpressionRow();if(this.checkKeywordToken(t,"(")){if(++this.position,this.checkKeywordToken(this.currentToken(),")"))return++this.position,new n.Tuple(t.position,[]);for(var i=[this.parseExpression()],a=!1,s=!1;;){var e=this.currentToken();if(!this.checkKeywordToken(e,",")||a)if(!this.checkKeywordToken(e,";")||s||(++this.position,a=!0,this.options.allowSuccessorML&&this.checkKeywordToken(this.currentToken(),")"))){if(!this.checkKeywordToken(e,")"))throw new r.IncompleteError(e.position,'Expected ",", ";" or ")" but got "'+e.getText()+'".');if(++this.position,1===i.length)return i[0];if(s)return new n.Tuple(t.position,i);if(a)return new n.Sequence(t.position,i);i.push(this.parseExpression())}else i.push(this.parseExpression());else++this.position,s=!0,i.push(this.parseExpression())}}if(this.checkKeywordToken(t,"[")){if(++this.position,this.checkKeywordToken(this.currentToken(),"]"))return++this.position,new n.List(t.position,[]);for(var i=[this.parseExpression()];;){var e=this.currentToken();if(!this.checkKeywordToken(e,",")){if(this.checkKeywordToken(e,"]"))return++this.position,new n.List(t.position,i);throw new r.ParserError('Expected "," or "]" but found "'+e.getText()+'".',e.position)}++this.position,i.push(this.parseExpression())}}if(this.checkKeywordToken(t,"#")){++this.position;var u=this.currentToken();return this.assertRecordLabelToken(u),++this.position,new n.RecordSelector(t.position,u)}if(this.checkKeywordToken(t,"let")){++this.position;var p=this.state;this.state=this.state.getNestedState(this.state.id);var c=this.parseDeclaration();this.assertKeywordToken(this.currentToken(),"in"),++this.position;for(var h=[this.parseExpression()],f=this.currentToken(),l=f.position;this.checkKeywordToken(f,";");)++this.position,h.push(this.parseExpression()),f=this.currentToken();return this.assertKeywordToken(f,"end"),++this.position,this.state=p,h.length>=2?new n.LocalDeclarationExpression(t.position,c,new n.Sequence(l,h)):new n.LocalDeclarationExpression(t.position,c,h[0])}if(t instanceof o.ConstantToken)return++this.position,new n.Constant(t.position,t);if(t.isVid()||t instanceof o.LongIdentifierToken){if(++this.position,void 0!==this.state.getInfixStatus(t)&&this.state.getInfixStatus(t).infix)throw new r.ParserError('Infix operator "'+t.getText()+'" appeared in non-infix context without "op".',t.position);return new n.ValueIdentifier(t.position,t)}throw new r.ParserError('Expected atomic expression, "'+t.getText()+'" found.',t.position)},Parser.prototype.parseExpressionRow=function(){for(var t=this.currentToken(),e=[],i=!0;;){var o=this.currentToken();if(this.checkKeywordToken(o,"}"))return++this.position,new n.Record(t.position,!0,e);if(i||!this.checkKeywordToken(o,",")){if(i=!1,!o.isValidRecordLabel())throw new r.ParserError('Expected "}", or identifier, got "'+o.getText()+'".',o.position);++this.position;var a=this.currentToken();this.assertKeywordToken(a,"="),++this.position,e.push([o.getText(),this.parseExpression()])}else++this.position}},Parser.prototype.parseApplicationExpression=function(){for(var t=this.currentToken(),e=this.parseAtomicExpression();;){var i=this.position,r=this.currentToken();if(this.checkVidOrLongToken(r)&&void 0!==this.state.getInfixStatus(r)&&this.state.getInfixStatus(r).infix)break;try{var o=this.parseAtomicExpression();e=new n.FunctionApplication(t.position,e,o)}catch(t){this.position=i;break}}return e},Parser.prototype.parseInfixExpression=function(){for(var t=[],e=[],i=0;;){t.push(this.parseApplicationExpression());var r=this.currentToken();if(!this.checkVidOrLongToken(r)||void 0===this.state.getInfixStatus(r)||!this.state.getInfixStatus(r).infix)break;++this.position,e.push([r,i++])}return 0===i?t[0]:new n.InfixExpression(t,e).reParse(this.state)},Parser.prototype.parseAppendedExpression=function(){var t=this.currentToken();if(this.checkKeywordToken(t,"raise"))return++this.position,new n.RaiseException(t.position,this.parseExpression());if(this.checkKeywordToken(t,"if")){++this.position;var e=this.parseExpression();this.assertKeywordToken(this.currentToken(),"then"),++this.position;var i=this.parseExpression();return this.options.allowSuccessorML&&!this.checkKeywordToken(this.currentToken(),"else")?new n.Conditional(t.position,e,i,new n.Tuple(-1,[])):(this.assertKeywordToken(this.currentToken(),"else"),++this.position,new n.Conditional(t.position,e,i,this.parseExpression()))}if(this.checkKeywordToken(t,"case")){++this.position;var e=this.parseExpression();return this.assertKeywordToken(this.currentToken(),"of"),++this.position,new n.CaseAnalysis(t.position,e,this.parseMatch())}if(this.checkKeywordToken(t,"while")){++this.position;var e=this.parseExpression();return this.assertKeywordToken(this.currentToken(),"do"),++this.position,new n.While(t.position,e,this.parseExpression())}if(this.checkKeywordToken(t,"fn"))return++this.position,new n.Lambda(t.position,this.parseMatch());for(var r=this.parseInfixExpression(),o=this.currentToken();this.checkKeywordToken(o,":");)++this.position,r=new n.TypedExpression(t.position,r,this.parseType()),o=this.currentToken();return r},Parser.prototype.parseExpression=function(){var t=this.parseAppendedExpression(),e=this.currentToken(),i=e;if(this.checkKeywordToken(e,"andalso")||this.checkKeywordToken(e,"orelse")){for(var r=[[t,[0]]],o=[],a=0;;){if(this.checkKeywordToken(e,"orelse"))o.push([1,a++]),++this.position;else{if(!this.checkKeywordToken(e,"andalso"))break;o.push([0,a++]),++this.position}r.push([this.parseAppendedExpression(),[a]]),e=this.currentToken()}o.sort();for(var s=0;s<o.length;++s){var u=r[o[s][1]][0],p=r[o[s][1]+1][0],c=void 0;c=0===o[s][0]?new n.Conjunction(u.position,u,p):new n.Disjunction(u.position,u,p);for(var h=r[o[s][1]][1],f=0,l=r[o[s][1]+1][1];f<l.length;f++){var d=l[f];h.push(d)}for(var y=0,v=h;y<v.length;y++){var d=v[y];r[d]=[c,h]}}t=r[0][0]}for(e=this.currentToken();this.checkKeywordToken(e,"handle");)++this.position,t=new n.HandleException(i.position,t,this.parseMatch()),e=this.currentToken();return t},Parser.prototype.parseSimpleStructureExpression=function(){var t=this.currentToken();if(this.checkKeywordToken(t,"struct")){++this.position;var e=this.parseDeclaration(!1,!0);return this.assertKeywordToken(this.currentToken(),"end"),++this.position,new s.StructureExpression(t.position,e)}if(this.checkKeywordToken(t,"let")){++this.position;var e=this.parseDeclaration(!1,!0);this.assertKeywordToken(this.currentToken(),"in"),++this.position;var n=this.parseStructureExpression();return this.assertKeywordToken(this.currentToken(),"end"),++this.position,new s.LocalDeclarationStructureExpression(t.position,e,n)}if(t instanceof o.IdentifierToken){if(++this.position,this.checkKeywordToken(this.currentToken(),"(")){++this.position;var n=this.parseStructureExpression();return this.assertKeywordToken(this.currentToken(),")"),++this.position,new s.FunctorApplication(t.position,t,n)}--this.position}if(this.checkIdentifierOrLongToken(t))return++this.position,new s.StructureIdentifier(t.position,t);throw new r.ParserError("Expected a simple structure expression.",t.position)},Parser.prototype.parseStructureExpression=function(){for(var t=this.currentToken(),e=this.parseSimpleStructureExpression();;)if(this.checkKeywordToken(this.currentToken(),":"))++this.position,e=new s.TransparentConstraint(t.position,e,this.parseSignatureExpression());else{if(!this.checkKeywordToken(this.currentToken(),":>"))break;++this.position,e=new s.OpaqueConstraint(t.position,e,this.parseSignatureExpression())}return e},Parser.prototype.parseSimpleSignatureExpression=function(){var t=this.currentToken();if(this.checkKeywordToken(t,"sig")){++this.position;var e=this.parseSpecification();return this.assertKeywordToken(this.currentToken(),"end"),++this.position,new s.SignatureExpression(t.position,e)}if(t instanceof o.IdentifierToken)return++this.position,new s.SignatureIdentifier(t.position,t);throw new r.ParserError("Expected a simple signature expression.",t.position)},Parser.prototype.parseSignatureExpression=function(){for(var t=this.currentToken(),e=this.parseSimpleSignatureExpression();this.checkKeywordToken(this.currentToken(),"where");){++this.position,this.assertKeywordToken(this.currentToken(),"type"),++this.position;var n=this.parseTypeVarSequence();this.assertIdentifierOrLongToken(this.currentToken());var i=this.currentToken();++this.position,this.assertKeywordToken(this.currentToken(),"="),++this.position,e=new s.TypeRealisation(t.position,e,n,i,this.parseType())}return e},Parser.prototype.parseSimpleSpecification=function(){var t=this.currentToken();if(this.checkKeywordToken(t,"val")){++this.position;for(var e=[];;){this.assertIdentifierOrLongToken(this.currentToken());var n=this.currentToken();if(++this.position,this.assertKeywordToken(this.currentToken(),":"),++this.position,e.push([n,this.parseType()]),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return new s.ValueSpecification(t.position,e)}if(this.checkKeywordToken(t,"type")){++this.position;for(var e=[];;){var i=this.parseTypeVarSequence();if(this.assertIdentifierToken(this.currentToken()),e.push([i,this.currentToken()]),++this.position,!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return new s.TypeSpecification(t.position,e)}if(this.checkKeywordToken(t,"eqtype")){++this.position;for(var e=[];;){var i=this.parseTypeVarSequence();if(this.assertIdentifierToken(this.currentToken()),e.push([i,this.currentToken()]),++this.position,!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return new s.EqualityTypeSpecification(t.position,e)}if(this.checkKeywordToken(t,"datatype")){if(++this.position+2<this.tokens.length&&this.checkKeywordToken(this.tokens[this.position+2],"datatype")){this.assertIdentifierToken(this.currentToken());var r=this.currentToken();++this.position,this.assertKeywordToken(this.currentToken(),"="),++this.position,this.assertKeywordToken(this.currentToken(),"datatype"),++this.position,this.assertIdentifierOrLongToken(this.currentToken());var o=this.currentToken();return++this.position,new s.DatatypeReplicationSpecification(t.position,r,o)}for(var e=[];;){var i=this.parseTypeVarSequence();this.assertIdentifierToken(this.currentToken());var r=this.currentToken();++this.position,this.assertKeywordToken(this.currentToken(),"="),++this.position;for(var a=[];;){this.assertIdentifierToken(this.currentToken());var u=this.currentToken();++this.position;var p=void 0;if(this.checkKeywordToken(this.currentToken(),"of")&&(++this.position,p=this.parseType()),a.push([u,p]),!this.checkKeywordToken(this.currentToken(),"|"))break;++this.position}if(e.push([i,r,a]),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return new s.DatatypeSpecification(t.position,e)}if(this.checkKeywordToken(t,"exception")){++this.position;for(var e=[];;){this.assertIdentifierToken(this.currentToken());var r=this.currentToken();++this.position;var p=void 0;if(this.checkKeywordToken(this.currentToken(),"of")&&(++this.position,p=this.parseType()),e.push([r,p]),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return new s.ExceptionSpecification(t.position,e)}if(this.checkKeywordToken(t,"structure")){++this.position;for(var e=[];;){this.assertIdentifierToken(this.currentToken());var r=this.currentToken();if(++this.position,this.assertKeywordToken(this.currentToken(),":"),++this.position,e.push([r,this.parseSignatureExpression()]),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return new s.StructureSpecification(t.position,e)}return this.checkKeywordToken(t,"include")?(++this.position,new s.IncludeSpecification(t.position,this.parseSignatureExpression())):new s.EmptySpecification(t.position)},Parser.prototype.parseSequentialSpecification=function(){for(var t=this.currentToken(),e=[];;){var n=this.parseSimpleSpecification();if(n instanceof s.EmptySpecification)break;e.push(n),this.checkKeywordToken(this.currentToken(),";")&&++this.position}return new s.SequentialSpecification(t.position,e)},Parser.prototype.parseSpecification=function(){for(var t=this.currentToken(),e=this.parseSequentialSpecification();this.checkKeywordToken(this.currentToken(),"sharing");){++this.position,this.assertKeywordToken(this.currentToken(),"type"),++this.position,this.assertIdentifierOrLongToken(this.currentToken());var n=[this.currentToken()];for(++this.position;this.checkKeywordToken(this.currentToken(),"=");)++this.position,this.assertIdentifierOrLongToken(this.currentToken()),n.push(this.currentToken()),++this.position;if(n.length<2)throw new r.ParserError('A "sharing" expression requires at least 2 type names.',t.position);e=new s.SharingSpecification(t.position,e,n)}return e},Parser.prototype.parseMatch=function(){var t=this.currentToken();this.options.allowSuccessorML&&this.checkKeywordToken(this.currentToken(),"|")&&++this.position;for(var e=[];;){var i=this.parsePattern();this.assertKeywordToken(this.currentToken(),"=>"),++this.position;var r=this.parseExpression();if(e.push([i,r]),!this.checkKeywordToken(this.currentToken(),"|"))break;++this.position}return new n.Match(t.position,e)},Parser.prototype.parsePatternRow=function(){for(var t=this.currentToken(),e=[],i=!0,a=!0;;){var s=this.currentToken();if(this.checkKeywordToken(s,"}"))return++this.position,new n.Record(t.position,a,e);if(!a)throw new r.ParserError("Record wildcard must appear as last element of the record.",s.position);if(i||!this.checkKeywordToken(s,","))if(i=!1,this.checkKeywordToken(s,"..."))a=!1,++this.position;else{if(!s.isValidRecordLabel())throw new r.ParserError('Expected "}", "...", or identifier.',s.position);++this.position;var u=this.currentToken();if(!(u instanceof o.KeywordToken))throw new r.ParserError('Expected ":", "as", ",", or "=", got '+u.getText()+'".',u.position);if("="===u.text){++this.position,e.push([s.getText(),this.parsePattern()]);continue}var p=void 0;if(s instanceof o.NumericToken)throw new r.ParserError('You cannot assign to "'+s.getText()+'".',s.position);var c=new n.ValueIdentifier(s.position,s);":"===u.text&&(++this.position,p=this.parseType(),u=this.currentToken()),"as"===u.text?(++this.position,c=new n.LayeredPattern(c.position,c.name,p,this.parsePattern()),u=this.currentToken()):void 0!==p&&(c=new n.TypedExpression(c.position,c,p)),e.push([s.getText(),c])}else++this.position}},Parser.prototype.parseAtomicPattern=function(){if(this.position>=this.tokens.length)throw new r.ParserError("Unexpected end of token stream",-1);var t=this.currentToken();if(this.checkKeywordToken(t,"op")){++this.position;var e=this.currentToken();this.assertIdentifierOrLongToken(e),e.opPrefixed=!0,++this.position;var i=this.position;try{if(!(e instanceof o.LongIdentifierToken)){var a=this.currentToken(),s=void 0;return this.checkKeywordToken(a,":")&&(++this.position,s=this.parseType(),a=this.currentToken()),this.assertKeywordToken(a,"as"),++this.position,new n.LayeredPattern(t.position,e,s,this.parsePattern())}}catch(t){this.position=i}return new n.ValueIdentifier(t.position,e)}if(this.checkKeywordToken(t,"_"))return++this.position,new n.Wildcard(t.position);if(this.checkKeywordToken(t,"{")){++this.position;return this.parsePatternRow()}if(this.checkKeywordToken(t,"(")){if(++this.position,this.checkKeywordToken(this.currentToken(),")"))return++this.position,new n.Tuple(t.position,[]);for(var u=[this.parsePattern()];;){var e=this.currentToken();if(!this.checkKeywordToken(e,",")){if(this.checkKeywordToken(e,")"))return++this.position,1===u.length?u[0]:new n.Tuple(t.position,u);throw new r.ParserError('Expected "," or ")", but got "'+e.getText()+'".',e.position)}++this.position,u.push(this.parsePattern())}}if(this.checkKeywordToken(t,"[")){if(++this.position,this.checkKeywordToken(this.currentToken(),"]"))return++this.position,new n.List(t.position,[]);for(var u=[this.parsePattern()];;){var e=this.currentToken();if(!this.checkKeywordToken(e,",")){if(this.checkKeywordToken(e,"]"))return++this.position,new n.List(t.position,u);throw new r.ParserError('Expected "," or "]" but found "'+e.getText()+'".',e.position)}++this.position,u.push(this.parsePattern())}}else{if(t instanceof o.ConstantToken)return++this.position,new n.Constant(t.position,t);if(t instanceof o.IdentifierToken||t instanceof o.LongIdentifierToken){++this.position;var i=this.position;try{if(!(t instanceof o.LongIdentifierToken)){var a=this.currentToken(),s=void 0;return this.checkKeywordToken(a,":")&&(++this.position,s=this.parseType(),a=this.currentToken()),this.assertKeywordToken(a,"as"),++this.position,new n.LayeredPattern(t.position,t,s,this.parsePattern())}}catch(t){this.position=i}return new n.ValueIdentifier(t.position,t)}}throw new r.ParserError('Expected atomic pattern but got "'+t.getText()+'".',t.position)},Parser.prototype.parseApplicationPattern=function(){for(var t=this.currentToken(),e=this.parseAtomicPattern();;){var i=this.position,r=this.currentToken();if(this.checkVidOrLongToken(r)&&void 0!==this.state.getInfixStatus(r)&&this.state.getInfixStatus(r).infix)break;try{var o=this.parseAtomicPattern();e=new n.FunctionApplication(t.position,e,o)}catch(t){this.position=i;break}}return e},Parser.prototype.parseInfixPattern=function(){for(var t=[],e=[],i=0;;){t.push(this.parseApplicationPattern());var r=this.currentToken();if(!this.checkIdentifierOrLongToken(r)||void 0===this.state.getInfixStatus(r)||!this.state.getInfixStatus(r).infix)break;++this.position,e.push([r,i++])}return 0===i?t[0]:new n.InfixExpression(t,e).reParse(this.state)},Parser.prototype.parsePattern=function(){for(var t=this.currentToken(),e=this.parseInfixPattern();this.checkKeywordToken(this.currentToken(),":");)++this.position,e=new n.TypedExpression(t.position,e,this.parseType());return e},Parser.prototype.parseTypeRow=function(){for(var t=this.currentToken(),e=new Map,n=!0;;){var a=this.currentToken();if(this.checkKeywordToken(a,"}"))return++this.position,new i.RecordType(e,!0,t.position);{if(n||!this.checkKeywordToken(a,",")){if(n=!1,a.isValidRecordLabel()){++this.position;var s=this.currentToken();if(!(s instanceof o.KeywordToken))throw new r.ParserError('Expected ":".',s.position);if(":"===s.text){if(++this.position,e.has(a.getText()))throw new r.ParserError('Duplicate record label "'+a.getText()+'".',a.position);e.set(a.getText(),this.parseType());continue}throw new r.ParserError('Expected ":".',s.position)}throw new r.ParserError('Expected "}", or an identifier, got "'+a.getText()+'".',a.position)}++this.position}}},Parser.prototype.parseSimpleType=function(){var t=this.currentToken();if(t instanceof o.TypeVariableToken)return++this.position,new i.TypeVariable(t.getText(),t.position);if(this.checkIdentifierOrLongToken(t))return++this.position,new i.CustomType(t.getText(),[],t.position);if(this.checkKeywordToken(t,"{"))return++this.position,this.parseTypeRow();if(this.checkKeywordToken(t,"(")){if(++this.position,this.checkKeywordToken(this.currentToken(),")"))throw new r.ParserError('Use "{}" or "unit" to denote the unit type.',this.currentToken().position);for(var e=[this.parseType()];;){var n=this.currentToken();{if(!this.checkKeywordToken(n,",")){if(this.checkKeywordToken(n,")")){if(++this.position,1===e.length)return e[0];this.assertIdentifierOrLongToken(this.currentToken());var a=this.currentToken();return++this.position,new i.CustomType(a.getText(),e,t.position)}throw new r.ParserError('Expected "," or ")", got "'+n.getText()+'".',n.position)}++this.position,e.push(this.parseType())}}}throw new r.ParserError('Expected either "(" or "{" got "'+t.getText()+'".',t.position)},Parser.prototype.parseType=function(){var t=this.parseTupleType(),e=this.currentToken();if(!this.checkKeywordToken(e,"->"))return t;++this.position;var n=this.parseType();return new i.FunctionType(t,n,e.position)},Parser.prototype.parseTupleType=function(){for(var t=[this.parseCustomType()],e=this.currentToken(),n=e.position;this.checkKeywordToken(this.currentToken(),"*");)++this.position,t.push(this.parseCustomType());return 1===t.length?t[0]:new i.TupleType(t,n)},Parser.prototype.parseCustomType=function(){for(var t=this.currentToken(),e=this.parseSimpleType();this.position<this.tokens.length;){var n=this.currentToken();if(!this.checkIdentifierOrLongToken(n))return e;++this.position,e=n instanceof o.LongIdentifierToken?new i.CustomType(n.id.getText(),[e],t.position,n):new i.CustomType(n.getText(),[e],t.position)}return e},Parser.prototype.parseValueBinding=function(){var t=this.currentToken();if(this.checkKeywordToken(t,"rec")){++this.position;var e=this.parseValueBinding();return e.position=t.position,e.isRecursive=!0,e}var n=this.parsePattern();return this.assertKeywordToken(this.currentToken(),"="),++this.position,new a.ValueBinding(t.position,!1,n,this.parseExpression())},Parser.prototype.parseFunctionValueBinding=function(){for(var t=this.currentToken(),e=[],i=-1,o=void 0;;){var s=[],u=void 0,p=void 0;if(this.checkKeywordToken(this.currentToken(),"(")){var c=this.parsePattern();if(!(c instanceof n.FunctionApplication&&c.argument.simplify()instanceof n.Record&&2===c.argument.simplify().entries.length&&c.func instanceof n.ValueIdentifier))throw new r.ParserError('If you start a function declaration with a "(", some infix expression should follow. But you gave me "'+c+'" ('+c.constructor.name+").",c.position);p=c.func,s.push(c.argument)}else{var h=this.position,f=!1,l=!1;try{var d=this.parseOpIdentifierToken();if(p=new n.ValueIdentifier(d.position,d),void 0!==this.state.getInfixStatus(p.name)&&this.state.getInfixStatus(p.name).infix&&!p.name.opPrefixed)throw f=!0,new r.ParserError('Missing "op".',p.name.position);for(;;){if(this.checkKeywordToken(this.currentToken(),"=")||this.checkKeywordToken(this.currentToken(),":"))break;var c=this.parseAtomicPattern();if(c instanceof n.ValueIdentifier&&void 0!==this.state.getInfixStatus(c.name)&&this.state.getInfixStatus(c.name).infix)throw l=!0,new r.ParserError('Cute little infix identifiers such as "'+c+'" sure should play somewhere else.',c.position);s.push(c)}}catch(t){if(f)throw t;f=!1;try{this.position=h;var y=this.parseAtomicPattern();if(this.assertIdentifierOrLongToken(this.currentToken()),p=new n.ValueIdentifier(this.currentToken().position,this.currentToken()),void 0===this.state.getInfixStatus(this.currentToken())||!this.state.getInfixStatus(this.currentToken()).infix){if(l)throw f=!0,t;throw new r.ParserError('"'+this.currentToken().getText()+'" does not have infix status.',this.currentToken().position)}++this.position;var v=this.parseAtomicPattern();s.push(new n.Tuple(-1,[y,v]))}catch(e){throw t}}}if(this.checkKeywordToken(this.currentToken(),":")&&(++this.position,u=this.parseType()),this.assertKeywordToken(this.currentToken(),"="),++this.position,-1===i)i=s.length;else if(2!==i&&3!==i&&i!==s.length)throw new r.ParserError("Different number of arguments.",t.position);if(0===i)throw new r.ParserError('Functions need arguments to survive. Rely on "val" instead.',t.position);if(void 0===o)o=p;else if(p.name.getText()!==o.name.getText())throw new r.ParserError('Different function names in different cases ("'+p.name.getText()+'" vs. "'+o.name.getText()+'")',t.position);if(e.push([s,u,this.parseExpression()]),!this.checkKeywordToken(this.currentToken(),"|"))break;++this.position}return new a.FunctionValueBinding(t.position,e,o)},Parser.prototype.parseTypeBinding=function(){var t=this.currentToken(),e=this.parseTypeVarSequence();this.assertIdentifierToken(this.currentToken());var n=this.currentToken();return++this.position,this.assertKeywordToken(this.currentToken(),"="),++this.position,new a.TypeBinding(t.position,e,n,this.parseType())},Parser.prototype.parseTypeBindingSeq=function(){for(var t=[];;){if(t.push(this.parseTypeBinding()),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return t},Parser.prototype.parseExceptionBinding=function(){var t=this.currentToken(),e=this.parseOpIdentifierToken();if(this.checkKeywordToken(this.currentToken(),"of")){++this.position;var n=this.parseType();return new a.DirectExceptionBinding(t.position,e,n)}if(this.checkKeywordToken(this.currentToken(),"=")){++this.position;var i=this.parseOpIdentifierToken(!0);return new a.ExceptionAlias(t.position,e,i)}return new a.DirectExceptionBinding(t.position,e,void 0)},Parser.prototype.parseDatatypeBinding=function(){var t=this.currentToken(),e=this.parseTypeVarSequence();this.assertIdentifierToken(this.currentToken());var n=this.currentToken();++this.position,this.assertKeywordToken(this.currentToken(),"="),++this.position;for(var i=[];;){var r=this.parseOpIdentifierToken();if(this.checkKeywordToken(this.currentToken(),"of")){++this.position;var o=this.parseType();i.push([r,o])}else i.push([r,void 0]);if(!this.checkKeywordToken(this.currentToken(),"|"))break;++this.position}return new a.DatatypeBinding(t.position,e,n,i)},Parser.prototype.parseDatatypeBindingSeq=function(){for(var t=[];;){if(t.push(this.parseDatatypeBinding()),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return t},Parser.prototype.parseStructureBinding=function(){var t=this.currentToken();this.assertIdentifierToken(this.currentToken());var e=this.currentToken();if(++this.position,this.checkKeywordToken(this.currentToken(),":")){++this.position;var n=this.parseSignatureExpression();this.assertKeywordToken(this.currentToken(),"="),++this.position;var i=this.parseStructureExpression();return new s.StructureBinding(t.position,e,new s.TransparentConstraint(t.position,i,n))}if(this.checkKeywordToken(this.currentToken(),":>")){++this.position;var n=this.parseSignatureExpression();this.assertKeywordToken(this.currentToken(),"="),++this.position;var i=this.parseStructureExpression();return new s.StructureBinding(t.position,e,new s.OpaqueConstraint(t.position,i,n))}return this.assertKeywordToken(this.currentToken(),"="),++this.position,new s.StructureBinding(t.position,e,this.parseStructureExpression())},Parser.prototype.parseStructureBindingSeq=function(){for(var t=[];;){if(t.push(this.parseStructureBinding()),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return t},Parser.prototype.parseSignatureBinding=function(){var t=this.currentToken();this.assertIdentifierToken(this.currentToken());var e=this.currentToken();return++this.position,this.assertKeywordToken(this.currentToken(),"="),++this.position,new s.SignatureBinding(t.position,e,this.parseSignatureExpression())},Parser.prototype.parseSignatureBindingSeq=function(){for(var t=[];;){if(t.push(this.parseSignatureBinding()),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return t},Parser.prototype.parseFunctorBinding=function(){var t=this.currentToken();this.assertIdentifierToken(this.currentToken());var e=this.currentToken();if(++this.position,this.assertKeywordToken(this.currentToken(),"("),++this.position,this.currentToken()instanceof o.IdentifierToken){var n=this.currentToken();++this.position,this.assertKeywordToken(this.currentToken(),":"),++this.position;var i=this.parseSignatureExpression();if(this.assertKeywordToken(this.currentToken(),")"),++this.position,this.checkKeywordToken(this.currentToken(),":")){++this.position;var r=this.parseSignatureExpression();return this.assertKeywordToken(this.currentToken(),"="),++this.position,new s.FunctorBinding(t.position,e,n,i,new s.TransparentConstraint(t.position,this.parseStructureExpression(),r))}if(this.checkKeywordToken(this.currentToken(),":>")){++this.position;var r=this.parseSignatureExpression();return this.assertKeywordToken(this.currentToken(),"="),++this.position,new s.FunctorBinding(t.position,e,n,i,new s.OpaqueConstraint(t.position,this.parseStructureExpression(),r))}return this.assertKeywordToken(this.currentToken(),"="),++this.position,new s.FunctorBinding(t.position,e,n,i,this.parseStructureExpression())}var u=this.parseSpecification(),p=new s.SignatureExpression(-1,u);this.assertKeywordToken(this.currentToken(),")"),++this.position;var c=!1,h=void 0;this.checkKeywordToken(this.currentToken(),":")?(++this.position,h=this.parseSignatureExpression()):this.checkKeywordToken(this.currentToken(),":>")&&(c=!0,++this.position,h=this.parseSignatureExpression()),this.assertKeywordToken(this.currentToken(),"="),++this.position;var f=this.parseStructureExpression(),l=new o.AlphanumericIdentifierToken("__farg",-1);return void 0!==h&&(f=c?new s.OpaqueConstraint(-1,f,h):new s.TransparentConstraint(-1,f,h)),f=new s.LocalDeclarationStructureExpression(-1,new a.OpenDeclaration(-1,[l]),f),new s.FunctorBinding(t.position,e,l,p,f)},Parser.prototype.parseFunctorBindingSeq=function(){for(var t=[];;){if(t.push(this.parseFunctorBinding()),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return t},Parser.prototype.parseTypeVarSequence=function(t){void 0===t&&(t=!1);var e=this.currentToken(),n=[];if(e instanceof o.TypeVariableToken)return n.push(new i.TypeVariable(e.text,e.position)),++this.position,n;if(this.checkKeywordToken(e,"("))for(++this.position;;){if(!((e=this.currentToken())instanceof o.TypeVariableToken)){if(t)return;throw new r.ParserError("Expected a type varible.",e.position)}if(n.push(new i.TypeVariable(e.text,e.position)),++this.position,e=this.currentToken(),!this.checkKeywordToken(e,",")){if(this.checkKeywordToken(e,")")){++this.position;break}throw new r.ParserError('Expected "," or ")" but got "'+e.getText()+'".',e.position)}++this.position}return n},Parser.prototype.parseDeclaration=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);for(var n=[],i=this.currentToken(),r=this.currentId++;this.position<this.tokens.length;){var o=this.parseSimpleDeclaration(t,e);if(o instanceof a.EmptyDeclaration){if(this.position>=this.tokens.length||this.checkKeywordToken(this.currentToken(),"in")||this.checkKeywordToken(this.currentToken(),"end"))break}else n.push(o),this.checkKeywordToken(this.currentToken(),";")&&++this.position}return new a.SequentialDeclaration(i.position,n,r)},Parser.prototype.parseSimpleDeclaration=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=this.currentToken(),u=this.currentId++;if(this.checkKeywordToken(i,"val")){++this.position;var p=this.parseTypeVarSequence(!0);void 0===p&&(--this.position,p=[]);for(var c=[],h=!1;;){var f=this.parseValueBinding();if(f.isRecursive){if(h=!0,!(f.expression instanceof n.Lambda))throw new r.ParserError('Using "rec" requires binding a lambda.',f.position);if(!(f.pattern instanceof n.ValueIdentifier||f.pattern instanceof n.Wildcard))throw new r.ParserError('Using "rec" requires binding to a single identifier and not "'+f.pattern.toString(0,!0)+'".',f.position)}if(f.isRecursive=h,c.push(f),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return new a.ValueDeclaration(i.position,p,c,u)}if(this.checkKeywordToken(i,"fun")){++this.position;var p=this.parseTypeVarSequence(!0);void 0===p&&(--this.position,p=[]);for(var l=[];;){if(l.push(this.parseFunctionValueBinding()),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return new a.FunctionDeclaration(i.position,p,l,u)}if(this.checkKeywordToken(i,"type"))return++this.position,new a.TypeDeclaration(i.position,this.parseTypeBindingSeq(),u);if(this.checkKeywordToken(i,"datatype")){if(this.position+3<this.tokens.length&&this.checkKeywordToken(this.tokens[this.position+3],"datatype")){++this.position;var d=this.currentToken();this.assertIdentifierToken(d),++this.position,this.assertKeywordToken(this.currentToken(),"="),++this.position,this.assertKeywordToken(this.currentToken(),"datatype"),++this.position;var y=this.currentToken();return this.assertIdentifierOrLongToken(y),++this.position,new a.DatatypeReplication(i.position,d,y,u)}++this.position;var v=this.parseDatatypeBindingSeq();if(this.checkKeywordToken(this.currentToken(),"withtype")){++this.position;var T=this.parseTypeBindingSeq();return new a.DatatypeDeclaration(i.position,v,T,u)}return new a.DatatypeDeclaration(i.position,v,void 0,u)}if(this.checkKeywordToken(i,"abstype")){++this.position;var g=this.state;this.state=this.state.getNestedState(this.state.id);var v=this.parseDatatypeBindingSeq(),m=void 0;this.checkKeywordToken(this.currentToken(),"withtype")&&(++this.position,m=this.parseTypeBindingSeq()),this.assertKeywordToken(this.currentToken(),"with"),++this.position;var w=this.parseDeclaration();return this.assertKeywordToken(this.currentToken(),"end"),++this.position,this.state=g,new a.AbstypeDeclaration(i.position,v,m,w,u)}if(this.checkKeywordToken(i,"exception")){++this.position;for(var E=[];;){if(E.push(this.parseExceptionBinding()),!this.checkKeywordToken(this.currentToken(),"and"))break;++this.position}return new a.ExceptionDeclaration(i.position,E,u)}if(this.checkKeywordToken(i,"local")){++this.position;var g=this.state;this.state=this.state.getNestedState(this.state.id);var w=this.parseDeclaration(!1,e);this.assertKeywordToken(this.currentToken(),"in"),++this.position;var S=this.parseDeclaration(!1,e);return this.assertKeywordToken(this.currentToken(),"end"),++this.position,this.state=g,new a.LocalDeclaration(i.position,w,S,u)}if(this.checkKeywordToken(i,"open")){++this.position;for(var x=[];this.checkIdentifierOrLongToken(this.currentToken());)x.push(this.currentToken()),++this.position;if(0===x.length)throw new r.ParserError('Empty "open" declaration.',this.currentToken().position);return new a.OpenDeclaration(i.position,x,u)}if(this.checkKeywordToken(i,"infix")){++this.position;var k=0;if(this.currentToken()instanceof o.IntegerConstantToken){if(1!==this.currentToken().text.length)throw new r.ParserError("Precedences may only be single digits.",this.currentToken().position);k=this.currentToken().value,++this.position}for(var x=[];this.currentToken().isVid();)x.push(this.currentToken()),++this.position;if(0===x.length)throw new r.ParserError('Empty "infix" declaration.',this.currentToken().position);var I=new a.InfixDeclaration(i.position,x,k,u);return this.state=I.evaluate(this.state)[0],I}if(this.checkKeywordToken(i,"infixr")){++this.position;var k=0;if(this.currentToken()instanceof o.IntegerConstantToken){if(1!==this.currentToken().text.length)throw new r.ParserError("Precedences may only be single digits.",this.currentToken().position);k=this.currentToken().value,++this.position}for(var x=[];this.currentToken().isVid();)x.push(this.currentToken()),++this.position;if(0===x.length)throw new r.ParserError('Empty "infixr" declaration.',this.currentToken().position);var I=new a.InfixRDeclaration(i.position,x,k,u);return this.state=I.evaluate(this.state)[0],I}if(this.checkKeywordToken(i,"nonfix")){++this.position;for(var x=[];this.currentToken().isVid();)x.push(this.currentToken()),++this.position;if(0===x.length)throw new r.ParserError('Empty "nonfix" declaration.',this.currentToken().position);var I=new a.NonfixDeclaration(i.position,x,u);return this.state=I.evaluate(this.state)[0],I}if(this.options.allowSuccessorML&&this.checkKeywordToken(i,"do"))return++this.position,new a.Evaluation(i.position,this.parseExpression());if((!0===this.options.allowStructuresAnywhere||e)&&this.checkKeywordToken(i,"structure"))return++this.position,new s.StructureDeclaration(i.position,this.parseStructureBindingSeq());if((!0===this.options.allowSignaturesAnywhere||t)&&this.checkKeywordToken(i,"signature"))return++this.position,new s.SignatureDeclaration(i.position,this.parseSignatureBindingSeq());if((!0===this.options.allowFunctorsAnywhere||t)&&this.checkKeywordToken(i,"functor"))return++this.position,new s.FunctorDeclaration(i.position,this.parseFunctorBindingSeq());if(this.checkKeywordToken(i,";"))return++this.position,new a.EmptyDeclaration(u);if(this.checkKeywordToken(i,"in")||this.checkKeywordToken(i,"end"))return new a.EmptyDeclaration(u);if(t){var V=this.parseExpression(),b=new a.ValueBinding(i.position,!1,new n.ValueIdentifier(-1,new o.AlphanumericIdentifierToken("it",-1)),V);return this.assertKeywordToken(this.currentToken(),";"),new a.ValueDeclaration(i.position,[],[b],u)}throw new r.ParserError("Expected a declaration.",i.position)},Parser.prototype.currentToken=function(){if(this.position>=this.tokens.length)throw new r.IncompleteError(-1,"More input, I'm starving. ~nyan.");return this.tokens[this.position]},Parser}();exports.Parser=u,exports.parse=parse},function(t,exports,e){"use strict";function addMathLib(t){var e=new n.DynamicBasis({},{},{},{},{}),a=new n.StaticBasis({},{},{},{},{});return e.setValue("sqrt",new r.PredefinedFunction("sqrt",function(t){if(t instanceof r.Real){var e=t.value;return e<0?[new r.ExceptionConstructor("Domain").construct(),!0,[]]:[new r.Real(Math.sqrt(e)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("sqrt",new i.FunctionType(u,u),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("sin",new r.PredefinedFunction("sin",function(t){if(t instanceof r.Real){var e=t.value;return[new r.Real(Math.sin(e)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("sin",new i.FunctionType(u,u),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("cos",new r.PredefinedFunction("cos",function(t){if(t instanceof r.Real){var e=t.value;return[new r.Real(Math.cos(e)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("cos",new i.FunctionType(u,u),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("asin",new r.PredefinedFunction("asin",function(t){if(t instanceof r.Real){var e=t.value;return[new r.Real(Math.asin(e)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("asin",new i.FunctionType(u,u),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("acos",new r.PredefinedFunction("acos",function(t){if(t instanceof r.Real){var e=t.value;return[new r.Real(Math.acos(e)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("acos",new i.FunctionType(u,u),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("exp",new r.PredefinedFunction("exp",function(t){if(t instanceof r.Real){var e=t.value;return[new r.Real(Math.exp(e)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("exp",new i.FunctionType(u,u),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("pow",new r.PredefinedFunction("pow",function(t){if(t instanceof r.RecordValue){var e=t.getValue("1"),n=t.getValue("2");if(e instanceof r.Real&&n instanceof r.Real){var i=e.value,a=e.value;return[new r.Real(Math.pow(i,a)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("pow",new i.FunctionType(new i.TupleType([u,u]),u).simplify(),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("ln",new r.PredefinedFunction("ln",function(t){if(t instanceof r.Real){var e=t.value;return[new r.Real(Math.log(e)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("ln",new i.FunctionType(u,u),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("log10",new r.PredefinedFunction("log10",function(t){if(t instanceof r.Real){var e=t.value;return[new r.Real(Math.log10(e)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("log10",new i.FunctionType(u,u),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("pi",new r.Real(3.14159265359),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("pi",u,n.IdentifierStatus.VALUE_VARIABLE),e.setValue("e",new r.Real(2.71828182846),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("e",u,n.IdentifierStatus.VALUE_VARIABLE),t.setDynamicStructure("Math",e),t.setStaticStructure("Math",a),t}function addCharLib(t){return t.setDynamicValue("ord",new r.PredefinedFunction("ord",function(t){if(t instanceof r.CharValue){var e=t.value;return[new r.Integer(e.charCodeAt(0)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),t.setStaticValue("ord",new i.FunctionType(p,s),n.IdentifierStatus.VALUE_VARIABLE),t.setDynamicValue("chr",new r.PredefinedFunction("chr",function(t){if(t instanceof r.Integer){var e=t.value;return e<0||e>255?[new r.ExceptionConstructor("Chr").construct(),!0,[]]:[new r.CharValue(String.fromCharCode(e)),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),t.setStaticValue("chr",new i.FunctionType(s,p),n.IdentifierStatus.VALUE_VARIABLE),t}function addRealLib(t){var e=new n.DynamicBasis({},{},{},{},{}),a=new n.StaticBasis({},{},{},{},{});return e.setValue("fromInt",new r.PredefinedFunction("fromInt",function(t){if(t instanceof r.Integer){var e=t.value;return[new r.Real(e),!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("fromInt",new i.FunctionType(s,u),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("round",new r.PredefinedFunction("round",function(t){if(t instanceof r.Real){var e=t.value,n=new r.Integer(Math.round(e));return n.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[n,!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("round",new i.FunctionType(u,s),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("floor",new r.PredefinedFunction("floor",function(t){if(t instanceof r.Real){var e=t.value,n=new r.Integer(Math.floor(e));return n.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[n,!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("floor",new i.FunctionType(u,s),n.IdentifierStatus.VALUE_VARIABLE),e.setValue("ceil",new r.PredefinedFunction("ceil",function(t){if(t instanceof r.Real){var e=t.value,n=new r.Integer(Math.round(e));return n.hasOverflow()?[new r.ExceptionConstructor("Overflow").construct(),!0,[]]:[n,!1,[]]}throw new o.InternalInterpreterError(-1,"std type mismatch")}),n.IdentifierStatus.VALUE_VARIABLE),a.setValue("ceil",new i.FunctionType(u,s),n.IdentifierStatus.VALUE_VARIABLE),t.setDynamicStructure("Real",e),t.setStaticStructure("Real",a),t}function addStdLib(t,e){return t=addMathLib(t),t=addCharLib(t),t=addRealLib(t),t=a.interpret(c,t,e).state}Object.defineProperty(exports,"__esModule",{value:!0});var n=e(2),i=e(3),r=e(4),o=e(0),a=e(8),s=new i.CustomType("int"),u=new i.CustomType("real"),p=new i.CustomType("char"),c='\nexception Domain;\nexception Size;\nexception Chr;\nexception Subscript;\n\nfun o (f,g) x = f (g x);\ninfix 3 o;\n\ndatatype order = LESS | EQUAL | GREATER;\n\nstructure Real = struct\n    open Real;\n    fun compare (x, y: real) = if x < y then LESS else if x > y then GREATER else EQUAL;\nend\n\nstructure Option = struct\n    exception Option;\n\n    datatype \'a option = NONE | SOME of \'a;\n\n    fun valOf (SOME x) = x\n      | valOf NONE = raise Option;\n\n    fun isSome NONE = false\n      | isSome (SOME _) = true;\nend;\nopen Option;\n\nstructure Int = struct\n    fun compare (x, y: int) = if x < y then LESS else if x > y then GREATER else EQUAL;\n\n    val minInt = SOME ~1073741824;\n    val maxInt = SOME 1073741823;\n    fun max (x, y) = if x < y then y else x : int;\nend\n\nfun not true = false | not false = true;\n\nstructure List = struct\n    exception Empty;\n\n    fun hd nil = raise Empty\n      | hd (x::xr) = x;\n\n    fun tl nil = raise Empty\n      | tl (x::xr) = xr;\n\n    fun null nil = true\n      | null (x::xr) = false;\n\n    fun map f nil = nil\n      | map f (x::xr) = (f x) :: (map f xr);\n\n    infixr 5 @;\n    fun [] @ ys = ys\n      | (x::xr) @ ys = x :: (xr @ ys);\n\n    fun length nil = 0\n      | length (x::xr) = 1 + length xr;\n\n    fun rev nil = nil\n      | rev (x::xr) = rev xr @ [x];\n\n    fun foldr f e []      = e\n      | foldr f e (x::xr) = f(x, foldr f e xr);\n\n    fun foldl f e []      = e\n      | foldl f e (x::xr) = foldl f (f(x, e)) xr;\nend;\nopen List;\ninfixr 5 @;\n\nstructure List = struct\n    open List;\n\n    fun concat nil = nil\n      | concat (x::xr) = x @ concat xr;\n\n    fun tabulate (n, f) = let\n        fun h i = if i < n then f i :: h (i + 1) else []\n    in\n        if n < 0 then raise Size else h 0\n    end;\n\n    fun exists p []      = false\n      | exists p (x::xr) = p x orelse exists p xr;\n\n    fun all p []      = true\n      | all p (x::xr) = p x andalso all p xr;\n\n    fun filter p []      = []\n      | filter p (x::xr) = if p x then x :: filter p xr else filter p xr;\n\n    fun collate (compare : \'a * \'a -> order) p = case p of\n        (nil, _::_)     => LESS\n      | (nil, nil)      => EQUAL\n      | (_::_, nil)     => GREATER\n      | (x::xr, y::yr)  => case compare (x, y) of\n             EQUAL  => collate compare (xr, yr)\n           | s      => s;\n\n    fun nth (xs, n) = let\n        fun h []      _ = raise Subscript\n          | h (x::xr) n = if n = 0 then x else h xr (n - 1)\n    in\n        if n < 0 then raise Subscript else h xs n\n    end;\nend;\n\nstructure Char = struct\n    (* open Char; *)\n    fun isLower c  = #"a" <= c andalso c <= #"z";\n    fun isUpper c  = #"A" <= c andalso c <= #"Z";\n    fun isDigit c  = #"0" <= c andalso c <= #"9";\n    fun isAlpha c  = isLower c orelse isUpper c;\nend;\n\nfun ! (a : \'A ref): \'A = ! a;\nfun op := ((a, b) : (\'A ref * \'A)): unit = a := b;\nfun ref (a : \'A): \'A ref = ref a;\n';exports.addStdLib=addStdLib},function(t,exports,e){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var i=e(7),r=e(6),o=e(1),a=e(3),s=e(2),u=e(0),p=e(4),c=e(5),h=function(t){function StructureExpression(e,n){var i=t.call(this)||this;return i.position=e,i.structureDeclaration=n,i}return n(StructureExpression,t),StructureExpression.prototype.simplify=function(){return new StructureExpression(this.position,this.structureDeclaration.simplify())},StructureExpression.prototype.elaborate=function(t,e,n){var i=t.getNestedState(0).getNestedState(t.id),r=this.structureDeclaration.elaborate(i,e,n,!0);return[r[0].getStaticChanges(0),r[1],r[2],r[3]]},StructureExpression.prototype.computeStructure=function(t){var e=t.getNestedState(0).getNestedState(t.id),n=this.structureDeclaration.evaluate(e),i=n[0].getMemoryChanges(0);return n[1]?[n[2],n[3],i]:[n[0].getDynamicChanges(0),n[3],i]},StructureExpression.prototype.toString=function(){return"struct "+this.structureDeclaration+" end"},StructureExpression}(i.Expression);exports.StructureExpression=h;var f=function(t){function StructureIdentifier(e,n){var i=t.call(this)||this;return i.position=e,i.identifier=n,i}return n(StructureIdentifier,t),StructureIdentifier.prototype.simplify=function(){return this},StructureIdentifier.prototype.elaborate=function(t,e,n){var i=void 0;if(this.identifier instanceof o.LongIdentifierToken){var r=t.getAndResolveStaticStructure(this.identifier);void 0!==r&&(i=r.getStructure(this.identifier.id.getText()))}else i=t.getStaticStructure(this.identifier.getText());if(void 0===i)throw new u.ElaborationError(this.position,'Undefined module "'+this.identifier.getText()+'".');return[i,[],e,n]},StructureIdentifier.prototype.computeStructure=function(t){var e=void 0;if(this.identifier instanceof o.LongIdentifierToken){var n=t.getAndResolveDynamicStructure(this.identifier);void 0!==n&&(e=n.getStructure(this.identifier.id.getText()))}else e=t.getDynamicStructure(this.identifier.getText());if(void 0===e)throw new u.EvaluationError(this.position,'Undefined module "'+this.identifier.getText()+'".');return[e,[],[]]},StructureIdentifier.prototype.toString=function(){return this.identifier.getText()},StructureIdentifier}(i.Expression);exports.StructureIdentifier=f;var l=function(t){function TransparentConstraint(e,n,i){var r=t.call(this)||this;return r.position=e,r.structureExpression=n,r.signatureExpression=i,r}return n(TransparentConstraint,t),TransparentConstraint.prototype.simplify=function(){return new TransparentConstraint(this.position,this.structureExpression.simplify(),this.signatureExpression.simplify())},TransparentConstraint.prototype.elaborate=function(t,e,n){var i=this.structureExpression.elaborate(t,e,n),r=this.signatureExpression.elaborate(t,i[2],i[3]),o=new s.StaticBasis({},{},{},{},{}),p=t.getNestedState(t.id);p.staticBasis=i[0];var c=t.getNestedState(t.id);c.staticBasis=r[0];for(var h in r[0].typeEnvironment)if(r[0].typeEnvironment.hasOwnProperty(h)){if(!i[0].typeEnvironment.hasOwnProperty(h))throw new u.ElaborationError(this.position,'Signature mismatch: Unimplemented type "'+h+'".');var f=r[0].typeEnvironment[h],l=i[0].typeEnvironment[h];if(f.arity!==l.arity)throw new u.ElaborationError(this.position,'Signature mismatch: Implementation of type "'+h+'" has the wrong arity.');try{var d=f.type,y=l.type;l.type instanceof a.FunctionType&&(y=l.type.parameterType);var v=d.merge(p,e,y);o.setType(h,l.type.instantiate(c,v[1]),[],f.arity,f.allowsEquality),e=v[1]}catch(t){if(!(t instanceof Array))throw t;throw new u.ElaborationError(this.position,'Signature mismatch: Wrong implementation of type "'+h+'": '+t[0])}}for(var h in r[0].valueEnvironment)if(r[0].valueEnvironment.hasOwnProperty(h)){if(!i[0].valueEnvironment.hasOwnProperty(h))throw new u.ElaborationError(this.position,'Signature mismatch: Unimplemented value "'+h+'".');for(var f=r[0].valueEnvironment[h],l=i[0].valueEnvironment[h],T=new Map,g=f[0].getTypeVariables(),m=l[0].getTypeVariables();l[0]instanceof a.TypeVariableBind;){for(;;){var w=+n.substring(3),E="'"+n[1]+n[2]+(w+1);if(n=E,!e.has(E)&&!g.has(E)&&!m.has(E)){"'"===l[0].name[1]&&(E="'"+E),T=T.set(l[0].name,E);break}}l[0]=l[0].type}l[0]=l[0].replaceTypeVariables(T);for(var S=f[0];S instanceof a.TypeVariableBind;){for(;;){var w=+n.substring(3),E="'"+n[1]+n[2]+(w+1);if(n=E,!e.has(E)&&!g.has(E)&&!m.has(E)){"'"===S.name[1]&&(E="'"+E),T=T.set(S.name,E);break}}S=S.type}S=S.replaceTypeVariables(T);try{var x=S.merge(p,e,l[0]);o.setValue(h,f[0].instantiate(p,x[1]),s.IdentifierStatus.VALUE_VARIABLE)}catch(t){if(!(t instanceof Array))throw t;throw new u.ElaborationError(this.position,'Signature mismatch: Wrong implementation of type "'+h+'": '+t[0])}}return[o,[],e,n]},TransparentConstraint.prototype.computeStructure=function(t){var e=this.structureExpression.computeStructure(t);if(e[0]instanceof p.Value)return e;var n=this.signatureExpression.computeInterface(t);return[e[0].restrict(n),e[1],e[2]]},TransparentConstraint.prototype.toString=function(){return this.structureExpression+" : "+this.signatureExpression},TransparentConstraint}(i.Expression);exports.TransparentConstraint=l;var d=function(t){function OpaqueConstraint(e,n,i){var r=t.call(this)||this;return r.position=e,r.structureExpression=n,r.signatureExpression=i,r}return n(OpaqueConstraint,t),OpaqueConstraint.prototype.simplify=function(){return new OpaqueConstraint(this.position,this.structureExpression.simplify(),this.signatureExpression.simplify())},OpaqueConstraint.prototype.elaborate=function(t,e,n){var i=this.structureExpression.elaborate(t,e,n),r=this.signatureExpression.elaborate(t,i[2],i[3]),o=new s.StaticBasis({},{},{},{},{}),p=t.getNestedState(t.id);p.staticBasis=i[0];var c=t.getNestedState(t.id);c.staticBasis=r[0],c=c.getNestedState(t.id);for(var h in r[0].typeEnvironment)if(r[0].typeEnvironment.hasOwnProperty(h)){if(!i[0].typeEnvironment.hasOwnProperty(h))throw new u.ElaborationError(this.position,'Signature mismatch: Unimplemented type "'+h+'".');var f=r[0].typeEnvironment[h],l=i[0].typeEnvironment[h];if(f.arity!==l.arity)throw new u.ElaborationError(this.position,'Signature mismatch: Implementation of type "'+h+'" has the wrong arity.');try{var d=f.type,y=l.type;l.type instanceof a.FunctionType&&(y=l.type.parameterType);var v=d.merge(p,e,y);d=new a.CustomType(d.name,d.typeArguments,d.position,d.qualifiedName,!0),o.setType(h,d,[],f.arity,f.allowsEquality),c.staticBasis.setType(h,d,[],f.arity,f.allowsEquality),e=v[1]}catch(t){if(!(t instanceof Array))throw t;throw new u.ElaborationError(this.position,'Signature mismatch: Wrong implementation of type "'+h+'": '+t[0])}}for(var h in r[0].valueEnvironment)if(r[0].valueEnvironment.hasOwnProperty(h)){if(!i[0].valueEnvironment.hasOwnProperty(h))throw new u.ElaborationError(this.position,'Signature mismatch: Unimplemented value "'+h+'".');for(var f=r[0].valueEnvironment[h],l=i[0].valueEnvironment[h],T=new Map,g=f[0].getTypeVariables(),m=l[0].getTypeVariables(),w=l[0];w instanceof a.TypeVariableBind;){for(;;){var E=+n.substring(3),S="'"+n[1]+n[2]+(E+1);if(n=S,!e.has(S)&&!g.has(S)&&!m.has(S)){"'"===w.name[1]&&(S="'"+S),T=T.set(w.name,S);break}}w=w.type}w=w.replaceTypeVariables(T);for(var x=f[0];x instanceof a.TypeVariableBind;){for(;;){var E=+n.substring(3),S="'"+n[1]+n[2]+(E+1);if(n=S,!e.has(S)&&!g.has(S)&&!m.has(S)){"'"===x.name[1]&&(S="'"+S),T=T.set(x.name,S);break}}x=x.type}x=x.replaceTypeVariables(T);try{x.merge(p,e,w),o.setValue(h,f[0].instantiate(c,e),s.IdentifierStatus.VALUE_VARIABLE)}catch(t){if(!(t instanceof Array))throw t;throw new u.ElaborationError(this.position,'Signature mismatch: Wrong implementation of type "'+h+'": '+t[0])}}return[o,[],e,n]},OpaqueConstraint.prototype.computeStructure=function(t){var e=this.structureExpression.computeStructure(t);if(e[0]instanceof p.Value)return e;var n=this.signatureExpression.computeInterface(t);return[e[0].restrict(n),e[1],e[2]]},OpaqueConstraint.prototype.toString=function(){return this.structureExpression+" :> "+this.signatureExpression},OpaqueConstraint}(i.Expression);exports.OpaqueConstraint=d;var y=function(t){function FunctorApplication(e,n,i){var r=t.call(this)||this;return r.position=e,r.functorId=n,r.structureExpression=i,r}return n(FunctorApplication,t),FunctorApplication.prototype.simplify=function(){return new FunctorApplication(this.position,this.functorId,this.structureExpression.simplify())},FunctorApplication.prototype.elaborate=function(t,e,n){throw new Error("ニャ－")},FunctorApplication.prototype.computeStructure=function(t){var e=t.getDynamicFunctor(this.functorId.getText());if(void 0===e)throw new u.EvaluationError(this.position,'Undefined functor "'+this.functorId.getText()+'".');var n=this.structureExpression.computeStructure(t);if(n[0]instanceof p.Value)return n;for(var i=e.state.getNestedState(e.state.id),r=0;r<n[2].length;++r)i.setCell(n[2][r][0],n[2][r][1]);i.setDynamicStructure(e.paramName.getText(),n[0].restrict(e.param));var o=e.body.computeStructure(i);return[o[0],n[1].concat(o[1]),n[2].concat(o[2])]},FunctorApplication.prototype.toString=function(){return this.functorId.getText()+"( "+this.structureExpression+" )"},FunctorApplication}(i.Expression);exports.FunctorApplication=y;var v=function(t){function LocalDeclarationStructureExpression(e,n,i){var r=t.call(this)||this;return r.position=e,r.declaration=n,r.expression=i,r}return n(LocalDeclarationStructureExpression,t),LocalDeclarationStructureExpression.prototype.simplify=function(){return new LocalDeclarationStructureExpression(this.position,this.declaration.simplify(),this.expression.simplify())},LocalDeclarationStructureExpression.prototype.elaborate=function(t,e,n){var i=t.getNestedState(t.id);e.forEach(function(n,r){"*"===r[1]&&"*"===r[2]&&i.setStaticValue(r.substring(3),n[0].instantiate(t,e),s.IdentifierStatus.VALUE_VARIABLE)});var r=this.declaration.elaborate(i,e,n);n=r[3];var o=new Map;e.forEach(function(t,e){o=o.set(e,[t[0].instantiate(r[0],r[2]),t[1]])});var a=this.expression.elaborate(r[0],r[2],n);return[a[0],r[1].concat(a[1]),a[2],a[3]]},LocalDeclarationStructureExpression.prototype.toString=function(){return"let "+this.declaration+" in "+this.expression+" end"},LocalDeclarationStructureExpression.prototype.computeStructure=function(t){var e=t.getNestedState(0).getNestedState(t.id),n=this.declaration.evaluate(e),i=n[0].getMemoryChanges(0);if(n[1])return[n[2],n[3],i];var r=this.expression.computeStructure(n[0]);return[r[0],n[3].concat(r[1]),i.concat(r[2])]},LocalDeclarationStructureExpression}(i.Expression);exports.LocalDeclarationStructureExpression=v;var T=function(t){function SignatureExpression(e,n){var i=t.call(this)||this;return i.position=e,i.specification=n,i}return n(SignatureExpression,t),SignatureExpression.prototype.simplify=function(){return this},SignatureExpression.prototype.elaborate=function(t,e,n){return this.specification.elaborate(t,e,n)},SignatureExpression.prototype.computeInterface=function(t){return this.specification.computeInterface(t)},SignatureExpression.prototype.toString=function(){return"sig "+this.specification+" end"},SignatureExpression}(i.Expression);exports.SignatureExpression=T;var g=function(t){function SignatureIdentifier(e,n){var i=t.call(this)||this;return i.position=e,i.identifier=n,i}return n(SignatureIdentifier,t),SignatureIdentifier.prototype.simplify=function(){return this},SignatureIdentifier.prototype.elaborate=function(t,e,n){var i=void 0;if(this.identifier instanceof o.LongIdentifierToken){var r=t.getAndResolveStaticStructure(this.identifier);void 0!==r&&(i=r.getSignature(this.identifier.id.getText()))}else i=t.getStaticSignature(this.identifier.getText());if(void 0===i)throw new u.EvaluationError(this.position,'Undefined signature "'+this.identifier.getText()+'".');return[i,[],e,n]},SignatureIdentifier.prototype.computeInterface=function(t){var e=void 0;if(this.identifier instanceof o.LongIdentifierToken){var n=t.getAndResolveDynamicStructure(this.identifier);void 0!==n&&(e=n.getSignature(this.identifier.id.getText()))}else e=t.getDynamicSignature(this.identifier.getText());if(void 0===e)throw new u.EvaluationError(this.position,'Undefined signature "'+this.identifier.getText()+'".');return e},SignatureIdentifier.prototype.toString=function(){return this.identifier.getText()},SignatureIdentifier}(i.Expression);exports.SignatureIdentifier=g;var m=function(t){function TypeRealisation(e,n,i,r,o){var a=t.call(this)||this;return a.position=e,a.signatureExpression=n,a.tyvarseq=i,a.name=r,a.type=o,a}return n(TypeRealisation,t),TypeRealisation.prototype.simplify=function(){return new TypeRealisation(this.position,this.signatureExpression.simplify(),this.tyvarseq,this.name,this.type.simplify())},TypeRealisation.prototype.elaborate=function(t,e,n){throw new Error("ニャ－")},TypeRealisation.prototype.computeInterface=function(t){return this.signatureExpression.computeInterface(t)},TypeRealisation.prototype.toString=function(){return this.signatureExpression+" where type <stuff> "+this.name.getText()+" = "+this.type},TypeRealisation}(i.Expression);exports.TypeRealisation=m;var w=function(t){function StructureDeclaration(e,n){var i=t.call(this)||this;return i.position=e,i.structureBinding=n,i}return n(StructureDeclaration,t),StructureDeclaration.prototype.elaborate=function(t,e,n,i){for(var r=[],o=0;o<this.structureBinding.length;++o){var a=this.structureBinding[o].elaborate(t,e,n);t=a[0],r=r.concat(a[1]),e=a[2],n=a[3]}return[t,r,e,n]},StructureDeclaration.prototype.evaluate=function(t){for(var e=[],n=0;n<this.structureBinding.length;++n){var i=this.structureBinding[n].evaluate(t);if(i[1])return i;t=i[0],e=e.concat(i[3])}return[t,!1,void 0,e]},StructureDeclaration.prototype.simplify=function(){for(var t=[],e=0;e<this.structureBinding.length;++e)t.push(this.structureBinding[e].simplify());return new StructureDeclaration(this.position,t)},StructureDeclaration.prototype.toString=function(){for(var t="structure",e=0;e<this.structureBinding.length;++e)t+=" "+this.structureBinding[e];return t+";"},StructureDeclaration}(r.Declaration);exports.StructureDeclaration=w;var E=function(t){function SignatureDeclaration(e,n){var i=t.call(this)||this;return i.position=e,i.signatureBinding=n,i}return n(SignatureDeclaration,t),SignatureDeclaration.prototype.elaborate=function(t,e,n){void 0===e&&(e=new Map),void 0===n&&(n="'*t0");for(var i=[],r=0;r<this.signatureBinding.length;++r){var o=this.signatureBinding[r].elaborate(t,e,n);t=o[0],i=i.concat(o[1]),e=o[2],n=o[3]}return[t,i,e,n]},SignatureDeclaration.prototype.evaluate=function(t){for(var e=0;e<this.signatureBinding.length;++e)t=this.signatureBinding[e].evaluate(t);return[t,!1,void 0,[]]},SignatureDeclaration.prototype.simplify=function(){for(var t=[],e=0;e<this.signatureBinding.length;++e)t.push(this.signatureBinding[e].simplify());return new SignatureDeclaration(this.position,t)},SignatureDeclaration.prototype.toString=function(){for(var t="structure",e=0;e<this.signatureBinding.length;++e)t+=" "+this.signatureBinding[e];return t+";"},SignatureDeclaration}(r.Declaration);exports.SignatureDeclaration=E;var S=function(t){function FunctorDeclaration(e,n){var i=t.call(this)||this;return i.position=e,i.functorBinding=n,i}return n(FunctorDeclaration,t),FunctorDeclaration.prototype.elaborate=function(t,e,n){return void 0===e&&(e=new Map),void 0===n&&(n="'*t0"),[t,[new u.Warning(this.position,"Skipped elaborating functor.\n")],e,n]},FunctorDeclaration.prototype.evaluate=function(t){for(var e=0;e<this.functorBinding.length;++e)t=this.functorBinding[e].evaluate(t);return[t,!1,void 0,[]]},FunctorDeclaration.prototype.simplify=function(){for(var t=[],e=0;e<this.functorBinding.length;++e)t.push(this.functorBinding[e].simplify());return new FunctorDeclaration(this.position,t)},FunctorDeclaration.prototype.toString=function(){for(var t="functor",e=0;e<this.functorBinding.length;++e)t+=" "+this.functorBinding[e];return t+";"},FunctorDeclaration}(r.Declaration);exports.FunctorDeclaration=S;var x=function(){function StructureBinding(t,e,n){this.position=t,this.name=e,this.binding=n}return StructureBinding.prototype.simplify=function(){return new StructureBinding(this.position,this.name,this.binding.simplify())},StructureBinding.prototype.elaborate=function(t,e,n){var i=this.binding.elaborate(t,e,n);return t.setStaticStructure(this.name.getText(),i[0]),[t,i[1],i[2],i[3]]},StructureBinding.prototype.evaluate=function(t){for(var e=this.binding.computeStructure(t),n=0;n<e[2].length;++n)t.setCell(e[2][n][0],e[2][n][1]);return e[0]instanceof p.Value?[t,!0,e[0],e[1]]:(t.setDynamicStructure(this.name.getText(),e[0]),[t,!1,void 0,e[1]])},StructureBinding.prototype.toString=function(){return this.name.getText()+" = "+this.binding},StructureBinding}();exports.StructureBinding=x;var k=function(){function SignatureBinding(t,e,n){this.position=t,this.name=e,this.binding=n}return SignatureBinding.prototype.simplify=function(){return new SignatureBinding(this.position,this.name,this.binding.simplify())},SignatureBinding.prototype.elaborate=function(t,e,n){var i=this.binding.elaborate(t,e,n);return t.setStaticSignature(this.name.getText(),i[0]),[t,i[1],i[2],i[3]]},SignatureBinding.prototype.evaluate=function(t){return t.setDynamicSignature(this.name.getText(),this.binding.computeInterface(t)),t},SignatureBinding.prototype.toString=function(){return this.name.getText()+" = "+this.binding},SignatureBinding}();exports.SignatureBinding=k;var I=function(){function FunctorBinding(t,e,n,i,r){this.position=t,this.name=e,this.signatureName=n,this.signatureBinding=i,this.binding=r}return FunctorBinding.prototype.simplify=function(){return new FunctorBinding(this.position,this.name,this.signatureName,this.signatureBinding.simplify(),this.binding.simplify())},FunctorBinding.prototype.evaluate=function(t){var e=this.signatureBinding.computeInterface(t),n=c.getInitialState().getNestedState(t.id);return n.dynamicBasis=t.getDynamicChanges(-1),t.setDynamicFunctor(this.name.getText(),new s.DynamicFunctorInformation(this.signatureName,e,this.binding,n)),t},FunctorBinding.prototype.toString=function(){return this.name.getText()+"( "+this.signatureName+" : "+this.signatureBinding+" ) = "+this.binding},FunctorBinding}();exports.FunctorBinding=I;var V=function(){function Specification(){}return Specification}();exports.Specification=V;var b=function(t){function ValueSpecification(e,n){var i=t.call(this)||this;return i.position=e,i.valueDescription=n,i}return n(ValueSpecification,t),ValueSpecification.prototype.elaborate=function(t,e,n){for(var i=new s.StaticBasis({},{},{},{},{}),r=this,o=0;o<this.valueDescription.length;++o)!function(n){var o=r.valueDescription[n][1].simplify().instantiate(t,e);o.getTypeVariables().forEach(function(t){o=new a.TypeVariableBind(t,o)}),i.setValue(r.valueDescription[n][0].getText(),o,s.IdentifierStatus.VALUE_VARIABLE)}(o);return[i,[],e,n]},ValueSpecification.prototype.computeInterface=function(t){for(var e={},n=0;n<this.valueDescription.length;++n)e[this.valueDescription[n][0].getText()]=s.IdentifierStatus.VALUE_VARIABLE;return new s.DynamicInterface({},e,{})},ValueSpecification}(V);exports.ValueSpecification=b;var A=function(t){function TypeSpecification(e,n){var i=t.call(this)||this;return i.position=e,i.typeDescription=n,i}return n(TypeSpecification,t),TypeSpecification.prototype.elaborate=function(t,e,n){for(var i=new s.StaticBasis({},{},{},{},{}),r=0;r<this.typeDescription.length;++r)i.setType(this.typeDescription[r][1].getText(),new a.CustomType(this.typeDescription[r][1].getText(),this.typeDescription[r][0]),[],this.typeDescription[r][0].length);return[i,[],e,n]},TypeSpecification.prototype.computeInterface=function(t){for(var e={},n=0;n<this.typeDescription.length;++n)e[this.typeDescription[n][1].getText()]=[];return new s.DynamicInterface(e,{},{})},TypeSpecification}(V);exports.TypeSpecification=A;var C=function(t){function EqualityTypeSpecification(e,n){var i=t.call(this)||this;return i.position=e,i.typeDescription=n,i}return n(EqualityTypeSpecification,t),EqualityTypeSpecification.prototype.elaborate=function(t,e,n){for(var i=new s.StaticBasis({},{},{},{},{}),r=0;r<this.typeDescription.length;++r)i.setType(this.typeDescription[r][1].getText(),new a.CustomType(this.typeDescription[r][1].getText(),this.typeDescription[r][0]),[],this.typeDescription[r][0].length,!0);return[i,[],e,n]},EqualityTypeSpecification.prototype.computeInterface=function(t){for(var e={},n=0;n<this.typeDescription.length;++n)e[this.typeDescription[n][1].getText()]=[];return new s.DynamicInterface(e,{},{})},EqualityTypeSpecification}(V);exports.EqualityTypeSpecification=C;var B=function(t){function DatatypeSpecification(e,n){var i=t.call(this)||this;return i.position=e,i.datatypeDescription=n,i}return n(DatatypeSpecification,t),DatatypeSpecification.prototype.elaborate=function(t,e,n){throw new Error("ニャ－")},DatatypeSpecification.prototype.computeInterface=function(t){for(var e={},n={},i=0;i<this.datatypeDescription.length;++i){for(var r=[],o=0;o<this.datatypeDescription[i][2].length;++o)e[this.datatypeDescription[i][2][o][0].getText()]=s.IdentifierStatus.VALUE_CONSTRUCTOR,r.push(this.datatypeDescription[i][2][o][0].getText());n[this.datatypeDescription[i][1].getText()]=r}return new s.DynamicInterface(n,e,{})},DatatypeSpecification}(V);exports.DatatypeSpecification=B;var R=function(t){function DatatypeReplicationSpecification(e,n,i){var r=t.call(this)||this;return r.position=e,r.name=n,r.oldname=i,r}return n(DatatypeReplicationSpecification,t),DatatypeReplicationSpecification.prototype.elaborate=function(t,e,n){throw new Error("ニャ－")},DatatypeReplicationSpecification.prototype.computeInterface=function(t){var e=void 0;if(this.oldname instanceof o.LongIdentifierToken){var n=t.getAndResolveDynamicStructure(this.oldname);void 0!==n&&(e=n.getType(this.oldname.id.getText()))}else e=t.getDynamicType(this.oldname.getText());if(void 0===e)throw new u.EvaluationError(this.position,'The datatype "'+this.oldname.getText()+'" does not exist.');for(var i={},r=0;r<e.length;++r)i[e[r]]=s.IdentifierStatus.VALUE_CONSTRUCTOR;var a={};return a[this.name.getText()]=e,new s.DynamicInterface(a,i,{})},DatatypeReplicationSpecification}(V);exports.DatatypeReplicationSpecification=R;var L=function(t){function ExceptionSpecification(e,n){var i=t.call(this)||this;return i.position=e,i.exceptionDescription=n,i}return n(ExceptionSpecification,t),ExceptionSpecification.prototype.elaborate=function(t,e,n){throw new Error("ニャ－")},ExceptionSpecification.prototype.computeInterface=function(t){for(var e={},n=0;n<this.exceptionDescription.length;++n)e[this.exceptionDescription[n][0].getText()]=s.IdentifierStatus.EXCEPTION_CONSTRUCTOR;return new s.DynamicInterface({},e,{})},ExceptionSpecification}(V);exports.ExceptionSpecification=L;var D=function(t){function StructureSpecification(e,n){var i=t.call(this)||this;return i.position=e,i.structureDescription=n,i}return n(StructureSpecification,t),StructureSpecification.prototype.elaborate=function(t,e,n){throw new Error("ニャ－")},StructureSpecification.prototype.computeInterface=function(t){for(var e={},n=0;n<this.structureDescription.length;++n)e[this.structureDescription[n][0].getText()]=this.structureDescription[n][1].computeInterface(t);return new s.DynamicInterface({},{},e)},StructureSpecification}(V);exports.StructureSpecification=D;var _=function(t){function IncludeSpecification(e,n){var i=t.call(this)||this;return i.position=e,i.expression=n,i}return n(IncludeSpecification,t),IncludeSpecification.prototype.elaborate=function(t,e,n){return this.expression.elaborate(t,e,n)},IncludeSpecification.prototype.computeInterface=function(t){return this.expression.computeInterface(t)},IncludeSpecification}(V);exports.IncludeSpecification=_;var O=function(t){function EmptySpecification(e){var n=t.call(this)||this;return n.position=e,n}return n(EmptySpecification,t),EmptySpecification.prototype.elaborate=function(t,e,n){return[new s.StaticBasis({},{},{},{},{}),[],e,n]},EmptySpecification.prototype.computeInterface=function(t){return new s.DynamicInterface({},{},{})},EmptySpecification}(V);exports.EmptySpecification=O;var P=function(t){function SequentialSpecification(e,n){var i=t.call(this)||this;return i.position=e,i.specifications=n,i}return n(SequentialSpecification,t),SequentialSpecification.prototype.elaborate=function(t,e,n){for(var i=new s.StaticBasis({},{},{},{},{}),r=[],o=t,a=0;a<this.specifications.length;++a){var u=this.specifications[a].elaborate(o,e,n);i=i.extend(u[0]),r=r.concat(u[1]),e=u[2],n=u[3],o=o.getNestedState(o.id),o.staticBasis=u[0]}return[i,r,e,n]},SequentialSpecification.prototype.computeInterface=function(t){for(var e=new s.DynamicInterface({},{},{}),n=0;n<this.specifications.length;++n)e=e.extend(this.specifications[n].computeInterface(t));return e},SequentialSpecification}(V);exports.SequentialSpecification=P;var F=function(t){function SharingSpecification(e,n,i){var r=t.call(this)||this;return r.position=e,r.specification=n,r.typeNames=i,r}return n(SharingSpecification,t),SharingSpecification.prototype.elaborate=function(t,e,n){throw new Error("ニャ－")},SharingSpecification.prototype.computeInterface=function(t){return this.specification.computeInterface(t)},SharingSpecification}(V);exports.SharingSpecification=F}]);